"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var Matrix = _interopRequireWildcard(require("matrix-js-sdk"));

var _SettingsStore = _interopRequireWildcard(require("./settings/SettingsStore"));

/*
 Copyright 2017 Michael Telatynski <7t3chguy@gmail.com>

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var _default = {
  hasAnyLabeledDevices: async function () {
    const devices = await navigator.mediaDevices.enumerateDevices();
    return devices.some(d => !!d.label);
  },
  getDevices: function () {
    // Only needed for Electron atm, though should work in modern browsers
    // once permission has been granted to the webapp
    return navigator.mediaDevices.enumerateDevices().then(function (devices) {
      const audiooutput = [];
      const audioinput = [];
      const videoinput = [];
      devices.forEach(device => {
        switch (device.kind) {
          case 'audiooutput':
            audiooutput.push(device);
            break;

          case 'audioinput':
            audioinput.push(device);
            break;

          case 'videoinput':
            videoinput.push(device);
            break;
        }
      }); // console.log("Loaded WebRTC Devices", mediaDevices);

      return {
        audiooutput,
        audioinput,
        videoinput
      };
    }, error => {
      console.log('Unable to refresh WebRTC Devices: ', error);
    });
  },
  loadDevices: function () {
    const audioOutDeviceId = _SettingsStore.default.getValue("webrtc_audiooutput");

    const audioDeviceId = _SettingsStore.default.getValue("webrtc_audioinput");

    const videoDeviceId = _SettingsStore.default.getValue("webrtc_videoinput");

    Matrix.setMatrixCallAudioOutput(audioOutDeviceId);
    Matrix.setMatrixCallAudioInput(audioDeviceId);
    Matrix.setMatrixCallVideoInput(videoDeviceId);
  },
  setAudioOutput: function (deviceId) {
    _SettingsStore.default.setValue("webrtc_audiooutput", null, _SettingsStore.SettingLevel.DEVICE, deviceId);

    Matrix.setMatrixCallAudioOutput(deviceId);
  },
  setAudioInput: function (deviceId) {
    _SettingsStore.default.setValue("webrtc_audioinput", null, _SettingsStore.SettingLevel.DEVICE, deviceId);

    Matrix.setMatrixCallAudioInput(deviceId);
  },
  setVideoInput: function (deviceId) {
    _SettingsStore.default.setValue("webrtc_videoinput", null, _SettingsStore.SettingLevel.DEVICE, deviceId);

    Matrix.setMatrixCallVideoInput(deviceId);
  },
  getAudioOutput: function () {
    return _SettingsStore.default.getValueAt(_SettingsStore.SettingLevel.DEVICE, "webrtc_audiooutput");
  },
  getAudioInput: function () {
    return _SettingsStore.default.getValueAt(_SettingsStore.SettingLevel.DEVICE, "webrtc_audioinput");
  },
  getVideoInput: function () {
    return _SettingsStore.default.getValueAt(_SettingsStore.SettingLevel.DEVICE, "webrtc_videoinput");
  }
};
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9DYWxsTWVkaWFIYW5kbGVyLmpzIl0sIm5hbWVzIjpbImhhc0FueUxhYmVsZWREZXZpY2VzIiwiZGV2aWNlcyIsIm5hdmlnYXRvciIsIm1lZGlhRGV2aWNlcyIsImVudW1lcmF0ZURldmljZXMiLCJzb21lIiwiZCIsImxhYmVsIiwiZ2V0RGV2aWNlcyIsInRoZW4iLCJhdWRpb291dHB1dCIsImF1ZGlvaW5wdXQiLCJ2aWRlb2lucHV0IiwiZm9yRWFjaCIsImRldmljZSIsImtpbmQiLCJwdXNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwibG9hZERldmljZXMiLCJhdWRpb091dERldmljZUlkIiwiU2V0dGluZ3NTdG9yZSIsImdldFZhbHVlIiwiYXVkaW9EZXZpY2VJZCIsInZpZGVvRGV2aWNlSWQiLCJNYXRyaXgiLCJzZXRNYXRyaXhDYWxsQXVkaW9PdXRwdXQiLCJzZXRNYXRyaXhDYWxsQXVkaW9JbnB1dCIsInNldE1hdHJpeENhbGxWaWRlb0lucHV0Iiwic2V0QXVkaW9PdXRwdXQiLCJkZXZpY2VJZCIsInNldFZhbHVlIiwiU2V0dGluZ0xldmVsIiwiREVWSUNFIiwic2V0QXVkaW9JbnB1dCIsInNldFZpZGVvSW5wdXQiLCJnZXRBdWRpb091dHB1dCIsImdldFZhbHVlQXQiLCJnZXRBdWRpb0lucHV0IiwiZ2V0VmlkZW9JbnB1dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQWpCQTs7Ozs7Ozs7Ozs7Ozs7O2VBbUJlO0FBQ1hBLEVBQUFBLG9CQUFvQixFQUFFLGtCQUFpQjtBQUNuQyxVQUFNQyxPQUFPLEdBQUcsTUFBTUMsU0FBUyxDQUFDQyxZQUFWLENBQXVCQyxnQkFBdkIsRUFBdEI7QUFDQSxXQUFPSCxPQUFPLENBQUNJLElBQVIsQ0FBYUMsQ0FBQyxJQUFJLENBQUMsQ0FBQ0EsQ0FBQyxDQUFDQyxLQUF0QixDQUFQO0FBQ0gsR0FKVTtBQU1YQyxFQUFBQSxVQUFVLEVBQUUsWUFBVztBQUNuQjtBQUNBO0FBQ0Es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LypcbiBDb3B5cmlnaHQgMjAxNyBNaWNoYWVsIFRlbGF0eW5za2kgPDd0M2NoZ3V5QGdtYWlsLmNvbT5cblxuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cbiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCAqIGFzIE1hdHJpeCBmcm9tICdtYXRyaXgtanMtc2RrJztcbmltcG9ydCBTZXR0aW5nc1N0b3JlLCB7U2V0dGluZ0xldmVsfSBmcm9tIFwiLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgICBoYXNBbnlMYWJlbGVkRGV2aWNlczogYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnN0IGRldmljZXMgPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKTtcbiAgICAgICAgcmV0dXJuIGRldmljZXMuc29tZShkID0+ICEhZC5sYWJlbCk7XG4gICAgfSxcblxuICAgIGdldERldmljZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBPbmx5IG5lZWRlZCBmb3IgRWxlY3Ryb24gYXRtLCB0aG91Z2ggc2hvdWxkIHdvcmsgaW4gbW9kZXJuIGJyb3dzZXJzXG4gICAgICAgIC8vIG9uY2UgcGVybWlzc2lvbiBoYXMgYmVlbiBncmFudGVkIHRvIHRoZSB3ZWJhcHBcbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpLnRoZW4oZnVuY3Rpb24oZGV2aWNlcykge1xuICAgICAgICAgICAgY29uc3QgYXVkaW9vdXRwdXQgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGF1ZGlvaW5wdXQgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IHZpZGVvaW5wdXQgPSBbXTtcblxuICAgICAgICAgICAgZGV2aWNlcy5mb3JFYWNoKChkZXZpY2UpID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRldmljZS5raW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F1ZGlvb3V0cHV0JzogYXVkaW9vdXRwdXQucHVzaChkZXZpY2UpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXVkaW9pbnB1dCc6IGF1ZGlvaW5wdXQucHVzaChkZXZpY2UpOyBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndmlkZW9pbnB1dCc6IHZpZGVvaW5wdXQucHVzaChkZXZpY2UpOyBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJMb2FkZWQgV2ViUlRDIERldmljZXNcIiwgbWVkaWFEZXZpY2VzKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgYXVkaW9vdXRwdXQsXG4gICAgICAgICAgICAgICAgYXVkaW9pbnB1dCxcbiAgICAgICAgICAgICAgICB2aWRlb2lucHV0LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7IGNvbnNvbGUubG9nKCdVbmFibGUgdG8gcmVmcmVzaCBXZWJSVEMgRGV2aWNlczogJywgZXJyb3IpOyB9KTtcbiAgICB9LFxuXG4gICAgbG9hZERldmljZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBhdWRpb091dERldmljZUlkID0gU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZShcIndlYnJ0Y19hdWRpb291dHB1dFwiKTtcbiAgICAgICAgY29uc3QgYXVkaW9EZXZpY2VJZCA9IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJ3ZWJydGNfYXVkaW9pbnB1dFwiKTtcbiAgICAgICAgY29uc3QgdmlkZW9EZXZpY2VJZCA9IFNldHRpbmdzU3RvcmUuZ2V0VmFsdWUoXCJ3ZWJydGNfdmlkZW9pbnB1dFwiKTtcblxuICAgICAgICBNYXRyaXguc2V0TWF0cml4Q2FsbEF1ZGlvT3V0cHV0KGF1ZGlvT3V0RGV2aWNlSWQpO1xuICAgICAgICBNYXRyaXguc2V0TWF0cml4Q2FsbEF1ZGlvSW5wdXQoYXVkaW9EZXZpY2VJZCk7XG4gICAgICAgIE1hdHJpeC5zZXRNYXRyaXhDYWxsVmlkZW9JbnB1dCh2aWRlb0RldmljZUlkKTtcbiAgICB9LFxuXG4gICAgc2V0QXVkaW9PdXRwdXQ6IGZ1bmN0aW9uKGRldmljZUlkKSB7XG4gICAgICAgIFNldHRpbmdzU3RvcmUuc2V0VmFsdWUoXCJ3ZWJydGNfYXVkaW9vdXRwdXRcIiwgbnVsbCwgU2V0dGluZ0xldmVsLkRFVklDRSwgZGV2aWNlSWQpO1xuICAgICAgICBNYXRyaXguc2V0TWF0cml4Q2FsbEF1ZGlvT3V0cHV0KGRldmljZUlkKTtcbiAgICB9LFxuXG4gICAgc2V0QXVkaW9JbnB1dDogZnVuY3Rpb24oZGV2aWNlSWQpIHtcbiAgICAgICAgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcIndlYnJ0Y19hdWRpb2lucHV0XCIsIG51bGwsIFNldHRpbmdMZXZlbC5ERVZJQ0UsIGRldmljZUlkKTtcbiAgICAgICAgTWF0cml4LnNldE1hdHJpeENhbGxBdWRpb0lucHV0KGRldmljZUlkKTtcbiAgICB9LFxuXG4gICAgc2V0VmlkZW9JbnB1dDogZnVuY3Rpb24oZGV2aWNlSWQpIHtcbiAgICAgICAgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcIndlYnJ0Y192aWRlb2lucHV0XCIsIG51bGwsIFNldHRpbmdMZXZlbC5ERVZJQ0UsIGRldmljZUlkKTtcbiAgICAgICAgTWF0cml4LnNldE1hdHJpeENhbGxWaWRlb0lucHV0KGRldmljZUlkKTtcbiAgICB9LFxuXG4gICAgZ2V0QXVkaW9PdXRwdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZUF0KFNldHRpbmdMZXZlbC5ERVZJQ0UsIFwid2VicnRjX2F1ZGlvb3V0cHV0XCIpO1xuICAgIH0sXG5cbiAgICBnZXRBdWRpb0lucHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFNldHRpbmdzU3RvcmUuZ2V0VmFsdWVBdChTZXR0aW5nTGV2ZWwuREVWSUNFLCBcIndlYnJ0Y19hdWRpb2lucHV0XCIpO1xuICAgIH0sXG5cbiAgICBnZXRWaWRlb0lucHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIFNldHRpbmdzU3RvcmUuZ2V0VmFsdWVBdChTZXR0aW5nTGV2ZWwuREVWSUNFLCBcIndlYnJ0Y192aWRlb2lucHV0XCIpO1xuICAgIH0sXG59O1xuIl19