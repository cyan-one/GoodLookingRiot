"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatDate = formatDate;
exports.formatFullDateNoTime = formatFullDateNoTime;
exports.formatFullDate = formatFullDate;
exports.formatFullTime = formatFullTime;
exports.formatTime = formatTime;
exports.wantsDateSeparator = wantsDateSeparator;

var _languageHandler = require("./languageHandler");

/*
Copyright 2015, 2016 OpenMarket Ltd
Copyright 2017 Vector Creations Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
function getDaysArray() {
  return [(0, _languageHandler._t)('Sun'), (0, _languageHandler._t)('Mon'), (0, _languageHandler._t)('Tue'), (0, _languageHandler._t)('Wed'), (0, _languageHandler._t)('Thu'), (0, _languageHandler._t)('Fri'), (0, _languageHandler._t)('Sat')];
}

function getMonthsArray() {
  return [(0, _languageHandler._t)('Jan'), (0, _languageHandler._t)('Feb'), (0, _languageHandler._t)('Mar'), (0, _languageHandler._t)('Apr'), (0, _languageHandler._t)('May'), (0, _languageHandler._t)('Jun'), (0, _languageHandler._t)('Jul'), (0, _languageHandler._t)('Aug'), (0, _languageHandler._t)('Sep'), (0, _languageHandler._t)('Oct'), (0, _languageHandler._t)('Nov'), (0, _languageHandler._t)('Dec')];
}

function pad(n) {
  return (n < 10 ? '0' : '') + n;
}

function twelveHourTime(date, showSeconds = false) {
  let hours = date.getHours() % 12;
  const minutes = pad(date.getMinutes());
  const ampm = date.getHours() >= 12 ? (0, _languageHandler._t)('PM') : (0, _languageHandler._t)('AM');
  hours = hours ? hours : 12; // convert 0 -> 12

  if (showSeconds) {
    const seconds = pad(date.getSeconds());
    return "".concat(hours, ":").concat(minutes, ":").concat(seconds).concat(ampm);
  }

  return "".concat(hours, ":").concat(minutes).concat(ampm);
}

function formatDate(date, showTwelveHour = false) {
  const now = new Date();
  const days = getDaysArray();
  const months = getMonthsArray();

  if (date.toDateString() === now.toDateString()) {
    return formatTime(date, showTwelveHour);
  } else if (now.getTime() - date.getTime() < 6 * 24 * 60 * 60 * 1000) {
    // TODO: use standard date localize function provided in counterpart
    return (0, _languageHandler._t)('%(weekDayName)s %(time)s', {
      weekDayName: days[date.getDay()],
      time: formatTime(date, showTwelveHour)
    });
  } else if (now.getFullYear() === date.getFullYear()) {
    // TODO: use standard date localize function provided in counterpart
    return (0, _languageHandler._t)('%(weekDayName)s, %(monthName)s %(day)s %(time)s', {
      weekDayName: days[date.getDay()],
      monthName: months[date.getMonth()],
      day: date.getDate(),
      time: formatTime(date, showTwelveHour)
    });
  }

  return formatFullDate(date, showTwelveHour);
}

function formatFullDateNoTime(date) {
  const days = getDaysArray();
  const months = getMonthsArray();
  return (0, _languageHandler._t)('%(weekDayName)s, %(monthName)s %(day)s %(fullYear)s', {
    weekDayName: days[date.getDay()],
    monthName: months[date.getMonth()],
    day: date.getDate(),
    fullYear: date.getFullYear()
  });
}

function formatFullDate(date, showTwelveHour = false) {
  const days = getDaysArray();
  const months = getMonthsArray();
  return (0, _languageHandler._t)('%(weekDayName)s, %(monthName)s %(day)s %(fullYear)s %(time)s', {
    weekDayName: days[date.getDay()],
    monthName: months[date.getMonth()],
    day: date.getDate(),
    fullYear: date.getFullYear(),
    time: formatFullTime(date, showTwelveHour)
  });
}

function formatFullTime(date, showTwelveHour = false) {
  if (showTwelveHour) {
    return twelveHourTime(date, true);
  }

  return pad(date.getHours()) + ':' + pad(date.getMinutes()) + ':' + pad(date.getSeconds());
}

function formatTime(date, showTwelveHour = false) {
  if (showTwelveHour) {
    return twelveHourTime(date);
  }

  return pad(date.getHours()) + ':' + pad(date.getMinutes());
}

const MILLIS_IN_DAY = 86400000;

function wantsDateSeparator(prevEventDate, nextEventDate) {
  if (!nextEventDate || !prevEventDate) {
    return false;
  } // Return early for events that are > 24h apart


  if (Math.abs(prevEventDate.getTime() - nextEventDate.getTime()) > MILLIS_IN_DAY) {
    return true;
  } // Compare weekdays


  return prevEventDate.getDay() !== nextEventDate.getDay();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EYXRlVXRpbHMuanMiXSwibmFtZXMiOlsiZ2V0RGF5c0FycmF5IiwiZ2V0TW9udGhzQXJyYXkiLCJwYWQiLCJuIiwidHdlbHZlSG91clRpbWUiLCJkYXRlIiwic2hvd1NlY29uZHMiLCJob3VycyIsImdldEhvdXJzIiwibWludXRlcyIsImdldE1pbnV0ZXMiLCJhbXBtIiwic2Vjb25kcyIsImdldFNlY29uZHMiLCJmb3JtYXREYXRlIiwic2hvd1R3ZWx2ZUhvdXIiLCJub3ciLCJEYXRlIiwiZGF5cyIsIm1vbnRocyIsInRvRGF0ZVN0cmluZyIsImZvcm1hdFRpbWUiLCJnZXRUaW1lIiwid2Vla0RheU5hbWUiLCJnZXREYXkiLCJ0aW1lIiwiZ2V0RnVsbFllYXIiLCJtb250aE5hbWUiLCJnZXRNb250aCIsImRheSIsImdldERhdGUiLCJmb3JtYXRGdWxsRGF0ZSIsImZvcm1hdEZ1bGxEYXRlTm9UaW1lIiwiZnVsbFllYXIiLCJmb3JtYXRGdWxsVGltZSIsIk1JTExJU19JTl9EQVkiLCJ3YW50c0RhdGVTZXBhcmF0b3IiLCJwcmV2RXZlbnREYXRlIiwibmV4dEV2ZW50RGF0ZSIsIk1hdGgiLCJhYnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQWlCQTs7QUFqQkE7Ozs7Ozs7Ozs7Ozs7Ozs7QUFtQkEsU0FBU0EsWUFBVCxHQUF3QjtBQUNwQixTQUFPLENBQ0gseUJBQUcsS0FBSCxDQURHLEVBRUgseUJBQUcsS0FBSCxDQUZHLEVBR0gseUJBQUcsS0FBSCxDQUhHLEVBSUgseUJBQUcsS0FBSCxDQUpHLEVBS0gseUJBQUcsS0FBSCxDQUxHLEVBTUgseUJBQUcsS0FBSCxDQU5HLEVBT0gseUJBQUcsS0FBSCxDQVBHLENBQVA7QUFTSDs7QUFFRCxTQUFTQyxjQUFULEdBQTBCO0FBQ3RCLFNBQU8sQ0FDSCx5QkFBRyxLQUFILENBREcsRUFFSCx5QkFBRyxLQUFILENBRkcsRUFHSCx5QkFBRyxLQUFILENBSEcsRUFJSCx5QkFBRyxLQUFILENBSkcs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WCxjQUFjLENBQUNDLElBQUQsRUFBTyxJQUFQLENBQXJCO0FBQ0g7O0FBQ0QsU0FBT0gsR0FBRyxDQUFDRyxJQUFJLENBQUNHLFFBQUwsRUFBRCxDQUFILEdBQXVCLEdBQXZCLEdBQTZCTixHQUFHLENBQUNHLElBQUksQ0FBQ0ssVUFBTCxFQUFELENBQWhDLEdBQXNELEdBQXRELEdBQTREUixHQUFHLENBQUNHLElBQUksQ0FBQ1EsVUFBTCxFQUFELENBQXRFO0FBQ0g7O0FBRU0sU0FBU1EsVUFBVCxDQUFvQmhCLElBQXBCLEVBQTBCVSxjQUFjLEdBQUMsS0FBekMsRUFBZ0Q7QUFDbkQsTUFBSUEsY0FBSixFQUFvQjtBQUNoQixXQUFPWCxjQUFjLENBQUNDLElBQUQsQ0FBckI7QUFDSDs7QUFDRCxTQUFPSCxHQUFHLENBQUNHLElBQUksQ0FBQ0csUUFBTCxFQUFELENBQUgsR0FBdUIsR0FBdkIsR0FBNkJOLEdBQUcsQ0FBQ0csSUFBSSxDQUFDSyxVQUFMLEVBQUQsQ0FBdkM7QUFDSDs7QUFFRCxNQUFNeUIsYUFBYSxHQUFHLFFBQXRCOztBQUNPLFNBQVNDLGtCQUFULENBQTRCQyxhQUE1QixFQUEyQ0MsYUFBM0MsRUFBMEQ7QUFDN0QsTUFBSSxDQUFDQSxhQUFELElBQWtCLENBQUNELGFBQXZCLEVBQXNDO0FBQ2xDLFdBQU8sS0FBUDtBQUNILEdBSDRELENBSTdEOzs7QUFDQSxNQUFJRSxJQUFJLENBQUNDLEdBQUwsQ0FBU0gsYUFBYSxDQUFDZixPQUFkLEtBQTBCZ0IsYUFBYSxDQUFDaEIsT0FBZCxFQUFuQyxJQUE4RGEsYUFBbEUsRUFBaUY7QUFDN0UsV0FBTyxJQUFQO0FBQ0gsR0FQNEQsQ0FTN0Q7OztBQUNBLFNBQU9FLGFBQWEsQ0FBQ2IsTUFBZCxPQUEyQmMsYUFBYSxDQUFDZCxNQUFkLEVBQWxDO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTUsIDIwMTYgT3Blbk1hcmtldCBMdGRcbkNvcHlyaWdodCAyMDE3IFZlY3RvciBDcmVhdGlvbnMgTHRkXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IHsgX3QgfSBmcm9tICcuL2xhbmd1YWdlSGFuZGxlcic7XG5cbmZ1bmN0aW9uIGdldERheXNBcnJheSgpIHtcbiAgICByZXR1cm4gW1xuICAgICAgICBfdCgnU3VuJyksXG4gICAgICAgIF90KCdNb24nKSxcbiAgICAgICAgX3QoJ1R1ZScpLFxuICAgICAgICBfdCgnV2VkJyksXG4gICAgICAgIF90KCdUaHUnKSxcbiAgICAgICAgX3QoJ0ZyaScpLFxuICAgICAgICBfdCgnU2F0JyksXG4gICAgXTtcbn1cblxuZnVuY3Rpb24gZ2V0TW9udGhzQXJyYXkoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgX3QoJ0phbicpLFxuICAgICAgICBfdCgnRmViJyksXG4gICAgICAgIF90KCdNYXInKSxcbiAgICAgICAgX3QoJ0FwcicpLFxuICAgICAgICBfdCgnTWF5JyksXG4gICAgICAgIF90KCdKdW4nKSxcbiAgICAgICAgX3QoJ0p1bCcpLFxuICAgICAgICBfdCgnQXVnJyksXG4gICAgICAgIF90KCdTZXAnKSxcbiAgICAgICAgX3QoJ09jdCcpLFxuICAgICAgICBfdCgnTm92JyksXG4gICAgICAgIF90KCdEZWMnKSxcbiAgICBdO1xufVxuXG5mdW5jdGlvbiBwYWQobikge1xuICAgIHJldHVybiAobiA8IDEwID8gJzAnIDogJycpICsgbjtcbn1cblxuZnVuY3Rpb24gdHdlbHZlSG91clRpbWUoZGF0ZSwgc2hvd1NlY29uZHM9ZmFsc2UpIHtcbiAgICBsZXQgaG91cnMgPSBkYXRlLmdldEhvdXJzKCkgJSAxMjtcbiAgICBjb25zdCBtaW51dGVzID0gcGFkKGRhdGUuZ2V0TWludXRlcygpKTtcbiAgICBjb25zdCBhbXBtID0gZGF0ZS5nZXRIb3VycygpID49IDEyID8gX3QoJ1BNJykgOiBfdCgnQU0nKTtcbiAgICBob3VycyA9IGhvdXJzID8gaG91cnMgOiAxMjsgLy8gY29udmVydCAwIC0+IDEyXG4gICAgaWYgKHNob3dTZWNvbmRzKSB7XG4gICAgICAgIGNvbnN0IHNlY29uZHMgPSBwYWQoZGF0ZS5nZXRTZWNvbmRzKCkpO1xuICAgICAgICByZXR1cm4gYCR7aG91cnN9OiR7bWludXRlc306JHtzZWNvbmRzfSR7YW1wbX1gO1xuICAgIH1cbiAgICByZXR1cm4gYCR7aG91cnN9OiR7bWludXRlc30ke2FtcG19YDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXI9ZmFsc2UpIHtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGRheXMgPSBnZXREYXlzQXJyYXkoKTtcbiAgICBjb25zdCBtb250aHMgPSBnZXRNb250aHNBcnJheSgpO1xuICAgIGlmIChkYXRlLnRvRGF0ZVN0cmluZygpID09PSBub3cudG9EYXRlU3RyaW5nKCkpIHtcbiAgICAgICAgcmV0dXJuIGZvcm1hdFRpbWUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXIpO1xuICAgIH0gZWxzZSBpZiAobm93LmdldFRpbWUoKSAtIGRhdGUuZ2V0VGltZSgpIDwgNiAqIDI0ICogNjAgKiA2MCAqIDEwMDApIHtcbiAgICAgICAgLy8gVE9ETzogdXNlIHN0YW5kYXJkIGRhdGUgbG9jYWxpemUgZnVuY3Rpb24gcHJvdmlkZWQgaW4gY291bnRlcnBhcnRcbiAgICAgICAgcmV0dXJuIF90KCclKHdlZWtEYXlOYW1lKXMgJSh0aW1lKXMnLCB7XG4gICAgICAgICAgICB3ZWVrRGF5TmFtZTogZGF5c1tkYXRlLmdldERheSgpXSxcbiAgICAgICAgICAgIHRpbWU6IGZvcm1hdFRpbWUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXIpLFxuICAgICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKG5vdy5nZXRGdWxsWWVhcigpID09PSBkYXRlLmdldEZ1bGxZZWFyKCkpIHtcbiAgICAgICAgLy8gVE9ETzogdXNlIHN0YW5kYXJkIGRhdGUgbG9jYWxpemUgZnVuY3Rpb24gcHJvdmlkZWQgaW4gY291bnRlcnBhcnRcbiAgICAgICAgcmV0dXJuIF90KCclKHdlZWtEYXlOYW1lKXMsICUobW9udGhOYW1lKXMgJShkYXkpcyAlKHRpbWUpcycsIHtcbiAgICAgICAgICAgIHdlZWtEYXlOYW1lOiBkYXlzW2RhdGUuZ2V0RGF5KCldLFxuICAgICAgICAgICAgbW9udGhOYW1lOiBtb250aHNbZGF0ZS5nZXRNb250aCgpXSxcbiAgICAgICAgICAgIGRheTogZGF0ZS5nZXREYXRlKCksXG4gICAgICAgICAgICB0aW1lOiBmb3JtYXRUaW1lKGRhdGUsIHNob3dUd2VsdmVIb3VyKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXRGdWxsRGF0ZShkYXRlLCBzaG93VHdlbHZlSG91cik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRGdWxsRGF0ZU5vVGltZShkYXRlKSB7XG4gICAgY29uc3QgZGF5cyA9IGdldERheXNBcnJheSgpO1xuICAgIGNvbnN0IG1vbnRocyA9IGdldE1vbnRoc0FycmF5KCk7XG4gICAgcmV0dXJuIF90KCclKHdlZWtEYXlOYW1lKXMsICUobW9udGhOYW1lKXMgJShkYXkpcyAlKGZ1bGxZZWFyKXMnLCB7XG4gICAgICAgIHdlZWtEYXlOYW1lOiBkYXlzW2RhdGUuZ2V0RGF5KCldLFxuICAgICAgICBtb250aE5hbWU6IG1vbnRoc1tkYXRlLmdldE1vbnRoKCldLFxuICAgICAgICBkYXk6IGRhdGUuZ2V0RGF0ZSgpLFxuICAgICAgICBmdWxsWWVhcjogZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RnVsbERhdGUoZGF0ZSwgc2hvd1R3ZWx2ZUhvdXI9ZmFsc2UpIHtcbiAgICBjb25zdCBkYXlzID0gZ2V0RGF5c0FycmF5KCk7XG4gICAgY29uc3QgbW9udGhzID0gZ2V0TW9udGhzQXJyYXkoKTtcbiAgICByZXR1cm4gX3QoJyUod2Vla0RheU5hbWUpcywgJShtb250aE5hbWUpcyAlKGRheSlzICUoZnVsbFllYXIpcyAlKHRpbWUpcycsIHtcbiAgICAgICAgd2Vla0RheU5hbWU6IGRheXNbZGF0ZS5nZXREYXkoKV0sXG4gICAgICAgIG1vbnRoTmFtZTogbW9udGhzW2RhdGUuZ2V0TW9udGgoKV0sXG4gICAgICAgIGRheTogZGF0ZS5nZXREYXRlKCksXG4gICAgICAgIGZ1bGxZZWFyOiBkYXRlLmdldEZ1bGxZZWFyKCksXG4gICAgICAgIHRpbWU6IGZvcm1hdEZ1bGxUaW1lKGRhdGUsIHNob3dUd2VsdmVIb3VyKSxcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdEZ1bGxUaW1lKGRhdGUsIHNob3dUd2VsdmVIb3VyPWZhbHNlKSB7XG4gICAgaWYgKHNob3dUd2VsdmVIb3VyKSB7XG4gICAgICAgIHJldHVybiB0d2VsdmVIb3VyVGltZShkYXRlLCB0cnVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhZChkYXRlLmdldEhvdXJzKCkpICsgJzonICsgcGFkKGRhdGUuZ2V0TWludXRlcygpKSArICc6JyArIHBhZChkYXRlLmdldFNlY29uZHMoKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRUaW1lKGRhdGUsIHNob3dUd2VsdmVIb3VyPWZhbHNlKSB7XG4gICAgaWYgKHNob3dUd2VsdmVIb3VyKSB7XG4gICAgICAgIHJldHVybiB0d2VsdmVIb3VyVGltZShkYXRlKTtcbiAgICB9XG4gICAgcmV0dXJuIHBhZChkYXRlLmdldEhvdXJzKCkpICsgJzonICsgcGFkKGRhdGUuZ2V0TWludXRlcygpKTtcbn1cblxuY29uc3QgTUlMTElTX0lOX0RBWSA9IDg2NDAwMDAwO1xuZXhwb3J0IGZ1bmN0aW9uIHdhbnRzRGF0ZVNlcGFyYXRvcihwcmV2RXZlbnREYXRlLCBuZXh0RXZlbnREYXRlKSB7XG4gICAgaWYgKCFuZXh0RXZlbnREYXRlIHx8ICFwcmV2RXZlbnREYXRlKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gUmV0dXJuIGVhcmx5IGZvciBldmVudHMgdGhhdCBhcmUgPiAyNGggYXBhcnRcbiAgICBpZiAoTWF0aC5hYnMocHJldkV2ZW50RGF0ZS5nZXRUaW1lKCkgLSBuZXh0RXZlbnREYXRlLmdldFRpbWUoKSkgPiBNSUxMSVNfSU5fREFZKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIENvbXBhcmUgd2Vla2RheXNcbiAgICByZXR1cm4gcHJldkV2ZW50RGF0ZS5nZXREYXkoKSAhPT0gbmV4dEV2ZW50RGF0ZS5nZXREYXkoKTtcbn1cbiJdfQ==