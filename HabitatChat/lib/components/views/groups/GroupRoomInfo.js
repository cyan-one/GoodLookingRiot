"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _createReactClass = _interopRequireDefault(require("create-react-class"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _Modal = _interopRequireDefault(require("../../../Modal"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _languageHandler = require("../../../languageHandler");

var _GroupStore = _interopRequireDefault(require("../../../stores/GroupStore"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

var _AutoHideScrollbar = _interopRequireDefault(require("../../structures/AutoHideScrollbar"));

/*
Copyright 2017 New Vector Ltd
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
var _default = (0, _createReactClass.default)({
  displayName: 'GroupRoomInfo',
  statics: {
    contextType: _MatrixClientContext.default
  },
  propTypes: {
    groupId: _propTypes.default.string,
    groupRoomId: _propTypes.default.string
  },
  getInitialState: function () {
    return {
      isUserPrivilegedInGroup: null,
      groupRoom: null,
      groupRoomPublicityLoading: false,
      groupRoomRemoveLoading: false
    };
  },
  componentDidMount: function () {
    this._initGroupStore(this.props.groupId);
  },

  // TODO: [REACT-WARNING] Replace with appropriate lifecycle event
  UNSAFE_componentWillReceiveProps(newProps) {
    if (newProps.groupId !== this.props.groupId) {
      this._unregisterGroupStore(this.props.groupId);

      this._initGroupStore(newProps.groupId);
    }
  },

  componentWillUnmount() {
    this._unregisterGroupStore(this.props.groupId);
  },

  _initGroupStore(groupId) {
    _GroupStore.default.registerListener(groupId, this.onGroupStoreUpdated);
  },

  _unregisterGroupStore(groupId) {
    _GroupStore.default.unregisterListener(this.onGroupStoreUpdated);
  },

  _updateGroupRoom() {
    this.setState({
      groupRoom: _GroupStore.default.getGroupRooms(this.props.groupId).find(r => r.roomId === this.props.groupRoomId)
    });
  },

  onGroupStoreUpdated: function () {
    this.setState({
      isUserPrivilegedInGroup: _GroupStore.default.isUserPrivileged(this.props.groupId)
    });

    this._updateGroupRoom();
  },
  _onRemove: function (e) {
    const groupId = this.props.groupId;
    const roomName = this.state.groupRoom.displayname;
    e.preventDefault();
    e.stopPropagation();
    const QuestionDialog = sdk.getComponent("dialogs.QuestionDialog");

    _Modal.default.createTrackedDialog('Confirm removal of group from room', '', QuestionDialog, {
      title: (0, _languageHandler._t)("Are you sure you want to remove '%(roomName)s' from %(groupId)s?", {
        roomName,
        groupId
      }),
      description: (0, _languageHandler._t)("Removing a room from the community will also remove it from the community page."),
      button: (0, _languageHandler._t)("Remove"),
      onFinished: proceed => {
        if (!proceed) return;
        this.setState({
          groupRoomRemoveLoading: true
        });
        const groupId = this.props.groupId;
        const roomId = this.props.groupRoomId;

        _GroupStore.default.removeRoomFromGroup(this.props.groupId, roomId).then(() => {
          _dispatcher.default.dispatch({
            action: "view_group_room_list"
          });
        }).catch(err => {
          console.error("Error whilst removing ".concat(roomId, " from ").concat(groupId), err);
          const ErrorDialog = sdk.getComponent("dialogs.ErrorDialog");

          _Modal.default.createTrackedDialog('Failed to remove room from group', '', ErrorDialog, {
            title: (0, _languageHandler._t)("Failed to remove room from community"),
            description: (0, _languageHandler._t)("Failed to remove '%(roomName)s' from %(groupId)s", {
              groupId,
              roomName
            })
          });
        }).finally(() => {
          this.setState({
            groupRoomRemoveLoading: false
          });
        });
      }
    });
  },
  _onCancel: function (e) {
    _dispatcher.default.dispatch({
      action: "view_group_room_list"
    });
  },

  _changeGroupRoomPublicity(e) {
    const isPublic = e.target.value === "public";
    this.setState({
      groupRoomPublicityLoading: true
    });
    const groupId = this.props.groupId;
    const roomId = this.props.groupRoomId;
    const roomName = this.state.groupRoom.displayname;

    _GroupStore.default.updateGroupRoomVisibility(this.props.groupId, roomId, isPublic).catch(err => {
      console.error("Error whilst changing visibility of ".concat(roomId, " in ").concat(groupId, " to ").concat(isPublic), err);
      const ErrorDialog = sdk.getComponent("dialogs.ErrorDialog");

      _Modal.default.createTrackedDialog('Failed to remove room from group', '', ErrorDialog, {
        title: (0, _languageHandler._t)("Something went wrong!"),
        description: (0, _languageHandler._t)("The visibility of '%(roomName)s' in %(groupId)s could not be updated.", {
          roomName,
          groupId
        })
      });
    }).finally(() => {
      this.setState({
        groupRoomPublicityLoading: false
      });
    });
  },

  render: function () {
    const AccessibleButton = sdk.getComponent('elements.AccessibleButton');
    const InlineSpinner = sdk.getComponent('elements.InlineSpinner');

    if (this.state.groupRoomRemoveLoading || !this.state.groupRoom) {
      const Spinner = sdk.getComponent("elements.Spinner");
      return /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo"
      }, /*#__PURE__*/_react.default.createElement(Spinner, null));
    }

    let adminTools;

    if (this.state.isUserPrivilegedInGroup) {
      adminTools = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_adminTools"
      }, /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)("Admin Tools")), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_buttons"
      }, /*#__PURE__*/_react.default.createElement(AccessibleButton, {
        className: "mx_MemberInfo_field",
        onClick: this._onRemove
      }, (0, _languageHandler._t)('Remove from community'))), /*#__PURE__*/_react.default.createElement("h3", null, (0, _languageHandler._t)('Visibility in Room List'), this.state.groupRoomPublicityLoading ? /*#__PURE__*/_react.default.createElement(InlineSpinner, null) : /*#__PURE__*/_react.default.createElement("div", null)), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("label", null, /*#__PURE__*/_react.default.createElement("input", {
        type: "radio",
        value: "public",
        checked: this.state.groupRoom.isPublic,
        onChange: this._changeGroupRoomPublicity
      }), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_label_text"
      }, (0, _languageHandler._t)('Visible to everyone')))), /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("label", null, /*#__PURE__*/_react.default.createElement("input", {
        type: "radio",
        value: "private",
        checked: !this.state.groupRoom.isPublic,
        onChange: this._changeGroupRoomPublicity
      }), /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_label_text"
      }, (0, _languageHandler._t)('Only visible to community members')))));
    }

    const avatarUrl = this.state.groupRoom.avatarUrl;
    let avatarElement;

    if (avatarUrl) {
      const httpUrl = this.context.mxcUrlToHttp(avatarUrl, 800, 800);
      avatarElement = /*#__PURE__*/_react.default.createElement("div", {
        className: "mx_MemberInfo_avatar"
      }, /*#__PURE__*/_react.default.createElement("img", {
        src: httpUrl
      }));
    }

    const groupRoomName = this.state.groupRoom.displayname;
    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo",
      role: "tabpanel"
    }, /*#__PURE__*/_react.default.createElement(_AutoHideScrollbar.default, null, /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      className: "mx_MemberInfo_cancel",
      onClick: this._onCancel
    }, /*#__PURE__*/_react.default.createElement("img", {
      src: require("../../../../res/img/cancel.svg"),
      width: "18",
      height: "18",
      className: "mx_filterFlipColor"
    })), avatarElement, /*#__PURE__*/_react.default.createElement("h2", null, groupRoomName), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MemberInfo_profileField"
    }, this.state.groupRoom.canonicalAlias)), adminTools));
  }
});

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2dyb3Vwcy9Hcm91cFJvb21JbmZvLmpzIl0sIm5hbWVzIjpbImRpc3BsYXlOYW1lIiwic3RhdGljcyIsImNvbnRleHRUeXBlIiwiTWF0cml4Q2xpZW50Q29udGV4dCIsInByb3BUeXBlcyIsImdyb3VwSWQiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJncm91cFJvb21JZCIsImdldEluaXRpYWxTdGF0ZSIsImlzVXNlclByaXZpbGVnZWRJbkdyb3VwIiwiZ3JvdXBSb29tIiwiZ3JvdXBSb29tUHVibGljaXR5TG9hZGluZyIsImdyb3VwUm9vbVJlbW92ZUxvYWRpbmciLCJjb21wb25lbnREaWRNb3VudCIsIl9pbml0R3JvdXBTdG9yZSIsInByb3BzIiwiVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJuZXdQcm9wcyIsIl91bnJlZ2lzdGVyR3JvdXBTdG9yZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiR3JvdXBTdG9yZSIsInJlZ2lzdGVyTGlzdGVuZXIiLCJvbkdyb3VwU3RvcmVVcGRhdGVkIiwidW5yZWdpc3Rlckxpc3RlbmVyIiwiX3VwZGF0ZUdyb3VwUm9vbSIsInNldFN0YXRlIiwiZ2V0R3JvdXBSb29tcyIsImZpbmQiLCJyIiwicm9vbUlkIiwiaXNVc2VyUHJpdmlsZWdlZCIsIl9vblJlbW92ZSIsImUiLCJyb29tTmFtZSIsInN0YXRlIiwiZGlzcGxheW5hbWUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsIlF1ZXN0aW9uRGlhbG9nIiwic2RrIiwiZ2V0Q29tcG9uZW50IiwiTW9kYWwiLCJjcmVhdGVUcmFja2VkRGlhbG9nIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImJ1dHRvbiIsIm9uRmluaXNoZWQiLCJwcm9jZWVkIiwicmVtb3ZlUm9vbUZyb21Hcm91cCIsInRoZW4iLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiRXJyb3JEaWFsb2ciLCJmaW5hbGx5IiwiX29uQ2FuY2VsIiwiX2NoYW5nZUdyb3VwUm9vbVB1YmxpY2l0eSIsImlzUHVibGljIiwidGFyZ2V0IiwidmFsdWUiLCJ1cGRhdGVHcm91cFJvb21WaXNpYmlsaXR5IiwicmVuZGVyIiwiQWNjZXNzaWJsZUJ1dHRvbiIsIklubGluZVNwaW5uZXIiLCJTcGlubmVyIiwiYWRtaW5Ub29scyIsImF2YXRhclVybCIsImF2YXRhckVsZW1lbnQiLCJodHRwVXJsIiwiY29udGV4dCIsIm14Y1VybFRvSHR0cCIsImdyb3VwUm9vbU5hbWUiLCJyZXF1aXJlIiwiY2Fub25pY2FsQWxpYXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQTFCQTs7Ozs7Ozs7Ozs7Ozs7OztlQTRCZSwrQkFBaUI7QUFDNUJBLEVBQUFBLFdBQVcsRUFBRSxlQURlO0FBRzVCQyxFQUFBQSxPQUFPLEVBQUU7QUFDTEMsSUFBQUEsV0FBVyxFQUFFQztBQURSLEdBSG1CO0FBTzVCQyxFQUFBQSxTQUFTLEVBQUU7QUFDUEMsSUFBQUEsT0FBTyxFQUFFQyxtQkFBVUMsTUFEWjtBQUVQQyxJQUFBQSxXQUFXLEVBQUVGLG1CQUFVQztBQUZoQixHQVBpQjtBQVk1QkUsRUFBQUEsZUFBZSxFQUFFLFlBQVc7QUFDeEIsV0FBTztBQUNIQyxNQUFBQSx1QkFBdUIsRUFBRSxJQUR0QjtBQUVIQyxNQUFBQSxTQUFTLEVBQUUsSUFGUjtBQUdIQyxNQUFBQSx5QkFBeUIsRUFBRSxLQUh4QjtBQUlIQyxNQUFBQSxzQkFBc0IsRUFBRTtBQUpyQixLQUFQO0FBTUgsR0FuQjJCO0FBcUI1QkMsRUFBQUEsaUJBQWlCLEVBQUUsWUFBVztBQUMxQixTQUFLQyxlQUFMLENBQXFCLEtBQUtDLEtBQUwsQ0FBV1gsT0FBaEM7QUFDSCxHQXZCMkI7O0FBeUI1QjtBQUNBWSxFQUFBQSxnQ0FBZ0MsQ0FBQ0MsUUFBRCxFQUFXO0FBQ3ZDLFFBQUlBLFFBQVEsQ0FBQ2IsT0FBVCxLQUFxQixLQUFLVyxLQUFMLENBQVdYLE9BQXBDLEVBQTZDO0FBQ3pDLFdBQUtjLHFCQUFMLENBQTJCLEtBQUtILEtBQUwsQ0FBV1gsT0FBdEM7O0FBQ0EsV0FBS1UsZUFBTCxDQUFxQkcsUUFBUSxDQUFDYixPQUE5QjtBQUNIO0FBQ0osR0EvQjJCOztBQWlDNUJlLEVBQUFBLG9CQUFvQixHQUFHO0FBQ25CLFNBQUtELHFCQUFMLENBQTJCLEtBQUtILEtBQUwsQ0FBV1gsT0FBdEM7QUFDSCxHQW5DMkI7O0FBcUM1QlUsRUFBQUEsZUFBZSxDQUFDVixPQUFELEVBQVU7QUFDckJnQix3QkFBV0MsZ0JBQVgsQ0FBNEJqQixPQUE1QixFQUFxQyxLQUFLa0IsbUJBQTFDO0FBQ0gsR0F2QzJCOztBQXlDNUJKLEVBQUFBLHFCQUFxQixDQUFDZCxPQUFELEVBQVU7QUFDM0JnQix3QkFBV0csa0JBQVgsQ0FBOEIsS0FBS0QsbUJBQW5DO0FBQ0gsR0EzQzJCOztBQTZDNUJFLEVBQUFBLGdCQUFnQixHQUFHO0FBQ2YsU0FBS0MsUUFBTCxDQUFjO0FBQ1ZmLE1BQUFBLFNBQVMsRUFBRVUsb0JBQVdNLGFBQVgsQ0FBeUIsS0FBS1gsS0FBTCxDQUFXWCxPQUFwQyxFQUE2Q3VCLElBQTdDLENBQ05DLENBQUQsSUFBT0EsQ0FBQyxDQUFDQyxNQUFGLEtBQWEsS0FBS2QsS0FBTCxDQUFXUixXQUR4QjtBQURELEtBQWQ7QUFLSCxHQW5EMkI7O0FBcUQ1QmUsRUFBQUEsbUJBQW1CLEVBQUUsWUFBVztBQUM1QixTQUFLRyxRQUFMLENBQWM7QUFDVmhCLE1BQUFBLHVCQUF1QixFQUFFVyxvQkFBV1UsZ0JBQVgsQ0FBNEIsS0FBS2YsS0FBTCxDQUFXWCxPQUF2QztBQURmLEtBQWQ7O0FBR0EsU0FBS29CLGdCQUFMO0FBQ0gsR0ExRDJCO0FBNEQ1Qk8sRUFBQUEsU0FBUyxFQUFFLFVBQVNDLENBQVQsRUFBWTtBQUNuQixVQUFNNUIsT0FBTyxHQUFHLEtBQUtXLEtBQUwsQ0FBV1gsT0FBM0I7QUFDQSxVQUFNNkIsUUFBUSxHQUFHLEtBQUtDLEtBQUwsQ0FBV3hCLFNBQVgsQ0FBcUJ5QixXQUF0QztBQUNBSCxJQUFBQSxDQUFDLENBQUNJLGNBQUY7QUFDQUosSUFBQUEsQ0FBQyxDQUFDSyxlQUFGO0FBQ0EsVUFBTUMsY0FBYyxHQUFHQyxHQUFHLENBQUNDLFlBQUosQ0FBaUIsd0JBQWpCLENBQXZCOztBQUNBQyxtQkFBTUMsbUJBQU4sQ0FBMEIsb0NBQTFCLEVBQWdFLEVBQWhFLEVBQW9FSixjQUFwRSxFQUFvRjtBQUNoRkssTUFBQUEsS0FBSyxFQUFFLHlCQUFHLGtFQUFILEVBQXVFO0FBQUNWLFFBQUFBLFFBQUQ7QUFBVzdCLFFBQUFBO0FBQVgsT0FBdkUsQ0FEeUU7QUFFaEZ3QyxNQUFBQSxXQUFXLEVBQUUseUJBQUcsaUZBQUgsQ0FGbUU7QUFHaEZDLE1BQUFBLE1BQU0sRUFBRSx5QkFBRyxRQUFILENBSHdFO0FBSWhGQyxNQUFBQSxVQUFVLEVBQUdDLE9BQUQsSUFBYTtBQUNyQixZQUFJLENBQUNBLE9BQUwsRUFBYztBQUNkLGFBQUt0QixRQUFMLENBQWM7QUFBQ2IsVUFBQUEsc0JBQXNCLEVBQUU7QUFBekIsU0FBZDtBQUNBLGNBQU1SLE9BQU8sR0FBRyxLQUFLVyxLQUFMLENBQVdYLE9BQTNCO0FBQ0EsY0FBTXlCLE1BQU0sR0FBRyxLQUFLZCxLQUFMLENBQVdSLFdBQTFCOztBQUNBYSw0QkFBVzRCLG1CQUFYLENBQStCLEtBQUtqQyxLQUFMLENBQVdYLE9BQTFDLEVBQW1EeUIsTUFBbkQsRUFBMkRvQixJQUEzRCxDQUFnRSxNQUFNO0FBQ2xFQyw4QkFBSUMsUUFBSixDQUFhO0FBQ1RDLFlBQUFBLE1BQU0sRUFBRTtBQURDLFdBQWI7QUFHSCxTQUpELEVBSUdDLEtBSkgsQ0FJVUMsR0FBRCxJQUFTO0FBQ2RDLFVBQUFBLE9BQU8sQ0FBQ0MsS0FBUixpQ0FBdUMzQixNQUF2QyxtQkFBc0R6QixPQUF0RCxHQUFpRWtELEdBQWpFO0FBQ0EsZ0JBQU1HLFdBQVcsR0FBR2xCLEdBQUcsQ0FBQ0MsWUFBSixDQUFpQixxQkFBakIsQ0FBcEI7O0FBQ0FDLHlCQUFNQyxtQkFBTixDQUEwQixrQ0FBMUIsRUFBOEQsRUFBOUQsRUFBa0VlLFdBQWxFLEVBQStFO0FBQzNFZCxZQUFBQSxLQUFLLEVBQUUseUJBQUcsc0NBQUgsQ0FEb0U7QUFFM0VDLFlBQUFBLFdBQVcsRUFBRSx5QkFDVCxrREFEUyxFQUMyQztBQUFDeEMsY0FBQUEsT0FBRDtBQUFVNkIsY0FBQUE7QUFBVixhQUQzQztBQUY4RCxXQUEvRTtBQU1ILFNBYkQsRUFhR3lCLE9BYkgsQ0FhVyxNQUFNO0FBQ2IsZUFBS2pDLFFBQUwsQ0FBYztBQUFDYixZQUFBQSxzQkFBc0IsRUFBRTtBQUF6QixXQUFkO0FBQ0gsU0FmRDtBQWdCSDtBQXpCK0UsS0FBcEY7QUEyQkgsR0E3RjJCO0FBK0Y1QitDLEVBQUFBLFNBQVMsRUFBRSxVQUFTM0IsQ0FBVCxFQUFZO0FBQ25Ca0Isd0JBQUlDLFFBQUosQ0FBYTtBQUNUQyxNQUFBQSxNQUFNLEVBQUU7QUFEQyxLQUFiO0FBR0gsR0FuRzJCOztBQXFHNUJRLEVBQUFBLHlCQUF5QixDQUFDNUIsQ0FBRCxFQUFJO0FBQ3pCLFVBQU02QixRQUFRLEdBQUc3QixDQUFDLENBQUM4QixNQUFGLENBQVNDLEtBQVQsS0FBbUIsUUFBcEM7QUFDQSxTQUFLdEMsUUFBTCxDQUFjO0FBQ1ZkLE1BQUFBLHlCQUF5QixFQUFFO0FBRGpCLEtBQWQ7QUFHQSxVQUFNUCxPQUFPLEdBQUcsS0FBS1csS0FBTCxDQUFXWCxPQUEzQjtBQUNBLFVBQU15QixNQUFNLEdBQUcsS0FBS2QsS0FBTCxDQUFXUixXQUExQjtBQUNBLFVBQU0wQixRQUFRLEdBQUcsS0FBS0MsS0FBTCxDQUFXeEIsU0FBWCxDQUFxQnlCLFdBQXRDOztBQUNBZix3QkFBVzRDLHlCQUFYLENBQXFDLEtBQUtqRCxLQUFMLENBQVdYLE9BQWhELEVBQXlEeUIsTUFBekQsRUFBaUVnQyxRQUFqRSxFQUEyRVIsS0FBM0UsQ0FBa0ZDLEdBQUQsSUFBUztBQUN0RkMsTUFBQUEsT0FBTyxDQUFDQyxLQUFSLCtDQUFxRDNCLE1BQXJELGlCQUFrRXpCLE9BQWxFLGlCQUFnRnlELFFBQWhGLEdBQTRGUCxHQUE1RjtBQUNBLFlBQU1HLFdBQVcsR0FBR2xCLEdBQUcsQ0FBQ0MsWUFBSixDQUFpQixxQkFBakIsQ0FBcEI7O0FBQ0FDLHFCQUFNQyxtQkFBTixDQUEwQixrQ0FBMUIsRUFBOEQsRUFBOUQsRUFBa0VlLFdBQWxFLEVBQStFO0FBQzNFZCxRQUFBQSxLQUFLLEVBQUUseUJBQUcsdUJBQUgsQ0FEb0U7QUFFM0VDLFFBQUFBLFdBQVcsRUFBRSx5QkFDVCx1RUFEUyxFQUVUO0FBQUNYLFVBQUFBLFFBQUQ7QUFBVzdCLFVBQUFBO0FBQVgsU0FGUztBQUY4RCxPQUEvRTtBQU9ILEtBVkQsRUFVR3NELE9BVkgsQ0FVVyxNQUFNO0FBQ2IsV0FBS2pDLFFBQUwsQ0FBYztBQUNWZCxRQUFBQSx5QkFBeUIsRUFBRTtBQURqQixPQUFkO0FBR0gsS0FkRDtBQWVILEdBNUgyQjs7QUE4SDVCc0QsRUFBQUEsTUFBTSxFQUFFLFlBQVc7QUFDZixVQUFNQyxnQkFBZ0IsR0FBRzNCLEdBQUcsQ0FBQ0MsWUFBSixDQUFpQiwyQkFBakIsQ0FBekI7QUFDQSxVQUFNMkIsYUFBYSxHQUFHNUIsR0FBRyxDQUFDQyxZQUFKLENBQWlCLHdCQUFqQixDQUF0Qjs7QUFDQSxRQUFJLEtBQUtOLEtBQUwsQ0FBV3RCLHNCQUFYLElBQXFDLENBQUMsS0FBS3NCLEtBQUwsQ0FBV3hCLFNBQXJELEVBQWdFO0FBQzVELFlBQU0wRCxPQUFPLEdBQUc3QixHQUFHLENBQUNDLFlBQUosQ0FBaUIsa0JBQWpCLENBQWhCO0FBQ0EsMEJBQU87QUFBSyxRQUFBLFNBQVMsRUFBQztBQUFmLHNCQUNILDZCQUFDLE9BQUQsT0FERyxDQUFQO0FBR0g7O0FBRUQsUUFBSTZCLFVBQUo7O0FBQ0EsUUFBSSxLQUFLbkMsS0FBTCxDQUFXekIsdUJBQWYsRUFBd0M7QUFDcEM0RCxNQUFBQSxVQUFVLGdCQUNOO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDSSx5Q0FBTSx5QkFBRyxhQUFILENBQU4sQ0FESixlQUVJO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDSSw2QkFBQyxnQkFBRDtBQUFrQixRQUFBLFNBQVMsRUFBQyxxQkFBNUI7QUFBa0QsUUFBQSxPQUFPLEVBQUUsS0FBS3RDO0FBQWhFLFNBQ00seUJBQUcsdUJBQUgsQ0FETixDQURKLENBRkosZUFPSSx5Q0FDTSx5QkFBRyx5QkFBSCxDQUROLEVBRU0sS0FBS0csS0FBTCxDQUFXdkIseUJBQVgsZ0JBQ0UsNkJBQUMsYUFBRCxPQURGLGdCQUNzQix5Q0FINUIsQ0FQSixlQWFJLHVEQUNJLHlEQUNJO0FBQU8sUUFBQSxJQUFJLEVBQUMsT0FBWjtBQUNJLFFBQUEsS0FBSyxFQUFDLFFBRFY7QUFFSSxRQUFBLE9BQU8sRUFBRSxLQUFLdUIsS0FBTCxDQUFXeEIsU0FBWCxDQUFxQm1ELFFBRmxDO0FBR0ksUUFBQSxRQUFRLEVBQUUsS0FBS0Q7QUFIbkIsUUFESixlQU1JO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixTQUNNLHlCQUFHLHFCQUFILENBRE4sQ0FOSixDQURKLENBYkosZUF5QkksdURBQ0kseURBQ0k7QUFBTyxRQUFBLElBQUksRUFBQyxPQUFaO0FBQ0ksUUFBQSxLQUFLLEVBQUMsU0FEVjtBQUVJLFFBQUEsT0FBTyxFQUFFLENBQUMsS0FBSzFCLEtBQUwsQ0FBV3hCLFNBQVgsQ0FBcUJtRCxRQUZuQztBQUdJLFFBQUEsUUFBUSxFQUFFLEtBQUtEO0FBSG5CLFFBREosZUFNSTtBQUFLLFFBQUEsU0FBUyxFQUFDO0FBQWYsU0FDTSx5QkFBRyxtQ0FBSCxDQUROLENBTkosQ0FESixDQXpCSixDQURKO0FBdUNIOztBQUVELFVBQU1VLFNBQVMsR0FBRyxLQUFLcEMsS0FBTCxDQUFXeEIsU0FBWCxDQUFxQjRELFNBQXZDO0FBQ0EsUUFBSUMsYUFBSjs7QUFDQSxRQUFJRCxTQUFKLEVBQWU7QUFDWCxZQUFNRSxPQUFPLEdBQUcsS0FBS0MsT0FBTCxDQUFhQyxZQUFiLENBQTBCSixTQUExQixFQUFxQyxHQUFyQyxFQUEwQyxHQUExQyxDQUFoQjtBQUNBQyxNQUFBQSxhQUFhLGdCQUFJO0FBQUssUUFBQSxTQUFTLEVBQUM7QUFBZixzQkFDRDtBQUFLLFFBQUEsR0FBRyxFQUFFQztBQUFWLFFBREMsQ0FBakI7QUFHSDs7QUFFRCxVQUFNRyxhQUFhLEdBQUcsS0FBS3pDLEtBQUwsQ0FBV3hCLFNBQVgsQ0FBcUJ5QixXQUEzQztBQUNBLHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUMsZUFBZjtBQUErQixNQUFBLElBQUksRUFBQztBQUFwQyxvQkFDSSw2QkFBQywwQkFBRCxxQkFDSSw2QkFBQyxnQkFBRDtBQUFrQixNQUFBLFNBQVMsRUFBQyxzQkFBNUI7QUFBbUQsTUFBQSxPQUFPLEVBQUUsS0FBS3dCO0FBQWpFLG9CQUNJO0FBQUssTUFBQSxHQUFHLEVBQUVpQixPQUFPLENBQUMsZ0NBQUQsQ0FBakI7QUFBcUQsTUFBQSxLQUFLLEVBQUMsSUFBM0Q7QUFBZ0UsTUFBQSxNQUFNLEVBQUMsSUFBdkU7QUFBNEUsTUFBQSxTQUFTLEVBQUM7QUFBdEYsTUFESixDQURKLEVBSU1MLGFBSk4sZUFNSSx5Q0FBTUksYUFBTixDQU5KLGVBUUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUNNLEtBQUt6QyxLQUFMLENBQVd4QixTQUFYLENBQXFCbUUsY0FEM0IsQ0FESixDQVJKLEVBY01SLFVBZE4sQ0FESixDQURKO0FBb0JIO0FBak4yQixDQUFqQixDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE3IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IGNyZWF0ZVJlYWN0Q2xhc3MgZnJvbSAnY3JlYXRlLXJlYWN0LWNsYXNzJztcbmltcG9ydCBkaXMgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCBNb2RhbCBmcm9tICcuLi8uLi8uLi9Nb2RhbCc7XG5pbXBvcnQgKiBhcyBzZGsgZnJvbSAnLi4vLi4vLi4vaW5kZXgnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IEdyb3VwU3RvcmUgZnJvbSAnLi4vLi4vLi4vc3RvcmVzL0dyb3VwU3RvcmUnO1xuaW1wb3J0IE1hdHJpeENsaWVudENvbnRleHQgZnJvbSBcIi4uLy4uLy4uL2NvbnRleHRzL01hdHJpeENsaWVudENvbnRleHRcIjtcbmltcG9ydCBBdXRvSGlkZVNjcm9sbGJhciBmcm9tIFwiLi4vLi4vc3RydWN0dXJlcy9BdXRvSGlkZVNjcm9sbGJhclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVSZWFjdENsYXNzKHtcbiAgICBkaXNwbGF5TmFtZTogJ0dyb3VwUm9vbUluZm8nLFxuXG4gICAgc3RhdGljczoge1xuICAgICAgICBjb250ZXh0VHlwZTogTWF0cml4Q2xpZW50Q29udGV4dCxcbiAgICB9LFxuXG4gICAgcHJvcFR5cGVzOiB7XG4gICAgICAgIGdyb3VwSWQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIGdyb3VwUm9vbUlkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIH0sXG5cbiAgICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaXNVc2VyUHJpdmlsZWdlZEluR3JvdXA6IG51bGwsXG4gICAgICAgICAgICBncm91cFJvb206IG51bGwsXG4gICAgICAgICAgICBncm91cFJvb21QdWJsaWNpdHlMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIGdyb3VwUm9vbVJlbW92ZUxvYWRpbmc6IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuX2luaXRHcm91cFN0b3JlKHRoaXMucHJvcHMuZ3JvdXBJZCk7XG4gICAgfSxcblxuICAgIC8vIFRPRE86IFtSRUFDVC1XQVJOSU5HXSBSZXBsYWNlIHdpdGggYXBwcm9wcmlhdGUgbGlmZWN5Y2xlIGV2ZW50XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV3UHJvcHMpIHtcbiAgICAgICAgaWYgKG5ld1Byb3BzLmdyb3VwSWQgIT09IHRoaXMucHJvcHMuZ3JvdXBJZCkge1xuICAgICAgICAgICAgdGhpcy5fdW5yZWdpc3Rlckdyb3VwU3RvcmUodGhpcy5wcm9wcy5ncm91cElkKTtcbiAgICAgICAgICAgIHRoaXMuX2luaXRHcm91cFN0b3JlKG5ld1Byb3BzLmdyb3VwSWQpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLl91bnJlZ2lzdGVyR3JvdXBTdG9yZSh0aGlzLnByb3BzLmdyb3VwSWQpO1xuICAgIH0sXG5cbiAgICBfaW5pdEdyb3VwU3RvcmUoZ3JvdXBJZCkge1xuICAgICAgICBHcm91cFN0b3JlLnJlZ2lzdGVyTGlzdGVuZXIoZ3JvdXBJZCwgdGhpcy5vbkdyb3VwU3RvcmVVcGRhdGVkKTtcbiAgICB9LFxuXG4gICAgX3VucmVnaXN0ZXJHcm91cFN0b3JlKGdyb3VwSWQpIHtcbiAgICAgICAgR3JvdXBTdG9yZS51bnJlZ2lzdGVyTGlzdGVuZXIodGhpcy5vbkdyb3VwU3RvcmVVcGRhdGVkKTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZUdyb3VwUm9vbSgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBncm91cFJvb206IEdyb3VwU3RvcmUuZ2V0R3JvdXBSb29tcyh0aGlzLnByb3BzLmdyb3VwSWQpLmZpbmQoXG4gICAgICAgICAgICAgICAgKHIpID0+IHIucm9vbUlkID09PSB0aGlzLnByb3BzLmdyb3VwUm9vbUlkLFxuICAgICAgICAgICAgKSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIG9uR3JvdXBTdG9yZVVwZGF0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGlzVXNlclByaXZpbGVnZWRJbkdyb3VwOiBHcm91cFN0b3JlLmlzVXNlclByaXZpbGVnZWQodGhpcy5wcm9wcy5ncm91cElkKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUdyb3VwUm9vbSgpO1xuICAgIH0sXG5cbiAgICBfb25SZW1vdmU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgY29uc3QgZ3JvdXBJZCA9IHRoaXMucHJvcHMuZ3JvdXBJZDtcbiAgICAgICAgY29uc3Qgcm9vbU5hbWUgPSB0aGlzLnN0YXRlLmdyb3VwUm9vbS5kaXNwbGF5bmFtZTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBjb25zdCBRdWVzdGlvbkRpYWxvZyA9IHNkay5nZXRDb21wb25lbnQoXCJkaWFsb2dzLlF1ZXN0aW9uRGlhbG9nXCIpO1xuICAgICAgICBNb2RhbC5jcmVhdGVUcmFja2VkRGlhbG9nKCdDb25maXJtIHJlbW92YWwgb2YgZ3JvdXAgZnJvbSByb29tJywgJycsIFF1ZXN0aW9uRGlhbG9nLCB7XG4gICAgICAgICAgICB0aXRsZTogX3QoXCJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVtb3ZlICclKHJvb21OYW1lKXMnIGZyb20gJShncm91cElkKXM/XCIsIHtyb29tTmFtZSwgZ3JvdXBJZH0pLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KFwiUmVtb3ZpbmcgYSByb29tIGZyb20gdGhlIGNvbW11bml0eSB3aWxsIGFsc28gcmVtb3ZlIGl0IGZyb20gdGhlIGNvbW11bml0eSBwYWdlLlwiKSxcbiAgICAgICAgICAgIGJ1dHRvbjogX3QoXCJSZW1vdmVcIiksXG4gICAgICAgICAgICBvbkZpbmlzaGVkOiAocHJvY2VlZCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcHJvY2VlZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe2dyb3VwUm9vbVJlbW92ZUxvYWRpbmc6IHRydWV9KTtcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cElkID0gdGhpcy5wcm9wcy5ncm91cElkO1xuICAgICAgICAgICAgICAgIGNvbnN0IHJvb21JZCA9IHRoaXMucHJvcHMuZ3JvdXBSb29tSWQ7XG4gICAgICAgICAgICAgICAgR3JvdXBTdG9yZS5yZW1vdmVSb29tRnJvbUdyb3VwKHRoaXMucHJvcHMuZ3JvdXBJZCwgcm9vbUlkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZGlzLmRpc3BhdGNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjogXCJ2aWV3X2dyb3VwX3Jvb21fbGlzdFwiLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHdoaWxzdCByZW1vdmluZyAke3Jvb21JZH0gZnJvbSAke2dyb3VwSWR9YCwgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgRXJyb3JEaWFsb2cgPSBzZGsuZ2V0Q29tcG9uZW50KFwiZGlhbG9ncy5FcnJvckRpYWxvZ1wiKTtcbiAgICAgICAgICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRmFpbGVkIHRvIHJlbW92ZSByb29tIGZyb20gZ3JvdXAnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBfdChcIkZhaWxlZCB0byByZW1vdmUgcm9vbSBmcm9tIGNvbW11bml0eVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkZhaWxlZCB0byByZW1vdmUgJyUocm9vbU5hbWUpcycgZnJvbSAlKGdyb3VwSWQpc1wiLCB7Z3JvdXBJZCwgcm9vbU5hbWV9LFxuICAgICAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe2dyb3VwUm9vbVJlbW92ZUxvYWRpbmc6IGZhbHNlfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgX29uQ2FuY2VsOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246IFwidmlld19ncm91cF9yb29tX2xpc3RcIixcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIF9jaGFuZ2VHcm91cFJvb21QdWJsaWNpdHkoZSkge1xuICAgICAgICBjb25zdCBpc1B1YmxpYyA9IGUudGFyZ2V0LnZhbHVlID09PSBcInB1YmxpY1wiO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGdyb3VwUm9vbVB1YmxpY2l0eUxvYWRpbmc6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBncm91cElkID0gdGhpcy5wcm9wcy5ncm91cElkO1xuICAgICAgICBjb25zdCByb29tSWQgPSB0aGlzLnByb3BzLmdyb3VwUm9vbUlkO1xuICAgICAgICBjb25zdCByb29tTmFtZSA9IHRoaXMuc3RhdGUuZ3JvdXBSb29tLmRpc3BsYXluYW1lO1xuICAgICAgICBHcm91cFN0b3JlLnVwZGF0ZUdyb3VwUm9vbVZpc2liaWxpdHkodGhpcy5wcm9wcy5ncm91cElkLCByb29tSWQsIGlzUHVibGljKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciB3aGlsc3QgY2hhbmdpbmcgdmlzaWJpbGl0eSBvZiAke3Jvb21JZH0gaW4gJHtncm91cElkfSB0byAke2lzUHVibGljfWAsIGVycik7XG4gICAgICAgICAgICBjb25zdCBFcnJvckRpYWxvZyA9IHNkay5nZXRDb21wb25lbnQoXCJkaWFsb2dzLkVycm9yRGlhbG9nXCIpO1xuICAgICAgICAgICAgTW9kYWwuY3JlYXRlVHJhY2tlZERpYWxvZygnRmFpbGVkIHRvIHJlbW92ZSByb29tIGZyb20gZ3JvdXAnLCAnJywgRXJyb3JEaWFsb2csIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogX3QoXCJTb21ldGhpbmcgd2VudCB3cm9uZyFcIiksXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IF90KFxuICAgICAgICAgICAgICAgICAgICBcIlRoZSB2aXNpYmlsaXR5IG9mICclKHJvb21OYW1lKXMnIGluICUoZ3JvdXBJZClzIGNvdWxkIG5vdCBiZSB1cGRhdGVkLlwiLFxuICAgICAgICAgICAgICAgICAgICB7cm9vbU5hbWUsIGdyb3VwSWR9LFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBncm91cFJvb21QdWJsaWNpdHlMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgQWNjZXNzaWJsZUJ1dHRvbiA9IHNkay5nZXRDb21wb25lbnQoJ2VsZW1lbnRzLkFjY2Vzc2libGVCdXR0b24nKTtcbiAgICAgICAgY29uc3QgSW5saW5lU3Bpbm5lciA9IHNkay5nZXRDb21wb25lbnQoJ2VsZW1lbnRzLklubGluZVNwaW5uZXInKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuZ3JvdXBSb29tUmVtb3ZlTG9hZGluZyB8fCAhdGhpcy5zdGF0ZS5ncm91cFJvb20pIHtcbiAgICAgICAgICAgIGNvbnN0IFNwaW5uZXIgPSBzZGsuZ2V0Q29tcG9uZW50KFwiZWxlbWVudHMuU3Bpbm5lclwiKTtcbiAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9cIj5cbiAgICAgICAgICAgICAgICA8U3Bpbm5lciAvPlxuICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGFkbWluVG9vbHM7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmlzVXNlclByaXZpbGVnZWRJbkdyb3VwKSB7XG4gICAgICAgICAgICBhZG1pblRvb2xzID1cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fYWRtaW5Ub29sc1wiPlxuICAgICAgICAgICAgICAgICAgICA8aDM+eyBfdChcIkFkbWluIFRvb2xzXCIpIH08L2gzPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fYnV0dG9uc1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFjY2Vzc2libGVCdXR0b24gY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19maWVsZFwiIG9uQ2xpY2s9e3RoaXMuX29uUmVtb3ZlfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdSZW1vdmUgZnJvbSBjb21tdW5pdHknKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8aDM+XG4gICAgICAgICAgICAgICAgICAgICAgICB7IF90KCdWaXNpYmlsaXR5IGluIFJvb20gTGlzdCcpIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHsgdGhpcy5zdGF0ZS5ncm91cFJvb21QdWJsaWNpdHlMb2FkaW5nID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5saW5lU3Bpbm5lciAvPiA6IDxkaXYgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9XCJwdWJsaWNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXt0aGlzLnN0YXRlLmdyb3VwUm9vbS5pc1B1YmxpY31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX2NoYW5nZUdyb3VwUm9vbVB1YmxpY2l0eX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19sYWJlbF90ZXh0XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgX3QoJ1Zpc2libGUgdG8gZXZlcnlvbmUnKSB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cInJhZGlvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9XCJwcml2YXRlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17IXRoaXMuc3RhdGUuZ3JvdXBSb29tLmlzUHVibGljfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fY2hhbmdlR3JvdXBSb29tUHVibGljaXR5fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9NZW1iZXJJbmZvX2xhYmVsX3RleHRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyBfdCgnT25seSB2aXNpYmxlIHRvIGNvbW11bml0eSBtZW1iZXJzJykgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyVXJsID0gdGhpcy5zdGF0ZS5ncm91cFJvb20uYXZhdGFyVXJsO1xuICAgICAgICBsZXQgYXZhdGFyRWxlbWVudDtcbiAgICAgICAgaWYgKGF2YXRhclVybCkge1xuICAgICAgICAgICAgY29uc3QgaHR0cFVybCA9IHRoaXMuY29udGV4dC5teGNVcmxUb0h0dHAoYXZhdGFyVXJsLCA4MDAsIDgwMCk7XG4gICAgICAgICAgICBhdmF0YXJFbGVtZW50ID0gKDxkaXYgY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19hdmF0YXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW1nIHNyYz17aHR0cFVybH0gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBncm91cFJvb21OYW1lID0gdGhpcy5zdGF0ZS5ncm91cFJvb20uZGlzcGxheW5hbWU7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9cIiByb2xlPVwidGFicGFuZWxcIj5cbiAgICAgICAgICAgICAgICA8QXV0b0hpZGVTY3JvbGxiYXI+XG4gICAgICAgICAgICAgICAgICAgIDxBY2Nlc3NpYmxlQnV0dG9uIGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fY2FuY2VsXCIgb25DbGljaz17dGhpcy5fb25DYW5jZWx9PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9e3JlcXVpcmUoXCIuLi8uLi8uLi8uLi9yZXMvaW1nL2NhbmNlbC5zdmdcIil9IHdpZHRoPVwiMThcIiBoZWlnaHQ9XCIxOFwiIGNsYXNzTmFtZT1cIm14X2ZpbHRlckZsaXBDb2xvclwiIC8+XG4gICAgICAgICAgICAgICAgICAgIDwvQWNjZXNzaWJsZUJ1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgeyBhdmF0YXJFbGVtZW50IH1cblxuICAgICAgICAgICAgICAgICAgICA8aDI+eyBncm91cFJvb21OYW1lIH08L2gyPlxuXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfTWVtYmVySW5mb19wcm9maWxlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X01lbWJlckluZm9fcHJvZmlsZUZpZWxkXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0aGlzLnN0YXRlLmdyb3VwUm9vbS5jYW5vbmljYWxBbGlhcyB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgeyBhZG1pblRvb2xzIH1cbiAgICAgICAgICAgICAgICA8L0F1dG9IaWRlU2Nyb2xsYmFyPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgfSxcbn0pO1xuIl19