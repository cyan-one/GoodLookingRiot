"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _createReactClass = _interopRequireDefault(require("create-react-class"));

var _reactBeautifulDnd = require("react-beautiful-dnd");

var sdk = _interopRequireWildcard(require("../../../index"));

var _dispatcher = _interopRequireDefault(require("../../../dispatcher/dispatcher"));

var _FlairStore = _interopRequireDefault(require("../../../stores/FlairStore"));

var _MatrixClientContext = _interopRequireDefault(require("../../../contexts/MatrixClientContext"));

/*
Copyright 2017 Vector Creations Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
function nop() {}

const GroupTile = (0, _createReactClass.default)({
  displayName: 'GroupTile',
  propTypes: {
    groupId: _propTypes.default.string.isRequired,
    // Whether to show the short description of the group on the tile
    showDescription: _propTypes.default.bool,
    // Height of the group avatar in pixels
    avatarHeight: _propTypes.default.number,
    draggable: _propTypes.default.bool
  },
  statics: {
    contextType: _MatrixClientContext.default
  },

  getInitialState() {
    return {
      profile: null
    };
  },

  getDefaultProps() {
    return {
      showDescription: true,
      avatarHeight: 50,
      draggable: true
    };
  },

  componentDidMount: function () {
    _FlairStore.default.getGroupProfileCached(this.context, this.props.groupId).then(profile => {
      this.setState({
        profile
      });
    }).catch(err => {
      console.error('Error whilst getting cached profile for GroupTile', err);
    });
  },
  onMouseDown: function (e) {
    e.preventDefault();

    _dispatcher.default.dispatch({
      action: 'view_group',
      group_id: this.props.groupId
    });
  },
  render: function () {
    const BaseAvatar = sdk.getComponent('avatars.BaseAvatar');
    const AccessibleButton = sdk.getComponent('elements.AccessibleButton');
    const profile = this.state.profile || {};
    const name = profile.name || this.props.groupId;
    const avatarHeight = this.props.avatarHeight;
    const descElement = this.props.showDescription ? /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_desc"
    }, profile.shortDescription) : /*#__PURE__*/_react.default.createElement("div", null);
    const httpUrl = profile.avatarUrl ? this.context.mxcUrlToHttp(profile.avatarUrl, avatarHeight, avatarHeight, "crop") : null;

    let avatarElement = /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_avatar"
    }, /*#__PURE__*/_react.default.createElement(BaseAvatar, {
      name: name,
      idName: this.props.groupId,
      url: httpUrl,
      width: avatarHeight,
      height: avatarHeight
    }));

    if (this.props.draggable) {
      const avatarClone = avatarElement;
      avatarElement = /*#__PURE__*/_react.default.createElement(_reactBeautifulDnd.Droppable, {
        droppableId: "my-groups-droppable",
        type: "draggable-TagTile"
      }, (droppableProvided, droppableSnapshot) => /*#__PURE__*/_react.default.createElement("div", {
        ref: droppableProvided.innerRef
      }, /*#__PURE__*/_react.default.createElement(_reactBeautifulDnd.Draggable, {
        key: "GroupTile " + this.props.groupId,
        draggableId: "GroupTile " + this.props.groupId,
        index: this.props.groupId,
        type: "draggable-TagTile"
      }, (provided, snapshot) => /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement("div", (0, _extends2.default)({
        ref: provided.innerRef
      }, provided.draggableProps, provided.dragHandleProps), avatarClone), provided.placeholder ? avatarClone : /*#__PURE__*/_react.default.createElement("div", null)))));
    } // XXX: Use onMouseDown as a workaround for https://github.com/atlassian/react-beautiful-dnd/issues/273
    // instead of onClick. Otherwise we experience https://github.com/vector-im/riot-web/issues/6156


    return /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      className: "mx_GroupTile",
      onMouseDown: this.onMouseDown,
      onClick: nop
    }, avatarElement, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_name"
    }, name), descElement, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_GroupTile_groupId"
    }, this.props.groupId)));
  }
});
var _default = GroupTile;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2dyb3Vwcy9Hcm91cFRpbGUuanMiXSwibmFtZXMiOlsibm9wIiwiR3JvdXBUaWxlIiwiZGlzcGxheU5hbWUiLCJwcm9wVHlwZXMiLCJncm91cElkIiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsInNob3dEZXNjcmlwdGlvbiIsImJvb2wiLCJhdmF0YXJIZWlnaHQiLCJudW1iZXIiLCJkcmFnZ2FibGUiLCJzdGF0aWNzIiwiY29udGV4dFR5cGUiLCJNYXRyaXhDbGllbnRDb250ZXh0IiwiZ2V0SW5pdGlhbFN0YXRlIiwicHJvZmlsZSIsImdldERlZmF1bHRQcm9wcyIsImNvbXBvbmVudERpZE1vdW50IiwiRmxhaXJTdG9yZSIsImdldEdyb3VwUHJvZmlsZUNhY2hlZCIsImNvbnRleHQiLCJwcm9wcyIsInRoZW4iLCJzZXRTdGF0ZSIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwib25Nb3VzZURvd24iLCJlIiwicHJldmVudERlZmF1bHQiLCJkaXMiLCJkaXNwYXRjaCIsImFjdGlvbiIsImdyb3VwX2lkIiwicmVuZGVyIiwiQmFzZUF2YXRhciIsInNkayIsImdldENvbXBvbmVudCIsIkFjY2Vzc2libGVCdXR0b24iLCJzdGF0ZSIsIm5hbWUiLCJkZXNjRWxlbWVudCIsInNob3J0RGVzY3JpcHRpb24iLCJodHRwVXJsIiwiYXZhdGFyVXJsIiwibXhjVXJsVG9IdHRwIiwiYXZhdGFyRWxlbWVudCIsImF2YXRhckNsb25lIiwiZHJvcHBhYmxlUHJvdmlkZWQiLCJkcm9wcGFibGVTbmFwc2hvdCIsImlubmVyUmVmIiwicHJvdmlkZWQiLCJzbmFwc2hvdCIsImRyYWdnYWJsZVByb3BzIiwiZHJhZ0hhbmRsZVByb3BzIiwicGxhY2Vob2xkZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFnQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7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cUNOLElBQXJDLENBREosRUFFTUMsV0FGTixlQUdJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixPQUF3QyxLQUFLckIsS0FBTCxDQUFXbkIsT0FBbkQsQ0FISixDQUZHLENBQVA7QUFRSDtBQTlHOEIsQ0FBakIsQ0FBbEI7ZUFpSGVILFMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTcgVmVjdG9yIENyZWF0aW9ucyBMdGRcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBjcmVhdGVSZWFjdENsYXNzIGZyb20gJ2NyZWF0ZS1yZWFjdC1jbGFzcyc7XG5pbXBvcnQgeyBEcmFnZ2FibGUsIERyb3BwYWJsZSB9IGZyb20gJ3JlYWN0LWJlYXV0aWZ1bC1kbmQnO1xuaW1wb3J0ICogYXMgc2RrIGZyb20gJy4uLy4uLy4uL2luZGV4JztcbmltcG9ydCBkaXMgZnJvbSAnLi4vLi4vLi4vZGlzcGF0Y2hlci9kaXNwYXRjaGVyJztcbmltcG9ydCBGbGFpclN0b3JlIGZyb20gJy4uLy4uLy4uL3N0b3Jlcy9GbGFpclN0b3JlJztcbmltcG9ydCBNYXRyaXhDbGllbnRDb250ZXh0IGZyb20gXCIuLi8uLi8uLi9jb250ZXh0cy9NYXRyaXhDbGllbnRDb250ZXh0XCI7XG5cbmZ1bmN0aW9uIG5vcCgpIHt9XG5cbmNvbnN0IEdyb3VwVGlsZSA9IGNyZWF0ZVJlYWN0Q2xhc3Moe1xuICAgIGRpc3BsYXlOYW1lOiAnR3JvdXBUaWxlJyxcblxuICAgIHByb3BUeXBlczoge1xuICAgICAgICBncm91cElkOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgICAgIC8vIFdoZXRoZXIgdG8gc2hvdyB0aGUgc2hvcnQgZGVzY3JpcHRpb24gb2YgdGhlIGdyb3VwIG9uIHRoZSB0aWxlXG4gICAgICAgIHNob3dEZXNjcmlwdGlvbjogUHJvcFR5cGVzLmJvb2wsXG4gICAgICAgIC8vIEhlaWdodCBvZiB0aGUgZ3JvdXAgYXZhdGFyIGluIHBpeGVsc1xuICAgICAgICBhdmF0YXJIZWlnaHQ6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgICAgIGRyYWdnYWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgfSxcblxuICAgIHN0YXRpY3M6IHtcbiAgICAgICAgY29udGV4dFR5cGU6IE1hdHJpeENsaWVudENvbnRleHQsXG4gICAgfSxcblxuICAgIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHByb2ZpbGU6IG51bGwsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNob3dEZXNjcmlwdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIGF2YXRhckhlaWdodDogNTAsXG4gICAgICAgICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICAgIH07XG4gICAgfSxcblxuICAgIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgRmxhaXJTdG9yZS5nZXRHcm91cFByb2ZpbGVDYWNoZWQodGhpcy5jb250ZXh0LCB0aGlzLnByb3BzLmdyb3VwSWQpLnRoZW4oKHByb2ZpbGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe3Byb2ZpbGV9KTtcbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igd2hpbHN0IGdldHRpbmcgY2FjaGVkIHByb2ZpbGUgZm9yIEdyb3VwVGlsZScsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGRpcy5kaXNwYXRjaCh7XG4gICAgICAgICAgICBhY3Rpb246ICd2aWV3X2dyb3VwJyxcbiAgICAgICAgICAgIGdyb3VwX2lkOiB0aGlzLnByb3BzLmdyb3VwSWQsXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zdCBCYXNlQXZhdGFyID0gc2RrLmdldENvbXBvbmVudCgnYXZhdGFycy5CYXNlQXZhdGFyJyk7XG4gICAgICAgIGNvbnN0IEFjY2Vzc2libGVCdXR0b24gPSBzZGsuZ2V0Q29tcG9uZW50KCdlbGVtZW50cy5BY2Nlc3NpYmxlQnV0dG9uJyk7XG4gICAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnN0YXRlLnByb2ZpbGUgfHwge307XG4gICAgICAgIGNvbnN0IG5hbWUgPSBwcm9maWxlLm5hbWUgfHwgdGhpcy5wcm9wcy5ncm91cElkO1xuICAgICAgICBjb25zdCBhdmF0YXJIZWlnaHQgPSB0aGlzLnByb3BzLmF2YXRhckhlaWdodDtcbiAgICAgICAgY29uc3QgZGVzY0VsZW1lbnQgPSB0aGlzLnByb3BzLnNob3dEZXNjcmlwdGlvbiA/XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0dyb3VwVGlsZV9kZXNjXCI+eyBwcm9maWxlLnNob3J0RGVzY3JpcHRpb24gfTwvZGl2PiA6XG4gICAgICAgICAgICA8ZGl2IC8+O1xuICAgICAgICBjb25zdCBodHRwVXJsID0gcHJvZmlsZS5hdmF0YXJVcmwgPyB0aGlzLmNvbnRleHQubXhjVXJsVG9IdHRwKFxuICAgICAgICAgICAgcHJvZmlsZS5hdmF0YXJVcmwsIGF2YXRhckhlaWdodCwgYXZhdGFySGVpZ2h0LCBcImNyb3BcIikgOiBudWxsO1xuXG4gICAgICAgIGxldCBhdmF0YXJFbGVtZW50ID0gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Hcm91cFRpbGVfYXZhdGFyXCI+XG4gICAgICAgICAgICAgICAgPEJhc2VBdmF0YXJcbiAgICAgICAgICAgICAgICAgICAgbmFtZT17bmFtZX1cbiAgICAgICAgICAgICAgICAgICAgaWROYW1lPXt0aGlzLnByb3BzLmdyb3VwSWR9XG4gICAgICAgICAgICAgICAgICAgIHVybD17aHR0cFVybH1cbiAgICAgICAgICAgICAgICAgICAgd2lkdGg9e2F2YXRhckhlaWdodH1cbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0PXthdmF0YXJIZWlnaHR9IC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMuZHJhZ2dhYmxlKSB7XG4gICAgICAgICAgICBjb25zdCBhdmF0YXJDbG9uZSA9IGF2YXRhckVsZW1lbnQ7XG4gICAgICAgICAgICBhdmF0YXJFbGVtZW50ID0gKFxuICAgICAgICAgICAgICAgIDxEcm9wcGFibGUgZHJvcHBhYmxlSWQ9XCJteS1ncm91cHMtZHJvcHBhYmxlXCIgdHlwZT1cImRyYWdnYWJsZS1UYWdUaWxlXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgKGRyb3BwYWJsZVByb3ZpZGVkLCBkcm9wcGFibGVTbmFwc2hvdCkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiByZWY9e2Ryb3BwYWJsZVByb3ZpZGVkLmlubmVyUmVmfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8RHJhZ2dhYmxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17XCJHcm91cFRpbGUgXCIgKyB0aGlzLnByb3BzLmdyb3VwSWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZUlkPXtcIkdyb3VwVGlsZSBcIiArIHRoaXMucHJvcHMuZ3JvdXBJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9e3RoaXMucHJvcHMuZ3JvdXBJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cImRyYWdnYWJsZS1UYWdUaWxlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgKHByb3ZpZGVkLCBzbmFwc2hvdCkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZj17cHJvdmlkZWQuaW5uZXJSZWZ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsuLi5wcm92aWRlZC5kcmFnZ2FibGVQcm9wc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgey4uLnByb3ZpZGVkLmRyYWdIYW5kbGVQcm9wc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHthdmF0YXJDbG9uZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IC8qIEluc3RlYWQgb2YgYSBibGFuayBwbGFjZWhvbGRlciwgdXNlIGEgY29weSBvZiB0aGUgYXZhdGFyIGl0c2VsZi4gKi8gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgcHJvdmlkZWQucGxhY2Vob2xkZXIgPyBhdmF0YXJDbG9uZSA6IDxkaXYgLz4gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvRHJhZ2dhYmxlPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICkgfVxuICAgICAgICAgICAgICAgIDwvRHJvcHBhYmxlPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFhYWDogVXNlIG9uTW91c2VEb3duIGFzIGEgd29ya2Fyb3VuZCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL2F0bGFzc2lhbi9yZWFjdC1iZWF1dGlmdWwtZG5kL2lzc3Vlcy8yNzNcbiAgICAgICAgLy8gaW5zdGVhZCBvZiBvbkNsaWNrLiBPdGhlcndpc2Ugd2UgZXhwZXJpZW5jZSBodHRwczovL2dpdGh1Yi5jb20vdmVjdG9yLWltL3Jpb3Qtd2ViL2lzc3Vlcy82MTU2XG4gICAgICAgIHJldHVybiA8QWNjZXNzaWJsZUJ1dHRvbiBjbGFzc05hbWU9XCJteF9Hcm91cFRpbGVcIiBvbk1vdXNlRG93bj17dGhpcy5vbk1vdXNlRG93bn0gb25DbGljaz17bm9wfT5cbiAgICAgICAgICAgIHsgYXZhdGFyRWxlbWVudCB9XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X0dyb3VwVGlsZV9wcm9maWxlXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Hcm91cFRpbGVfbmFtZVwiPnsgbmFtZSB9PC9kaXY+XG4gICAgICAgICAgICAgICAgeyBkZXNjRWxlbWVudCB9XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9Hcm91cFRpbGVfZ3JvdXBJZFwiPnsgdGhpcy5wcm9wcy5ncm91cElkIH08L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+O1xuICAgIH0sXG59KTtcblxuZXhwb3J0IGRlZmF1bHQgR3JvdXBUaWxlO1xuIl19