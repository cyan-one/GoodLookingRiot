"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.E2E_STATE = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _languageHandler = require("../../../languageHandler");

var _useSettings = require("../../../hooks/useSettings");

var _AccessibleButton = _interopRequireDefault(require("../elements/AccessibleButton"));

var _Tooltip = _interopRequireDefault(require("../elements/Tooltip"));

/*
Copyright 2019 New Vector Ltd
Copyright 2020 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
const E2E_STATE = {
  VERIFIED: "verified",
  WARNING: "warning",
  UNKNOWN: "unknown",
  NORMAL: "normal"
};
exports.E2E_STATE = E2E_STATE;
const crossSigningUserTitles = {
  [E2E_STATE.WARNING]: (0, _languageHandler._td)("This user has not verified all of their sessions."),
  [E2E_STATE.NORMAL]: (0, _languageHandler._td)("You have not verified this user."),
  [E2E_STATE.VERIFIED]: (0, _languageHandler._td)("You have verified this user. This user has verified all of their sessions.")
};
const crossSigningRoomTitles = {
  [E2E_STATE.WARNING]: (0, _languageHandler._td)("Someone is using an unknown session"),
  [E2E_STATE.NORMAL]: (0, _languageHandler._td)("This room is end-to-end encrypted"),
  [E2E_STATE.VERIFIED]: (0, _languageHandler._td)("Everyone in this room is verified")
};
const legacyUserTitles = {
  [E2E_STATE.WARNING]: (0, _languageHandler._td)("Some sessions for this user are not trusted"),
  [E2E_STATE.VERIFIED]: (0, _languageHandler._td)("All sessions for this user are trusted")
};
const legacyRoomTitles = {
  [E2E_STATE.WARNING]: (0, _languageHandler._td)("Some sessions in this encrypted room are not trusted"),
  [E2E_STATE.VERIFIED]: (0, _languageHandler._td)("All sessions in this encrypted room are trusted")
};

const E2EIcon = ({
  isUser,
  status,
  className,
  size,
  onClick,
  hideTooltip
}) => {
  const [hover, setHover] = (0, _react.useState)(false);
  const classes = (0, _classnames.default)({
    mx_E2EIcon: true,
    mx_E2EIcon_warning: status === E2E_STATE.WARNING,
    mx_E2EIcon_normal: status === E2E_STATE.NORMAL,
    mx_E2EIcon_verified: status === E2E_STATE.VERIFIED
  }, className);
  let e2eTitle;
  const crossSigning = (0, _useSettings.useSettingValue)("feature_cross_signing");

  if (crossSigning && isUser) {
    e2eTitle = crossSigningUserTitles[status];
  } else if (crossSigning && !isUser) {
    e2eTitle = crossSigningRoomTitles[status];
  } else if (!crossSigning && isUser) {
    e2eTitle = legacyUserTitles[status];
  } else if (!crossSigning && !isUser) {
    e2eTitle = legacyRoomTitles[status];
  }

  let style;

  if (size) {
    style = {
      width: "".concat(size, "px"),
      height: "".concat(size, "px")
    };
  }

  const onMouseOver = () => setHover(true);

  const onMouseOut = () => setHover(false);

  let tip;

  if (hover && !hideTooltip) {
    tip = /*#__PURE__*/_react.default.createElement(_Tooltip.default, {
      label: e2eTitle ? (0, _languageHandler._t)(e2eTitle) : ""
    });
  }

  if (onClick) {
    return /*#__PURE__*/_react.default.createElement(_AccessibleButton.default, {
      onClick: onClick,
      onMouseOver: onMouseOver,
      onMouseOut: onMouseOut,
      className: classes,
      style: style
    }, tip);
  }

  return /*#__PURE__*/_react.default.createElement("div", {
    onMouseOver: onMouseOver,
    onMouseOut: onMouseOut,
    className: classes,
    style: style
  }, tip);
};

E2EIcon.propTypes = {
  isUser: _propTypes.default.bool,
  status: _propTypes.default.oneOf(Object.values(E2E_STATE)),
  className: _propTypes.default.string,
  size: _propTypes.default.number,
  onClick: _propTypes.default.func
};
var _default = E2EIcon;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21zL0UyRUljb24uanMiXSwibmFtZXMiOlsiRTJFX1NUQVRFIiwiVkVSSUZJRUQiLCJXQVJOSU5HIiwiVU5LTk9XTiIsIk5PUk1BTCIsImNyb3NzU2lnbmluZ1VzZXJUaXRsZXMiLCJjcm9zc1NpZ25pbmdSb29tVGl0bGVzIiwibGVnYWN5VXNlclRpdGxlcyIsImxlZ2FjeVJvb21UaXRsZXMiLCJFMkVJY29uIiwiaXNVc2VyIiwic3RhdHVzIiwiY2xhc3NOYW1lIiwic2l6ZSIsIm9uQ2xpY2siLCJoaWRlVG9vbHRpcCIsImhvdmVyIiwic2V0SG92ZXIiLCJjbGFzc2VzIiwibXhfRTJFSWNvbiIsIm14X0UyRUljb25fd2FybmluZyIsIm14X0UyRUljb25fbm9ybWFsIiwibXhfRTJFSWNvbl92ZXJpZmllZCIsImUyZVRpdGxlIiwiY3Jvc3NTaWduaW5nIiwic3R5bGUiLCJ3aWR0aCIsImhlaWdodCIsIm9uTW91c2VPdmVyIiwib25Nb3VzZU91dCIsInRpcCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsImJvb2wiLCJvbmVPZiIsIk9iamVjdCIsInZhbHVlcyIsInN0cmluZyIsIm51bWJlciIsImZ1bmMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQXhCQTs7Ozs7Ozs7Ozs7Ozs7OztBQTBCTyxNQUFNQSxTQUFTLEdBQUc7QUFDckJDLEVBQUFBLFFBQVEsRUFBRSxVQURXO0FBRXJCQyxFQUFBQSxPQUFPLEVBQUUsU0FGWTtBQUdyQkMsRUFBQUEsT0FBTyxFQUFFLFNBSFk7QUFJckJDLEVBQUFBLE1BQU0sRUFBRTtBQUphLENBQWxCOztBQU9QLE1BQU1DLHNCQUFzQixHQUFHO0FBQzNCLEdBQUNMLFNBQVMsQ0FBQ0UsT0FBWCxHQUFxQiwwQkFBSSxtREFBSixDQURNO0FBRTNCLEdBQUNGLFNBQVMsQ0FBQ0ksTUFBWCxH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MUMsTUFBTjtBQUNIOztBQUVELE1BQUlULE9BQUosRUFBYTtBQUNULHdCQUNJLDZCQUFDLHlCQUFEO0FBQ0ksTUFBQSxPQUFPLEVBQUVBLE9BRGI7QUFFSSxNQUFBLFdBQVcsRUFBRWMsV0FGakI7QUFHSSxNQUFBLFVBQVUsRUFBRUMsVUFIaEI7QUFJSSxNQUFBLFNBQVMsRUFBRVgsT0FKZjtBQUtJLE1BQUEsS0FBSyxFQUFFTztBQUxYLE9BT01LLEdBUE4sQ0FESjtBQVdIOztBQUVELHNCQUFPO0FBQUssSUFBQSxXQUFXLEVBQUVGLFdBQWxCO0FBQStCLElBQUEsVUFBVSxFQUFFQyxVQUEzQztBQUF1RCxJQUFBLFNBQVMsRUFBRVgsT0FBbEU7QUFBMkUsSUFBQSxLQUFLLEVBQUVPO0FBQWxGLEtBQ0RLLEdBREMsQ0FBUDtBQUdILENBcEREOztBQXNEQXJCLE9BQU8sQ0FBQ3NCLFNBQVIsR0FBb0I7QUFDaEJyQixFQUFBQSxNQUFNLEVBQUVzQixtQkFBVUMsSUFERjtBQUVoQnRCLEVBQUFBLE1BQU0sRUFBRXFCLG1CQUFVRSxLQUFWLENBQWdCQyxNQUFNLENBQUNDLE1BQVAsQ0FBY3BDLFNBQWQsQ0FBaEIsQ0FGUTtBQUdoQlksRUFBQUEsU0FBUyxFQUFFb0IsbUJBQVVLLE1BSEw7QUFJaEJ4QixFQUFBQSxJQUFJLEVBQUVtQixtQkFBVU0sTUFKQTtBQUtoQnhCLEVBQUFBLE9BQU8sRUFBRWtCLG1CQUFVTztBQUxILENBQXBCO2VBUWU5QixPIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAyMCBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCwge3VzZVN0YXRlfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcbmltcG9ydCBjbGFzc05hbWVzIGZyb20gJ2NsYXNzbmFtZXMnO1xuXG5pbXBvcnQge190LCBfdGR9IGZyb20gJy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlcic7XG5pbXBvcnQge3VzZVNldHRpbmdWYWx1ZX0gZnJvbSBcIi4uLy4uLy4uL2hvb2tzL3VzZVNldHRpbmdzXCI7XG5pbXBvcnQgQWNjZXNzaWJsZUJ1dHRvbiBmcm9tIFwiLi4vZWxlbWVudHMvQWNjZXNzaWJsZUJ1dHRvblwiO1xuaW1wb3J0IFRvb2x0aXAgZnJvbSBcIi4uL2VsZW1lbnRzL1Rvb2x0aXBcIjtcblxuZXhwb3J0IGNvbnN0IEUyRV9TVEFURSA9IHtcbiAgICBWRVJJRklFRDogXCJ2ZXJpZmllZFwiLFxuICAgIFdBUk5JTkc6IFwid2FybmluZ1wiLFxuICAgIFVOS05PV046IFwidW5rbm93blwiLFxuICAgIE5PUk1BTDogXCJub3JtYWxcIixcbn07XG5cbmNvbnN0IGNyb3NzU2lnbmluZ1VzZXJUaXRsZXMgPSB7XG4gICAgW0UyRV9TVEFURS5XQVJOSU5HXTogX3RkKFwiVGhpcyB1c2VyIGhhcyBub3QgdmVyaWZpZWQgYWxsIG9mIHRoZWlyIHNlc3Npb25zLlwiKSxcbiAgICBbRTJFX1NUQVRFLk5PUk1BTF06IF90ZChcIllvdSBoYXZlIG5vdCB2ZXJpZmllZCB0aGlzIHVzZXIuXCIpLFxuICAgIFtFMkVfU1RBVEUuVkVSSUZJRURdOiBfdGQoXCJZb3UgaGF2ZSB2ZXJpZmllZCB0aGlzIHVzZXIuIFRoaXMgdXNlciBoYXMgdmVyaWZpZWQgYWxsIG9mIHRoZWlyIHNlc3Npb25zLlwiKSxcbn07XG5jb25zdCBjcm9zc1NpZ25pbmdSb29tVGl0bGVzID0ge1xuICAgIFtFMkVfU1RBVEUuV0FSTklOR106IF90ZChcIlNvbWVvbmUgaXMgdXNpbmcgYW4gdW5rbm93biBzZXNzaW9uXCIpLFxuICAgIFtFMkVfU1RBVEUuTk9STUFMXTogX3RkKFwiVGhpcyByb29tIGlzIGVuZC10by1lbmQgZW5jcnlwdGVkXCIpLFxuICAgIFtFMkVfU1RBVEUuVkVSSUZJRURdOiBfdGQoXCJFdmVyeW9uZSBpbiB0aGlzIHJvb20gaXMgdmVyaWZpZWRcIiksXG59O1xuXG5jb25zdCBsZWdhY3lVc2VyVGl0bGVzID0ge1xuICAgIFtFMkVfU1RBVEUuV0FSTklOR106IF90ZChcIlNvbWUgc2Vzc2lvbnMgZm9yIHRoaXMgdXNlciBhcmUgbm90IHRydXN0ZWRcIiksXG4gICAgW0UyRV9TVEFURS5WRVJJRklFRF06IF90ZChcIkFsbCBzZXNzaW9ucyBmb3IgdGhpcyB1c2VyIGFyZSB0cnVzdGVkXCIpLFxufTtcbmNvbnN0IGxlZ2FjeVJvb21UaXRsZXMgPSB7XG4gICAgW0UyRV9TVEFURS5XQVJOSU5HXTogX3RkKFwiU29tZSBzZXNzaW9ucyBpbiB0aGlzIGVuY3J5cHRlZCByb29tIGFyZSBub3QgdHJ1c3RlZFwiKSxcbiAgICBbRTJFX1NUQVRFLlZFUklGSUVEXTogX3RkKFwiQWxsIHNlc3Npb25zIGluIHRoaXMgZW5jcnlwdGVkIHJvb20gYXJlIHRydXN0ZWRcIiksXG59O1xuXG5jb25zdCBFMkVJY29uID0gKHtpc1VzZXIsIHN0YXR1cywgY2xhc3NOYW1lLCBzaXplLCBvbkNsaWNrLCBoaWRlVG9vbHRpcH0pID0+IHtcbiAgICBjb25zdCBbaG92ZXIsIHNldEhvdmVyXSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICAgIGNvbnN0IGNsYXNzZXMgPSBjbGFzc05hbWVzKHtcbiAgICAgICAgbXhfRTJFSWNvbjogdHJ1ZSxcbiAgICAgICAgbXhfRTJFSWNvbl93YXJuaW5nOiBzdGF0dXMgPT09IEUyRV9TVEFURS5XQVJOSU5HLFxuICAgICAgICBteF9FMkVJY29uX25vcm1hbDogc3RhdHVzID09PSBFMkVfU1RBVEUuTk9STUFMLFxuICAgICAgICBteF9FMkVJY29uX3ZlcmlmaWVkOiBzdGF0dXMgPT09IEUyRV9TVEFURS5WRVJJRklFRCxcbiAgICB9LCBjbGFzc05hbWUpO1xuXG4gICAgbGV0IGUyZVRpdGxlO1xuICAgIGNvbnN0IGNyb3NzU2lnbmluZyA9IHVzZVNldHRpbmdWYWx1ZShcImZlYXR1cmVfY3Jvc3Nfc2lnbmluZ1wiKTtcbiAgICBpZiAoY3Jvc3NTaWduaW5nICYmIGlzVXNlcikge1xuICAgICAgICBlMmVUaXRsZSA9IGNyb3NzU2lnbmluZ1VzZXJUaXRsZXNbc3RhdHVzXTtcbiAgICB9IGVsc2UgaWYgKGNyb3NzU2lnbmluZyAmJiAhaXNVc2VyKSB7XG4gICAgICAgIGUyZVRpdGxlID0gY3Jvc3NTaWduaW5nUm9vbVRpdGxlc1tzdGF0dXNdO1xuICAgIH0gZWxzZSBpZiAoIWNyb3NzU2lnbmluZyAmJiBpc1VzZXIpIHtcbiAgICAgICAgZTJlVGl0bGUgPSBsZWdhY3lVc2VyVGl0bGVzW3N0YXR1c107XG4gICAgfSBlbHNlIGlmICghY3Jvc3NTaWduaW5nICYmICFpc1VzZXIpIHtcbiAgICAgICAgZTJlVGl0bGUgPSBsZWdhY3lSb29tVGl0bGVzW3N0YXR1c107XG4gICAgfVxuXG4gICAgbGV0IHN0eWxlO1xuICAgIGlmIChzaXplKSB7XG4gICAgICAgIHN0eWxlID0ge3dpZHRoOiBgJHtzaXplfXB4YCwgaGVpZ2h0OiBgJHtzaXplfXB4YH07XG4gICAgfVxuXG4gICAgY29uc3Qgb25Nb3VzZU92ZXIgPSAoKSA9PiBzZXRIb3Zlcih0cnVlKTtcbiAgICBjb25zdCBvbk1vdXNlT3V0ID0gKCkgPT4gc2V0SG92ZXIoZmFsc2UpO1xuXG4gICAgbGV0IHRpcDtcbiAgICBpZiAoaG92ZXIgJiYgIWhpZGVUb29sdGlwKSB7XG4gICAgICAgIHRpcCA9IDxUb29sdGlwIGxhYmVsPXtlMmVUaXRsZSA/IF90KGUyZVRpdGxlKSA6IFwiXCJ9IC8+O1xuICAgIH1cblxuICAgIGlmIChvbkNsaWNrKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvblxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e29uQ2xpY2t9XG4gICAgICAgICAgICAgICAgb25Nb3VzZU92ZXI9e29uTW91c2VPdmVyfVxuICAgICAgICAgICAgICAgIG9uTW91c2VPdXQ9e29uTW91c2VPdXR9XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc2VzfVxuICAgICAgICAgICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7IHRpcCB9XG4gICAgICAgICAgICA8L0FjY2Vzc2libGVCdXR0b24+XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIDxkaXYgb25Nb3VzZU92ZXI9e29uTW91c2VPdmVyfSBvbk1vdXNlT3V0PXtvbk1vdXNlT3V0fSBjbGFzc05hbWU9e2NsYXNzZXN9IHN0eWxlPXtzdHlsZX0+XG4gICAgICAgIHsgdGlwIH1cbiAgICA8L2Rpdj47XG59O1xuXG5FMkVJY29uLnByb3BUeXBlcyA9IHtcbiAgICBpc1VzZXI6IFByb3BUeXBlcy5ib29sLFxuICAgIHN0YXR1czogUHJvcFR5cGVzLm9uZU9mKE9iamVjdC52YWx1ZXMoRTJFX1NUQVRFKSksXG4gICAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICAgIHNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgb25DbGljazogUHJvcFR5cGVzLmZ1bmMsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBFMkVJY29uO1xuIl19