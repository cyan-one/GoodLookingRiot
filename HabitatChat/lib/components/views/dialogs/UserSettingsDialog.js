"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _TabbedView = _interopRequireWildcard(require("../../structures/TabbedView"));

var _languageHandler = require("../../../languageHandler");

var _GeneralUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/GeneralUserSettingsTab"));

var _SettingsStore = _interopRequireDefault(require("../../../settings/SettingsStore"));

var _LabsUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/LabsUserSettingsTab"));

var _SecurityUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/SecurityUserSettingsTab"));

var _NotificationUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/NotificationUserSettingsTab"));

var _PreferencesUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/PreferencesUserSettingsTab"));

var _VoiceUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/VoiceUserSettingsTab"));

var _HelpUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/HelpUserSettingsTab"));

var _FlairUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/FlairUserSettingsTab"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _SdkConfig = _interopRequireDefault(require("../../../SdkConfig"));

var _MjolnirUserSettingsTab = _interopRequireDefault(require("../settings/tabs/user/MjolnirUserSettingsTab"));

/*
Copyright 2019 New Vector Ltd
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class UserSettingsDialog extends _react.default.Component {
  constructor() {
    super();
    this.state = {
      mjolnirEnabled: _SettingsStore.default.isFeatureEnabled("feature_mjolnir")
    };
  }

  componentDidMount()
  /*: void*/
  {
    this._mjolnirWatcher = _SettingsStore.default.watchSetting("feature_mjolnir", null, this._mjolnirChanged.bind(this));
  }

  componentWillUnmount()
  /*: void*/
  {
    _SettingsStore.default.unwatchSetting(this._mjolnirWatcher);
  }

  _mjolnirChanged(settingName, roomId, atLevel, newValue) {
    // We can cheat because we know what levels a feature is tracked at, and how it is tracked
    this.setState({
      mjolnirEnabled: newValue
    });
  }

  _getTabs() {
    const tabs = [];
    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("General"), "mx_UserSettingsDialog_settingsIcon", /*#__PURE__*/_react.default.createElement(_GeneralUserSettingsTab.default, {
      closeSettingsFn: this.props.onFinished
    })));
    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Flair"), "mx_UserSettingsDialog_flairIcon", /*#__PURE__*/_react.default.createElement(_FlairUserSettingsTab.default, null)));
    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Notifications"), "mx_UserSettingsDialog_bellIcon", /*#__PURE__*/_react.default.createElement(_NotificationUserSettingsTab.default, null)));
    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Preferences"), "mx_UserSettingsDialog_preferencesIcon", /*#__PURE__*/_react.default.createElement(_PreferencesUserSettingsTab.default, null)));
    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Voice & Video"), "mx_UserSettingsDialog_voiceIcon", /*#__PURE__*/_react.default.createElement(_VoiceUserSettingsTab.default, null)));
    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Security & Privacy"), "mx_UserSettingsDialog_securityIcon", /*#__PURE__*/_react.default.createElement(_SecurityUserSettingsTab.default, {
      closeSettingsFn: this.props.onFinished
    })));

    if (_SdkConfig.default.get()['showLabsSettings'] || _SettingsStore.default.getLabsFeatures().length > 0) {
      tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Labs"), "mx_UserSettingsDialog_labsIcon", /*#__PURE__*/_react.default.createElement(_LabsUserSettingsTab.default, null)));
    }

    if (this.state.mjolnirEnabled) {
      tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Ignored users"), "mx_UserSettingsDialog_mjolnirIcon", /*#__PURE__*/_react.default.createElement(_MjolnirUserSettingsTab.default, null)));
    }

    tabs.push(new _TabbedView.Tab((0, _languageHandler._td)("Help & About"), "mx_UserSettingsDialog_helpIcon", /*#__PURE__*/_react.default.createElement(_HelpUserSettingsTab.default, {
      closeSettingsFn: this.props.onFinished
    })));
    return tabs;
  }

  render() {
    const BaseDialog = sdk.getComponent('views.dialogs.BaseDialog');
    return /*#__PURE__*/_react.default.createElement(BaseDialog, {
      className: "mx_UserSettingsDialog",
      hasCancel: true,
      onFinished: this.props.onFinished,
      title: (0, _languageHandler._t)("Settings")
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "ms_SettingsDialog_content"
    }, /*#__PURE__*/_react.default.createElement(_TabbedView.default, {
      tabs: this._getTabs()
    })));
  }

}

exports.default = UserSettingsDialog;
(0, _defineProperty2.default)(UserSettingsDialog, "propTypes", {
  onFinished: _propTypes.default.func.isRequired
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL2RpYWxvZ3MvVXNlclNldHRpbmdzRGlhbG9nLmpzIl0sIm5hbWVzIjpbIlVzZXJTZXR0aW5nc0RpYWxvZyIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJzdGF0ZSIsIm1qb2xuaXJFbmFibGVkIiwiU2V0dGluZ3NTdG9yZSIsImlzRmVhdHVyZUVuYWJsZWQiLCJjb21wb25lbnREaWRNb3VudCIsIl9tam9sbmlyV2F0Y2hlciIsIndhdGNoU2V0dGluZyIsIl9tam9sbmlyQ2hhbmdlZCIsImJpbmQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInVud2F0Y2hTZXR0aW5nIiwic2V0dGluZ05hbWUiLCJyb29tSWQiLCJhdExldmVsIiwibmV3VmFsdWUiLCJzZXRTdGF0ZSIsIl9nZXRUYWJzIiwidGFicyIsInB1c2giLCJUYWIiLCJwcm9wcyIsIm9uRmluaXNoZWQiLCJTZGtDb25maWciLCJnZXQiLCJnZXRMYWJzRmVhdHVyZXMiLCJsZW5ndGgiLCJyZW5kZXIiLCJCYXNlRGlhbG9nIiwic2RrIiwiZ2V0Q29tcG9uZW50IiwiUHJvcFR5cGVzIiwiZnVuYyIsImlzUmVxdWlyZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFpQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBaENBOzs7Ozs7Ozs7Ozs7Ozs7O0FBa0NlLE1BQU1BLGtCQUFOLFNBQWlDQyxlQUFNQyxTQUF2QyxDQUFpRDtBQUs1REMsRUFBQUEsV0FBVyxHQUFHO0FBQ1Y7QUFFQSxTQUFLQyxLQUFMLEdBQWE7QUFDVEMsTUFBQUEsY0FBYyxFQUFFQyx1QkFBY0MsZ0JBQWQsQ0FBK0IsaUJBQS9CO0FBRFAsS0FBYjtBQUdIOztBQUVEQyxFQUFBQSxpQkFBaUI7QUFBQTtBQUFTO0FBQ3RCLFNBQUtD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QSxLQUFLLEVBQUUseUJBQUcsVUFBSDtBQUR0RCxvQkFFSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsb0JBQ0ksNkJBQUMsbUJBQUQ7QUFBWSxNQUFBLElBQUksRUFBRSxLQUFLTCxRQUFMO0FBQWxCLE1BREosQ0FGSixDQURKO0FBUUg7O0FBN0YyRDs7OzhCQUEzQ3BCLGtCLGVBQ0U7QUFDZnlCLEVBQUFBLFVBQVUsRUFBRVMsbUJBQVVDLElBQVYsQ0FBZUM7QUFEWixDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSBUaGUgTWF0cml4Lm9yZyBGb3VuZGF0aW9uIEMuSS5DLlxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFRhYmJlZFZpZXcsIHtUYWJ9IGZyb20gXCIuLi8uLi9zdHJ1Y3R1cmVzL1RhYmJlZFZpZXdcIjtcbmltcG9ydCB7X3QsIF90ZH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IEdlbmVyYWxVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9HZW5lcmFsVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tIFwiLi4vLi4vLi4vc2V0dGluZ3MvU2V0dGluZ3NTdG9yZVwiO1xuaW1wb3J0IExhYnNVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9MYWJzVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgU2VjdXJpdHlVc2VyU2V0dGluZ3NUYWIgZnJvbSBcIi4uL3NldHRpbmdzL3RhYnMvdXNlci9TZWN1cml0eVVzZXJTZXR0aW5nc1RhYlwiO1xuaW1wb3J0IE5vdGlmaWNhdGlvblVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL05vdGlmaWNhdGlvblVzZXJTZXR0aW5nc1RhYlwiO1xuaW1wb3J0IFByZWZlcmVuY2VzVXNlclNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3VzZXIvUHJlZmVyZW5jZXNVc2VyU2V0dGluZ3NUYWJcIjtcbmltcG9ydCBWb2ljZVVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL1ZvaWNlVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgSGVscFVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL0hlbHBVc2VyU2V0dGluZ3NUYWJcIjtcbmltcG9ydCBGbGFpclVzZXJTZXR0aW5nc1RhYiBmcm9tIFwiLi4vc2V0dGluZ3MvdGFicy91c2VyL0ZsYWlyVXNlclNldHRpbmdzVGFiXCI7XG5pbXBvcnQgKiBhcyBzZGsgZnJvbSBcIi4uLy4uLy4uL2luZGV4XCI7XG5pbXBvcnQgU2RrQ29uZmlnIGZyb20gXCIuLi8uLi8uLi9TZGtDb25maWdcIjtcbmltcG9ydCBNam9sbmlyVXNlclNldHRpbmdzVGFiIGZyb20gXCIuLi9zZXR0aW5ncy90YWJzL3VzZXIvTWpvbG5pclVzZXJTZXR0aW5nc1RhYlwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VyU2V0dGluZ3NEaWFsb2cgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICAgIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgICAgIG9uRmluaXNoZWQ6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgfTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBtam9sbmlyRW5hYmxlZDogU2V0dGluZ3NTdG9yZS5pc0ZlYXR1cmVFbmFibGVkKFwiZmVhdHVyZV9tam9sbmlyXCIpLFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9tam9sbmlyV2F0Y2hlciA9IFNldHRpbmdzU3RvcmUud2F0Y2hTZXR0aW5nKFwiZmVhdHVyZV9tam9sbmlyXCIsIG51bGwsIHRoaXMuX21qb2xuaXJDaGFuZ2VkLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCk6IHZvaWQge1xuICAgICAgICBTZXR0aW5nc1N0b3JlLnVud2F0Y2hTZXR0aW5nKHRoaXMuX21qb2xuaXJXYXRjaGVyKTtcbiAgICB9XG5cbiAgICBfbWpvbG5pckNoYW5nZWQoc2V0dGluZ05hbWUsIHJvb21JZCwgYXRMZXZlbCwgbmV3VmFsdWUpIHtcbiAgICAgICAgLy8gV2UgY2FuIGNoZWF0IGJlY2F1c2Ugd2Uga25vdyB3aGF0IGxldmVscyBhIGZlYXR1cmUgaXMgdHJhY2tlZCBhdCwgYW5kIGhvdyBpdCBpcyB0cmFja2VkXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe21qb2xuaXJFbmFibGVkOiBuZXdWYWx1ZX0pO1xuICAgIH1cblxuICAgIF9nZXRUYWJzKCkge1xuICAgICAgICBjb25zdCB0YWJzID0gW107XG5cbiAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICBfdGQoXCJHZW5lcmFsXCIpLFxuICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfc2V0dGluZ3NJY29uXCIsXG4gICAgICAgICAgICA8R2VuZXJhbFVzZXJTZXR0aW5nc1RhYiBjbG9zZVNldHRpbmdzRm49e3RoaXMucHJvcHMub25GaW5pc2hlZH0gLz4sXG4gICAgICAgICkpO1xuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIF90ZChcIkZsYWlyXCIpLFxuICAgICAgICAgICAgXCJteF9Vc2VyU2V0dGluZ3NEaWFsb2dfZmxhaXJJY29uXCIsXG4gICAgICAgICAgICA8RmxhaXJVc2VyU2V0dGluZ3NUYWIgLz4sXG4gICAgICAgICkpO1xuICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgIF90ZChcIk5vdGlmaWNhdGlvbnNcIiksXG4gICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19iZWxsSWNvblwiLFxuICAgICAgICAgICAgPE5vdGlmaWNhdGlvblVzZXJTZXR0aW5nc1RhYiAvPixcbiAgICAgICAgKSk7XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgX3RkKFwiUHJlZmVyZW5jZXNcIiksXG4gICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19wcmVmZXJlbmNlc0ljb25cIixcbiAgICAgICAgICAgIDxQcmVmZXJlbmNlc1VzZXJTZXR0aW5nc1RhYiAvPixcbiAgICAgICAgKSk7XG4gICAgICAgIHRhYnMucHVzaChuZXcgVGFiKFxuICAgICAgICAgICAgX3RkKFwiVm9pY2UgJiBWaWRlb1wiKSxcbiAgICAgICAgICAgIFwibXhfVXNlclNldHRpbmdzRGlhbG9nX3ZvaWNlSWNvblwiLFxuICAgICAgICAgICAgPFZvaWNlVXNlclNldHRpbmdzVGFiIC8+LFxuICAgICAgICApKTtcbiAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICBfdGQoXCJTZWN1cml0eSAmIFByaXZhY3lcIiksXG4gICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19zZWN1cml0eUljb25cIixcbiAgICAgICAgICAgIDxTZWN1cml0eVVzZXJTZXR0aW5nc1RhYiBjbG9zZVNldHRpbmdzRm49e3RoaXMucHJvcHMub25GaW5pc2hlZH0gLz4sXG4gICAgICAgICkpO1xuICAgICAgICBpZiAoU2RrQ29uZmlnLmdldCgpWydzaG93TGFic1NldHRpbmdzJ10gfHwgU2V0dGluZ3NTdG9yZS5nZXRMYWJzRmVhdHVyZXMoKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0YWJzLnB1c2gobmV3IFRhYihcbiAgICAgICAgICAgICAgICBfdGQoXCJMYWJzXCIpLFxuICAgICAgICAgICAgICAgIFwibXhfVXNlclNldHRpbmdzRGlhbG9nX2xhYnNJY29uXCIsXG4gICAgICAgICAgICAgICAgPExhYnNVc2VyU2V0dGluZ3NUYWIgLz4sXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5tam9sbmlyRW5hYmxlZCkge1xuICAgICAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICAgICAgX3RkKFwiSWdub3JlZCB1c2Vyc1wiKSxcbiAgICAgICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19tam9sbmlySWNvblwiLFxuICAgICAgICAgICAgICAgIDxNam9sbmlyVXNlclNldHRpbmdzVGFiIC8+LFxuICAgICAgICAgICAgKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGFicy5wdXNoKG5ldyBUYWIoXG4gICAgICAgICAgICBfdGQoXCJIZWxwICYgQWJvdXRcIiksXG4gICAgICAgICAgICBcIm14X1VzZXJTZXR0aW5nc0RpYWxvZ19oZWxwSWNvblwiLFxuICAgICAgICAgICAgPEhlbHBVc2VyU2V0dGluZ3NUYWIgY2xvc2VTZXR0aW5nc0ZuPXt0aGlzLnByb3BzLm9uRmluaXNoZWR9IC8+LFxuICAgICAgICApKTtcblxuICAgICAgICByZXR1cm4gdGFicztcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IEJhc2VEaWFsb2cgPSBzZGsuZ2V0Q29tcG9uZW50KCd2aWV3cy5kaWFsb2dzLkJhc2VEaWFsb2cnKTtcblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPEJhc2VEaWFsb2cgY2xhc3NOYW1lPSdteF9Vc2VyU2V0dGluZ3NEaWFsb2cnIGhhc0NhbmNlbD17dHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmluaXNoZWQ9e3RoaXMucHJvcHMub25GaW5pc2hlZH0gdGl0bGU9e190KFwiU2V0dGluZ3NcIil9PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdtc19TZXR0aW5nc0RpYWxvZ19jb250ZW50Jz5cbiAgICAgICAgICAgICAgICAgICAgPFRhYmJlZFZpZXcgdGFicz17dGhpcy5fZ2V0VGFicygpfSAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9CYXNlRGlhbG9nPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==