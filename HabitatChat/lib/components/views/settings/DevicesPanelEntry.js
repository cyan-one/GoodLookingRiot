"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var sdk = _interopRequireWildcard(require("../../../index"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _DateUtils = require("../../../DateUtils");

/*
Copyright 2016 OpenMarket Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class DevicesPanelEntry extends _react.default.Component {
  constructor(props) {
    super(props);
    this._unmounted = false;
    this.onDeviceToggled = this.onDeviceToggled.bind(this);
    this._onDisplayNameChanged = this._onDisplayNameChanged.bind(this);
  }

  componentWillUnmount() {
    this._unmounted = true;
  }

  _onDisplayNameChanged(value) {
    const device = this.props.device;
    return _MatrixClientPeg.MatrixClientPeg.get().setDeviceDetails(device.device_id, {
      display_name: value
    }).catch(e => {
      console.error("Error setting session display name", e);
      throw new Error((0, _languageHandler._t)("Failed to set display name"));
    });
  }

  onDeviceToggled() {
    this.props.onDeviceToggled(this.props.device);
  }

  render() {
    const EditableTextContainer = sdk.getComponent('elements.EditableTextContainer');
    const device = this.props.device;
    let lastSeen = "";

    if (device.last_seen_ts) {
      const lastSeenDate = (0, _DateUtils.formatDate)(new Date(device.last_seen_ts));
      lastSeen = device.last_seen_ip + " @ " + lastSeenDate.toLocaleString();
    }

    let myDeviceClass = '';

    if (device.device_id === _MatrixClientPeg.MatrixClientPeg.get().getDeviceId()) {
      myDeviceClass = " mx_DevicesPanel_myDevice";
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_DevicesPanel_device" + myDeviceClass
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_DevicesPanel_deviceId"
    }, device.device_id), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_DevicesPanel_deviceName"
    }, /*#__PURE__*/_react.default.createElement(EditableTextContainer, {
      initialValue: device.display_name,
      onSubmit: this._onDisplayNameChanged,
      placeholder: device.device_id
    })), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_DevicesPanel_lastSeen"
    }, lastSeen), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_DevicesPanel_deviceButtons"
    }, /*#__PURE__*/_react.default.createElement("input", {
      type: "checkbox",
      onChange: this.onDeviceToggled,
      checked: this.props.selected
    })));
  }

}

exports.default = DevicesPanelEntry;
DevicesPanelEntry.propTypes = {
  device: _propTypes.default.object.isRequired,
  onDeviceToggled: _propTypes.default.func
};
DevicesPanelEntry.defaultProps = {
  onDeviceToggled: function () {}
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL0RldmljZXNQYW5lbEVudHJ5LmpzIl0sIm5hbWVzIjpbIkRldmljZXNQYW5lbEVudHJ5IiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX3VubW91bnRlZCIsIm9uRGV2aWNlVG9nZ2xlZCIsImJpbmQiLCJfb25EaXNwbGF5TmFtZUNoYW5nZWQiLCJjb21wb25lbnRXaWxsVW5tb3VudCIsInZhbHVlIiwiZGV2aWNlIiwiTWF0cml4Q2xpZW50UGVnIiwiZ2V0Iiwic2V0RGV2aWNlRGV0YWlscyIsImRldmljZV9pZCIsImRpc3BsYXlfbmFtZSIsImNhdGNoIiwiZSIsImNvbnNvbGUiLCJlcnJvciIsIkVycm9yIiwicmVuZGVyIiwiRWRpdGFibGVUZXh0Q29udGFpbmVyIiwic2RrIiwiZ2V0Q29tcG9uZW50IiwibGFzdFNlZW4iLCJsYXN0X3NlZW5fdHMiLCJsYXN0U2VlbkRhdGUiLCJEYXRlIiwibGFzdF9zZWVuX2lwIiwidG9Mb2NhbGVTdHJpbmciLCJteURldmljZUNsYXNzIiwiZ2V0RGV2aWNlSWQiLCJzZWxlY3RlZCIsInByb3BUeXBlcyIsIlByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJmdW5jIiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUF0QkE7Ozs7Ozs7Ozs7Ozs7OztBQXdCZSxNQUFNQSxpQkFBTixTQUFnQ0MsZUFBTUMsU0FBdEMsQ0FBZ0Q7QUFDM0RDLEVBQUFBLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRO0FBQ2YsVUFBTUEsS0FBTjtBQUVBLFNBQUtDLFVBQUwsR0FBa0IsS0FBbEI7QUFDQSxTQUFLQyxlQUFMLEdBQXVCLEtBQUtBLGVBQUwsQ0FBcUJDLElBQXJCLENBQTBCLElBQTFCLENBQXZCO0FBQ0EsU0FBS0MscUJBQUwsR0FBNkIsS0FBS0EscUJBQUwsQ0FBMkJELElBQTNCLENBQWdDLElBQWhDLENBQTdCO0FBQ0g7O0FBRURFLEVBQUFBLG9CQUFvQixHQUFHO0FBQ25CLFNBQUtKLFVBQUwsR0FBa0IsSUFBbEI7QUFDSDs7QUFFREcsRUFBQUEscUJBQXFCLENBQUNFLEtBQUQsRUFBUTtBQUN6QixVQUFNQyxNQUFNLEdBQUcsS0FBS1AsS0FBTCxDQUFXTyxNQUExQjtBQUNBLFdBQU9DLGlDQUFnQkMsR0FBaEIsR0FBc0JDLGdCQUF0QixDQUF1Q0gsTUFBTSxDQUFDSSxTQUE5QyxFQUF5RDtBQUM1REMsTUFBQUEsWUFBWSxFQUFFTjtBQUQ4QyxLQUF6RCxFQUVKTyxLQUZJLENBRUdDLENBQUQsSUFBTztBQUNaQyxNQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBYyxvQ0FBZCxFQUFvREYsQ0FBcEQ7QUFDQSxZQUFNLElBQUlHLEtBQUosQ0FBVSx5QkFBRyw0QkFBSCxDQUFWLENBQU47QUFDSCxLQUxNLENBQVA7QUFNSDs7QUFFRGYsRUFBQUEsZUFBZSxHQUFHO0FBQ2QsU0FBS0YsS0FBTCxDQUFXRSxlQUFYLENBQTJCLEtBQUtGLEtBQUwsQ0FBV08sTUFBdEM7QUFDSDs7QUFFRFcsRUFBQUEsTUFBTSxHQUFHO0FBQ0wsVUFBTUMscUJBQXFCLEdBQUdDLEdBQUcsQ0FBQ0MsWUFBSixDQUFpQixnQ0FBakIsQ0FBOUI7QUFFQSxVQUFNZCxNQUFNLEdBQUcsS0FBS1AsS0FBTCxDQUFXTyxNQUExQjtBQUVBLFFBQUllLFFBQVEsR0FBRyxFQUFmOztBQUNBLFFBQUlmLE1BQU0sQ0FBQ2dCLFlBQVgsRUFBeUI7QUFDckIsWUFBTUMsWUFBWSxHQUFHLDJCQUFXLElBQUlDLElBQUosQ0FBU2xCLE1BQU0sQ0FBQ2dCLFlBQWhCLENBQVgsQ0FBckI7QUFDQUQsTUFBQUEsUUFBUSxHQUFHZixNQUFNLENBQUNtQixZQUFQLEdBQXNCLEtBQXRCLEdBQ1BGLFlBQVksQ0FBQ0csY0FBYixFQURKO0FBRUg7O0FBRUQsUUFBSUMsYUFBYSxHQUFHLEVBQXBCOztBQUNBLFFBQUlyQixNQUFNLENBQUNJLFNBQVAsS0FBcUJILGlDQUFnQkMsR0FBaEIsR0FBc0JvQixXQUF0QixFQUF6QixFQUE4RDtBQUMxREQsTUFBQUEsYUFBYSxHQUFHLDJCQUFoQjtBQUNIOztBQUVELHdCQUNJO0FBQUssTUFBQSxTQUFTLEVBQUUsMkJBQTJCQTtBQUEzQyxvQkFDSTtBQUFLLE1BQUEsU0FBUyxFQUFDO0FBQWYsT0FDTXJCLE1BQU0sQ0FBQ0ksU0FEYixDQURKLGVBSUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNJLDZCQUFDLHFCQUFEO0FBQXVCLE1BQUEsWUFBWSxFQUFFSixNQUFNLENBQUNLLFlBQTVDO0FBQ0ksTUFBQSxRQUFRLEVBQUUsS0FBS1IscUJBRG5CO0FBRUksTUFBQSxXQUFXLEVBQUVHLE1BQU0sQ0FBQ0k7QUFGeEIsTUFESixDQUpKLGVBVUk7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLE9BQ01XLFFBRE4sQ0FWSixlQWFJO0FBQUssTUFBQSxTQUFTLEVBQUM7QUFBZixvQkFDSTtBQUFPLE1BQUEsSUFBSSxFQUFDLFVBQVo7QUFBdUIsTUFBQSxRQUFRLEVBQUUsS0FBS3BCLGVBQXRDO0FBQXVELE1BQUEsT0FBTyxFQUFFLEtBQUtGLEtBQUwsQ0FBVzhCO0FBQTNFLE1BREosQ0FiSixDQURKO0FBbUJIOztBQS9EMEQ7OztBQWtFL0RsQyxpQkFBaUIsQ0FBQ21DLFNBQWxCLEdBQThCO0FBQzFCeEIsRUFBQUEsTUFBTSxFQUFFeUIsbUJBQVVDLE1BQVYsQ0FBaUJDLFVBREM7QUFFMUJoQyxFQUFBQSxlQUFlLEVBQUU4QixtQkFBVUc7QUFGRCxDQUE5QjtBQUtBdkMsaUJBQWlCLENBQUN3QyxZQUFsQixHQUFpQztBQUM3QmxDLEVBQUFBLGVBQWUsRUFBRSxZQUFXLENBQUU7QUFERCxDQUFqQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxNiBPcGVuTWFya2V0IEx0ZFxuXG5MaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xueW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG5TZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG5saW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuXG5pbXBvcnQgKiBhcyBzZGsgZnJvbSAnLi4vLi4vLi4vaW5kZXgnO1xuaW1wb3J0IHsgX3QgfSBmcm9tICcuLi8uLi8uLi9sYW5ndWFnZUhhbmRsZXInO1xuaW1wb3J0IHtNYXRyaXhDbGllbnRQZWd9IGZyb20gJy4uLy4uLy4uL01hdHJpeENsaWVudFBlZyc7XG5pbXBvcnQge2Zvcm1hdERhdGV9IGZyb20gJy4uLy4uLy4uL0RhdGVVdGlscyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERldmljZXNQYW5lbEVudHJ5IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAgICAgdGhpcy5fdW5tb3VudGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25EZXZpY2VUb2dnbGVkID0gdGhpcy5vbkRldmljZVRvZ2dsZWQuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fb25EaXNwbGF5TmFtZUNoYW5nZWQgPSB0aGlzLl9vbkRpc3BsYXlOYW1lQ2hhbmdlZC5iaW5kKHRoaXMpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICB0aGlzLl91bm1vdW50ZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIF9vbkRpc3BsYXlOYW1lQ2hhbmdlZCh2YWx1ZSkge1xuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLnByb3BzLmRldmljZTtcbiAgICAgICAgcmV0dXJuIE1hdHJpeENsaWVudFBlZy5nZXQoKS5zZXREZXZpY2VEZXRhaWxzKGRldmljZS5kZXZpY2VfaWQsIHtcbiAgICAgICAgICAgIGRpc3BsYXlfbmFtZTogdmFsdWUsXG4gICAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBzZXNzaW9uIGRpc3BsYXkgbmFtZVwiLCBlKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfdChcIkZhaWxlZCB0byBzZXQgZGlzcGxheSBuYW1lXCIpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25EZXZpY2VUb2dnbGVkKCkge1xuICAgICAgICB0aGlzLnByb3BzLm9uRGV2aWNlVG9nZ2xlZCh0aGlzLnByb3BzLmRldmljZSk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCBFZGl0YWJsZVRleHRDb250YWluZXIgPSBzZGsuZ2V0Q29tcG9uZW50KCdlbGVtZW50cy5FZGl0YWJsZVRleHRDb250YWluZXInKTtcblxuICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzLnByb3BzLmRldmljZTtcblxuICAgICAgICBsZXQgbGFzdFNlZW4gPSBcIlwiO1xuICAgICAgICBpZiAoZGV2aWNlLmxhc3Rfc2Vlbl90cykge1xuICAgICAgICAgICAgY29uc3QgbGFzdFNlZW5EYXRlID0gZm9ybWF0RGF0ZShuZXcgRGF0ZShkZXZpY2UubGFzdF9zZWVuX3RzKSk7XG4gICAgICAgICAgICBsYXN0U2VlbiA9IGRldmljZS5sYXN0X3NlZW5faXAgKyBcIiBAIFwiICtcbiAgICAgICAgICAgICAgICBsYXN0U2VlbkRhdGUudG9Mb2NhbGVTdHJpbmcoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBteURldmljZUNsYXNzID0gJyc7XG4gICAgICAgIGlmIChkZXZpY2UuZGV2aWNlX2lkID09PSBNYXRyaXhDbGllbnRQZWcuZ2V0KCkuZ2V0RGV2aWNlSWQoKSkge1xuICAgICAgICAgICAgbXlEZXZpY2VDbGFzcyA9IFwiIG14X0RldmljZXNQYW5lbF9teURldmljZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtcIm14X0RldmljZXNQYW5lbF9kZXZpY2VcIiArIG15RGV2aWNlQ2xhc3N9PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGV2aWNlc1BhbmVsX2RldmljZUlkXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgZGV2aWNlLmRldmljZV9pZCB9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9EZXZpY2VzUGFuZWxfZGV2aWNlTmFtZVwiPlxuICAgICAgICAgICAgICAgICAgICA8RWRpdGFibGVUZXh0Q29udGFpbmVyIGluaXRpYWxWYWx1ZT17ZGV2aWNlLmRpc3BsYXlfbmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VibWl0PXt0aGlzLl9vbkRpc3BsYXlOYW1lQ2hhbmdlZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtkZXZpY2UuZGV2aWNlX2lkfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGV2aWNlc1BhbmVsX2xhc3RTZWVuXCI+XG4gICAgICAgICAgICAgICAgICAgIHsgbGFzdFNlZW4gfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfRGV2aWNlc1BhbmVsX2RldmljZUJ1dHRvbnNcIj5cbiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG9uQ2hhbmdlPXt0aGlzLm9uRGV2aWNlVG9nZ2xlZH0gY2hlY2tlZD17dGhpcy5wcm9wcy5zZWxlY3RlZH0gLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgIH1cbn1cblxuRGV2aWNlc1BhbmVsRW50cnkucHJvcFR5cGVzID0ge1xuICAgIGRldmljZTogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgIG9uRGV2aWNlVG9nZ2xlZDogUHJvcFR5cGVzLmZ1bmMsXG59O1xuXG5EZXZpY2VzUGFuZWxFbnRyeS5kZWZhdWx0UHJvcHMgPSB7XG4gICAgb25EZXZpY2VUb2dnbGVkOiBmdW5jdGlvbigpIHt9LFxufTtcbiJdfQ==