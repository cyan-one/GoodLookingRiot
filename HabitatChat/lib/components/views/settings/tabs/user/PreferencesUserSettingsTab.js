"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _languageHandler = require("../../../../../languageHandler");

var _SettingsStore = _interopRequireWildcard(require("../../../../../settings/SettingsStore"));

var _LabelledToggleSwitch = _interopRequireDefault(require("../../../elements/LabelledToggleSwitch"));

var _Field = _interopRequireDefault(require("../../../elements/Field"));

var sdk = _interopRequireWildcard(require("../../../../.."));

var _PlatformPeg = _interopRequireDefault(require("../../../../../PlatformPeg"));

/*
Copyright 2019 New Vector Ltd
Copyright 2019 Michael Telatynski <7t3chguy@gmail.com>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class PreferencesUserSettingsTab extends _react.default.Component {
  constructor() {
    super();
    (0, _defineProperty2.default)(this, "_onAutoLaunchChange", checked => {
      _PlatformPeg.default.get().setAutoLaunchEnabled(checked).then(() => this.setState({
        autoLaunch: checked
      }));
    });
    (0, _defineProperty2.default)(this, "_onAlwaysShowMenuBarChange", checked => {
      _PlatformPeg.default.get().setAutoHideMenuBarEnabled(!checked).then(() => this.setState({
        alwaysShowMenuBar: checked
      }));
    });
    (0, _defineProperty2.default)(this, "_onMinimizeToTrayChange", checked => {
      _PlatformPeg.default.get().setMinimizeToTrayEnabled(checked).then(() => this.setState({
        minimizeToTray: checked
      }));
    });
    (0, _defineProperty2.default)(this, "_onAutocompleteDelayChange", e => {
      this.setState({
        autocompleteDelay: e.target.value
      });

      _SettingsStore.default.setValue("autocompleteDelay", null, _SettingsStore.SettingLevel.DEVICE, e.target.value);
    });
    (0, _defineProperty2.default)(this, "_onReadMarkerInViewThresholdMs", e => {
      this.setState({
        readMarkerInViewThresholdMs: e.target.value
      });

      _SettingsStore.default.setValue("readMarkerInViewThresholdMs", null, _SettingsStore.SettingLevel.DEVICE, e.target.value);
    });
    (0, _defineProperty2.default)(this, "_onReadMarkerOutOfViewThresholdMs", e => {
      this.setState({
        readMarkerOutOfViewThresholdMs: e.target.value
      });

      _SettingsStore.default.setValue("readMarkerOutOfViewThresholdMs", null, _SettingsStore.SettingLevel.DEVICE, e.target.value);
    });
    this.state = {
      autoLaunch: false,
      autoLaunchSupported: false,
      alwaysShowMenuBar: true,
      alwaysShowMenuBarSupported: false,
      minimizeToTray: true,
      minimizeToTraySupported: false,
      autocompleteDelay: _SettingsStore.default.getValueAt(_SettingsStore.SettingLevel.DEVICE, 'autocompleteDelay').toString(10),
      readMarkerInViewThresholdMs: _SettingsStore.default.getValueAt(_SettingsStore.SettingLevel.DEVICE, 'readMarkerInViewThresholdMs').toString(10),
      readMarkerOutOfViewThresholdMs: _SettingsStore.default.getValueAt(_SettingsStore.SettingLevel.DEVICE, 'readMarkerOutOfViewThresholdMs').toString(10)
    };
  }

  async componentDidMount()
  /*: void*/
  {
    const platform = _PlatformPeg.default.get();

    const autoLaunchSupported = await platform.supportsAutoLaunch();
    let autoLaunch = false;

    if (autoLaunchSupported) {
      autoLaunch = await platform.getAutoLaunchEnabled();
    }

    const alwaysShowMenuBarSupported = await platform.supportsAutoHideMenuBar();
    let alwaysShowMenuBar = true;

    if (alwaysShowMenuBarSupported) {
      alwaysShowMenuBar = !(await platform.getAutoHideMenuBarEnabled());
    }

    const minimizeToTraySupported = await platform.supportsMinimizeToTray();
    let minimizeToTray = true;

    if (minimizeToTraySupported) {
      minimizeToTray = await platform.getMinimizeToTrayEnabled();
    }

    this.setState({
      autoLaunch,
      autoLaunchSupported,
      alwaysShowMenuBarSupported,
      alwaysShowMenuBar,
      minimizeToTraySupported,
      minimizeToTray
    });
  }

  _renderGroup(settingIds) {
    const SettingsFlag = sdk.getComponent("views.elements.SettingsFlag");
    return settingIds.map(i => /*#__PURE__*/_react.default.createElement(SettingsFlag, {
      key: i,
      name: i,
      level: _SettingsStore.SettingLevel.ACCOUNT
    }));
  }

  render() {
    let autoLaunchOption = null;

    if (this.state.autoLaunchSupported) {
      autoLaunchOption = /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
        value: this.state.autoLaunch,
        onChange: this._onAutoLaunchChange,
        label: (0, _languageHandler._t)('Start automatically after system login')
      });
    }

    let autoHideMenuOption = null;

    if (this.state.alwaysShowMenuBarSupported) {
      autoHideMenuOption = /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
        value: this.state.alwaysShowMenuBar,
        onChange: this._onAlwaysShowMenuBarChange,
        label: (0, _languageHandler._t)('Always show the window menu bar')
      });
    }

    let minimizeToTrayOption = null;

    if (this.state.minimizeToTraySupported) {
      minimizeToTrayOption = /*#__PURE__*/_react.default.createElement(_LabelledToggleSwitch.default, {
        value: this.state.minimizeToTray,
        onChange: this._onMinimizeToTrayChange,
        label: (0, _languageHandler._t)('Show tray icon and minimize window to it on close')
      });
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab mx_PreferencesUserSettingsTab"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_heading"
    }, (0, _languageHandler._t)("Preferences")), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Room list")), this._renderGroup(PreferencesUserSettingsTab.ROOM_LIST_SETTINGS)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Composer")), this._renderGroup(PreferencesUserSettingsTab.COMPOSER_SETTINGS)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Timeline")), this._renderGroup(PreferencesUserSettingsTab.TIMELINE_SETTINGS)), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_SettingsTab_section"
    }, /*#__PURE__*/_react.default.createElement("span", {
      className: "mx_SettingsTab_subheading"
    }, (0, _languageHandler._t)("Advanced")), this._renderGroup(PreferencesUserSettingsTab.ADVANCED_SETTINGS), minimizeToTrayOption, autoHideMenuOption, autoLaunchOption, /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)('Autocomplete delay (ms)'),
      type: "number",
      value: this.state.autocompleteDelay,
      onChange: this._onAutocompleteDelayChange
    }), /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)('Read Marker lifetime (ms)'),
      type: "number",
      value: this.state.readMarkerInViewThresholdMs,
      onChange: this._onReadMarkerInViewThresholdMs
    }), /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)('Read Marker off-screen lifetime (ms)'),
      type: "number",
      value: this.state.readMarkerOutOfViewThresholdMs,
      onChange: this._onReadMarkerOutOfViewThresholdMs
    })));
  }

}

exports.default = PreferencesUserSettingsTab;
(0, _defineProperty2.default)(PreferencesUserSettingsTab, "ROOM_LIST_SETTINGS", ['RoomList.orderAlphabetically', 'RoomList.orderByImportance', 'breadcrumbs']);
(0, _defineProperty2.default)(PreferencesUserSettingsTab, "COMPOSER_SETTINGS", ['MessageComposerInput.autoReplaceEmoji', 'MessageComposerInput.suggestEmoji', 'sendTypingNotifications']);
(0, _defineProperty2.default)(PreferencesUserSettingsTab, "TIMELINE_SETTINGS", ['showTypingNotifications', 'autoplayGifsAndVideos', 'urlPreviewsEnabled', 'TextualBody.enableBigEmoji', 'showReadReceipts', 'showTwelveHourTimestamps', 'alwaysShowTimestamps', 'showRedactions', 'enableSyntaxHighlightLanguageDetection', 'showJoinLeaves', 'showAvatarChanges', 'showDisplaynameChanges', 'showImages']);
(0, _defineProperty2.default)(PreferencesUserSettingsTab, "ADVANCED_SETTINGS", ['alwaysShowEncryptionIcons', 'Pill.shouldShowPillAvatar', 'TagPanel.enableTagPanel', 'promptBeforeInviteUnknownUsers' // Start automatically after startup (electron-only)
// Autocomplete delay (niche text box)
]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3NldHRpbmdzL3RhYnMvdXNlci9QcmVmZXJlbmNlc1VzZXJTZXR0aW5nc1RhYi5qcyJdLCJuYW1lcyI6WyJQcmVmZXJlbmNlc1VzZXJTZXR0aW5nc1RhYiIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJjaGVja2VkIiwiUGxhdGZvcm1QZWciLCJnZXQiLCJzZXRBdXRvTGF1bmNoRW5hYmxlZCIsInRoZW4iLCJzZXRTdGF0ZSIsImF1dG9MYXVuY2giLCJzZXRBdXRvSGlkZU1lbnVCYXJFbmFibGVkIiwiYWx3YXlzU2hvd01lbnVCYXIiLCJzZXRNaW5pbWl6ZVRvVHJheUVuYWJsZWQiLCJtaW5pbWl6ZVRvVHJheSIsImUiLCJhdXRvY29tcGxldGVEZWxheSIsInRhcmdldCIsInZhbHVlIiwiU2V0dGluZ3NTdG9yZSIsInNldFZhbHVlIiwiU2V0dGluZ0xldmVsIiwiREVWSUNFIiwicmVhZE1hcmtlckluVmlld1RocmVzaG9sZE1zIiwicmVhZE1hcmtlck91dE9mVmlld1RocmVzaG9sZE1zIiwic3RhdGUiLCJhdXRvTGF1bmNoU3VwcG9ydGVkIiwiYWx3YXlzU2hvd01lbnVCYXJTdXBwb3J0ZWQiLCJtaW5pbWl6ZVRvVHJheVN1cHBvcnRlZCIsImdldFZhbHVlQXQiLCJ0b1N0cmluZyIsImNvbXBvbmVudERpZE1vdW50IiwicGxhdGZvcm0iLCJzdXBwb3J0c0F1dG9MYXVuY2giLCJnZXRBdXRvTGF1bmNoRW5hYmxlZCIsInN1cHBvcnRzQXV0b0hpZGVNZW51QmFyIiwiZ2V0QXV0b0hpZGVNZW51QmFyRW5hYmxlZCIsInN1cHBvcnRzTWluaW1pemVUb1RyYXkiLCJnZXRNaW5pbWl6ZVRvVHJheUVuYWJsZWQiLCJfcmVuZGVyR3JvdXAiLCJzZXR0aW5nSWRzIiwiU2V0dGluZ3NGbGFnIiwic2RrIiwiZ2V0Q29tcG9uZW50IiwibWFwIiwiaSIsIkFDQ09VTlQiLCJyZW5kZXIiLCJhdXRvTGF1bmNoT3B0aW9uIiwiX29uQXV0b0xhdW5jaENoYW5nZSIsImF1dG9IaWRlTWVudU9wdGlvbiIsIl9vbkFsd2F5c1Nob3dNZW51QmFyQ2hhbmdlIiwibWluaW1pemVUb1RyYXlPcHRpb24iLCJfb25NaW5pbWl6ZVRvVHJheUNoYW5nZSIsIlJPT01fTElTVF9TRVRUSU5HUyIsIkNPTVBPU0VSX1NFVFRJTkdTIiwiVElNRUxJTkVfU0VUVElOR1MiLCJBRFZBTkNFRF9TRVRUSU5HUyIsIl9vbkF1dG9jb21wbGV0ZURlbGF5Q2hhbmdlIiwiX29uUmVhZE1hcmtlckluVmlld1RocmVzaG9sZE1zIiwiX29uUmVhZE1hcmtlck91dE9mVmlld1RocmVzaG9sZE1zIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQXhCQTs7Ozs7Ozs7Ozs7Ozs7OztBQTBCZSxNQUFNQSwwQkFBTixTQUF5Q0MsZUFBTUMsU0FBL0MsQ0FBeUQ7QUFzQ3BFQyxFQUFBQSxXQUFXLEdBQUc7QUFDVjtBQURVLCtEQWtEU0MsT0FBRCxJQUFhO0FBQy9CQywyQkFBWUMsR0FBWixHQUFrQkMsb0JBQWxCLENBQXVDSCxPQUF2QyxFQUFnREksSUFBaEQsQ0FBcUQsTUFBTSxLQUFLQyxRQUFMLENBQWM7QUFBQ0MsUUFBQUEsVUFBVSxFQUFFTjtBQUFiLE9BQWQsQ0FBM0Q7QUFDSCxLQXBEYTtBQUFBLHNFQXNEZ0JBLE9BQUQsSUFBYTtBQUN0Q0MsMkJBQVlDLEdBQVosR0FBa0JLLHlCQUFsQixDQUE0QyxDQUFDUCxPQUE3QyxFQUFzREksSUFBdEQsQ0FBMkQsTUFBTSxLQUFLQyxRQUFMLENBQWM7QUFBQ0csUUFBQUEsaUJBQWlCLEVBQUVSO0FBQXBCLE9BQWQsQ0FBakU7QUFDSCxLQXhEYTtBQUFBLG1FQTBEYUEsT0FBRCxJQUFhO0FBQ25DQywyQkFBWUMsR0FBWixHQUFrQk8sd0JBQWxCLENBQTJDVCxPQUEzQyxFQUFvREksSUFBcEQsQ0FBeUQsTUFB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QixFQUl2QixnQ0FKdUIsQ0FLdkI7QUFDQTtBQU51QixDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5Db3B5cmlnaHQgMjAxOSBNaWNoYWVsIFRlbGF0eW5za2kgPDd0M2NoZ3V5QGdtYWlsLmNvbT5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtfdH0gZnJvbSBcIi4uLy4uLy4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IHtTZXR0aW5nTGV2ZWx9IGZyb20gXCIuLi8uLi8uLi8uLi8uLi9zZXR0aW5ncy9TZXR0aW5nc1N0b3JlXCI7XG5pbXBvcnQgTGFiZWxsZWRUb2dnbGVTd2l0Y2ggZnJvbSBcIi4uLy4uLy4uL2VsZW1lbnRzL0xhYmVsbGVkVG9nZ2xlU3dpdGNoXCI7XG5pbXBvcnQgU2V0dGluZ3NTdG9yZSBmcm9tIFwiLi4vLi4vLi4vLi4vLi4vc2V0dGluZ3MvU2V0dGluZ3NTdG9yZVwiO1xuaW1wb3J0IEZpZWxkIGZyb20gXCIuLi8uLi8uLi9lbGVtZW50cy9GaWVsZFwiO1xuaW1wb3J0ICogYXMgc2RrIGZyb20gXCIuLi8uLi8uLi8uLi8uLlwiO1xuaW1wb3J0IFBsYXRmb3JtUGVnIGZyb20gXCIuLi8uLi8uLi8uLi8uLi9QbGF0Zm9ybVBlZ1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQcmVmZXJlbmNlc1VzZXJTZXR0aW5nc1RhYiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgc3RhdGljIFJPT01fTElTVF9TRVRUSU5HUyA9IFtcbiAgICAgICAgJ1Jvb21MaXN0Lm9yZGVyQWxwaGFiZXRpY2FsbHknLFxuICAgICAgICAnUm9vbUxpc3Qub3JkZXJCeUltcG9ydGFuY2UnLFxuICAgICAgICAnYnJlYWRjcnVtYnMnLFxuICAgIF07XG5cbiAgICBzdGF0aWMgQ09NUE9TRVJfU0VUVElOR1MgPSBbXG4gICAgICAgICdNZXNzYWdlQ29tcG9zZXJJbnB1dC5hdXRvUmVwbGFjZUVtb2ppJyxcbiAgICAgICAgJ01lc3NhZ2VDb21wb3NlcklucHV0LnN1Z2dlc3RFbW9qaScsXG4gICAgICAgICdzZW5kVHlwaW5nTm90aWZpY2F0aW9ucycsXG4gICAgXTtcblxuICAgIHN0YXRpYyBUSU1FTElORV9TRVRUSU5HUyA9IFtcbiAgICAgICAgJ3Nob3dUeXBpbmdOb3RpZmljYXRpb25zJyxcbiAgICAgICAgJ2F1dG9wbGF5R2lmc0FuZFZpZGVvcycsXG4gICAgICAgICd1cmxQcmV2aWV3c0VuYWJsZWQnLFxuICAgICAgICAnVGV4dHVhbEJvZHkuZW5hYmxlQmlnRW1vamknLFxuICAgICAgICAnc2hvd1JlYWRSZWNlaXB0cycsXG4gICAgICAgICdzaG93VHdlbHZlSG91clRpbWVzdGFtcHMnLFxuICAgICAgICAnYWx3YXlzU2hvd1RpbWVzdGFtcHMnLFxuICAgICAgICAnc2hvd1JlZGFjdGlvbnMnLFxuICAgICAgICAnZW5hYmxlU3ludGF4SGlnaGxpZ2h0TGFuZ3VhZ2VEZXRlY3Rpb24nLFxuICAgICAgICAnc2hvd0pvaW5MZWF2ZXMnLFxuICAgICAgICAnc2hvd0F2YXRhckNoYW5nZXMnLFxuICAgICAgICAnc2hvd0Rpc3BsYXluYW1lQ2hhbmdlcycsXG4gICAgICAgICdzaG93SW1hZ2VzJyxcbiAgICBdO1xuXG4gICAgc3RhdGljIEFEVkFOQ0VEX1NFVFRJTkdTID0gW1xuICAgICAgICAnYWx3YXlzU2hvd0VuY3J5cHRpb25JY29ucycsXG4gICAgICAgICdQaWxsLnNob3VsZFNob3dQaWxsQXZhdGFyJyxcbiAgICAgICAgJ1RhZ1BhbmVsLmVuYWJsZVRhZ1BhbmVsJyxcbiAgICAgICAgJ3Byb21wdEJlZm9yZUludml0ZVVua25vd25Vc2VycycsXG4gICAgICAgIC8vIFN0YXJ0IGF1dG9tYXRpY2FsbHkgYWZ0ZXIgc3RhcnR1cCAoZWxlY3Ryb24tb25seSlcbiAgICAgICAgLy8gQXV0b2NvbXBsZXRlIGRlbGF5IChuaWNoZSB0ZXh0IGJveClcbiAgICBdO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGF1dG9MYXVuY2g6IGZhbHNlLFxuICAgICAgICAgICAgYXV0b0xhdW5jaFN1cHBvcnRlZDogZmFsc2UsXG4gICAgICAgICAgICBhbHdheXNTaG93TWVudUJhcjogdHJ1ZSxcbiAgICAgICAgICAgIGFsd2F5c1Nob3dNZW51QmFyU3VwcG9ydGVkOiBmYWxzZSxcbiAgICAgICAgICAgIG1pbmltaXplVG9UcmF5OiB0cnVlLFxuICAgICAgICAgICAgbWluaW1pemVUb1RyYXlTdXBwb3J0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgYXV0b2NvbXBsZXRlRGVsYXk6XG4gICAgICAgICAgICAgICAgU2V0dGluZ3NTdG9yZS5nZXRWYWx1ZUF0KFNldHRpbmdMZXZlbC5ERVZJQ0UsICdhdXRvY29tcGxldGVEZWxheScpLnRvU3RyaW5nKDEwKSxcbiAgICAgICAgICAgIHJlYWRNYXJrZXJJblZpZXdUaHJlc2hvbGRNczpcbiAgICAgICAgICAgICAgICBTZXR0aW5nc1N0b3JlLmdldFZhbHVlQXQoU2V0dGluZ0xldmVsLkRFVklDRSwgJ3JlYWRNYXJrZXJJblZpZXdUaHJlc2hvbGRNcycpLnRvU3RyaW5nKDEwKSxcbiAgICAgICAgICAgIHJlYWRNYXJrZXJPdXRPZlZpZXdUaHJlc2hvbGRNczpcbiAgICAgICAgICAgICAgICBTZXR0aW5nc1N0b3JlLmdldFZhbHVlQXQoU2V0dGluZ0xldmVsLkRFVklDRSwgJ3JlYWRNYXJrZXJPdXRPZlZpZXdUaHJlc2hvbGRNcycpLnRvU3RyaW5nKDEwKSxcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBhc3luYyBjb21wb25lbnREaWRNb3VudCgpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgcGxhdGZvcm0gPSBQbGF0Zm9ybVBlZy5nZXQoKTtcblxuICAgICAgICBjb25zdCBhdXRvTGF1bmNoU3VwcG9ydGVkID0gYXdhaXQgcGxhdGZvcm0uc3VwcG9ydHNBdXRvTGF1bmNoKCk7XG4gICAgICAgIGxldCBhdXRvTGF1bmNoID0gZmFsc2U7XG4gICAgICAgIGlmIChhdXRvTGF1bmNoU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBhdXRvTGF1bmNoID0gYXdhaXQgcGxhdGZvcm0uZ2V0QXV0b0xhdW5jaEVuYWJsZWQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGFsd2F5c1Nob3dNZW51QmFyU3VwcG9ydGVkID0gYXdhaXQgcGxhdGZvcm0uc3VwcG9ydHNBdXRvSGlkZU1lbnVCYXIoKTtcbiAgICAgICAgbGV0IGFsd2F5c1Nob3dNZW51QmFyID0gdHJ1ZTtcbiAgICAgICAgaWYgKGFsd2F5c1Nob3dNZW51QmFyU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBhbHdheXNTaG93TWVudUJhciA9ICFhd2FpdCBwbGF0Zm9ybS5nZXRBdXRvSGlkZU1lbnVCYXJFbmFibGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtaW5pbWl6ZVRvVHJheVN1cHBvcnRlZCA9IGF3YWl0IHBsYXRmb3JtLnN1cHBvcnRzTWluaW1pemVUb1RyYXkoKTtcbiAgICAgICAgbGV0IG1pbmltaXplVG9UcmF5ID0gdHJ1ZTtcbiAgICAgICAgaWYgKG1pbmltaXplVG9UcmF5U3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBtaW5pbWl6ZVRvVHJheSA9IGF3YWl0IHBsYXRmb3JtLmdldE1pbmltaXplVG9UcmF5RW5hYmxlZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBhdXRvTGF1bmNoLFxuICAgICAgICAgICAgYXV0b0xhdW5jaFN1cHBvcnRlZCxcbiAgICAgICAgICAgIGFsd2F5c1Nob3dNZW51QmFyU3VwcG9ydGVkLFxuICAgICAgICAgICAgYWx3YXlzU2hvd01lbnVCYXIsXG4gICAgICAgICAgICBtaW5pbWl6ZVRvVHJheVN1cHBvcnRlZCxcbiAgICAgICAgICAgIG1pbmltaXplVG9UcmF5LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfb25BdXRvTGF1bmNoQ2hhbmdlID0gKGNoZWNrZWQpID0+IHtcbiAgICAgICAgUGxhdGZvcm1QZWcuZ2V0KCkuc2V0QXV0b0xhdW5jaEVuYWJsZWQoY2hlY2tlZCkudGhlbigoKSA9PiB0aGlzLnNldFN0YXRlKHthdXRvTGF1bmNoOiBjaGVja2VkfSkpO1xuICAgIH07XG5cbiAgICBfb25BbHdheXNTaG93TWVudUJhckNoYW5nZSA9IChjaGVja2VkKSA9PiB7XG4gICAgICAgIFBsYXRmb3JtUGVnLmdldCgpLnNldEF1dG9IaWRlTWVudUJhckVuYWJsZWQoIWNoZWNrZWQpLnRoZW4oKCkgPT4gdGhpcy5zZXRTdGF0ZSh7YWx3YXlzU2hvd01lbnVCYXI6IGNoZWNrZWR9KSk7XG4gICAgfTtcblxuICAgIF9vbk1pbmltaXplVG9UcmF5Q2hhbmdlID0gKGNoZWNrZWQpID0+IHtcbiAgICAgICAgUGxhdGZvcm1QZWcuZ2V0KCkuc2V0TWluaW1pemVUb1RyYXlFbmFibGVkKGNoZWNrZWQpLnRoZW4oKCkgPT4gdGhpcy5zZXRTdGF0ZSh7bWluaW1pemVUb1RyYXk6IGNoZWNrZWR9KSk7XG4gICAgfTtcblxuICAgIF9vbkF1dG9jb21wbGV0ZURlbGF5Q2hhbmdlID0gKGUpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7YXV0b2NvbXBsZXRlRGVsYXk6IGUudGFyZ2V0LnZhbHVlfSk7XG4gICAgICAgIFNldHRpbmdzU3RvcmUuc2V0VmFsdWUoXCJhdXRvY29tcGxldGVEZWxheVwiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCBlLnRhcmdldC52YWx1ZSk7XG4gICAgfTtcblxuICAgIF9vblJlYWRNYXJrZXJJblZpZXdUaHJlc2hvbGRNcyA9IChlKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe3JlYWRNYXJrZXJJblZpZXdUaHJlc2hvbGRNczogZS50YXJnZXQudmFsdWV9KTtcbiAgICAgICAgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcInJlYWRNYXJrZXJJblZpZXdUaHJlc2hvbGRNc1wiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCBlLnRhcmdldC52YWx1ZSk7XG4gICAgfTtcblxuICAgIF9vblJlYWRNYXJrZXJPdXRPZlZpZXdUaHJlc2hvbGRNcyA9IChlKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe3JlYWRNYXJrZXJPdXRPZlZpZXdUaHJlc2hvbGRNczogZS50YXJnZXQudmFsdWV9KTtcbiAgICAgICAgU2V0dGluZ3NTdG9yZS5zZXRWYWx1ZShcInJlYWRNYXJrZXJPdXRPZlZpZXdUaHJlc2hvbGRNc1wiLCBudWxsLCBTZXR0aW5nTGV2ZWwuREVWSUNFLCBlLnRhcmdldC52YWx1ZSk7XG4gICAgfTtcblxuICAgIF9yZW5kZXJHcm91cChzZXR0aW5nSWRzKSB7XG4gICAgICAgIGNvbnN0IFNldHRpbmdzRmxhZyA9IHNkay5nZXRDb21wb25lbnQoXCJ2aWV3cy5lbGVtZW50cy5TZXR0aW5nc0ZsYWdcIik7XG4gICAgICAgIHJldHVybiBzZXR0aW5nSWRzLm1hcChpID0+IDxTZXR0aW5nc0ZsYWcga2V5PXtpfSBuYW1lPXtpfSBsZXZlbD17U2V0dGluZ0xldmVsLkFDQ09VTlR9IC8+KTtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGxldCBhdXRvTGF1bmNoT3B0aW9uID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuYXV0b0xhdW5jaFN1cHBvcnRlZCkge1xuICAgICAgICAgICAgYXV0b0xhdW5jaE9wdGlvbiA9IDxMYWJlbGxlZFRvZ2dsZVN3aXRjaFxuICAgICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLmF1dG9MYXVuY2h9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX29uQXV0b0xhdW5jaENoYW5nZX1cbiAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ1N0YXJ0IGF1dG9tYXRpY2FsbHkgYWZ0ZXIgc3lzdGVtIGxvZ2luJyl9IC8+O1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGF1dG9IaWRlTWVudU9wdGlvbiA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmFsd2F5c1Nob3dNZW51QmFyU3VwcG9ydGVkKSB7XG4gICAgICAgICAgICBhdXRvSGlkZU1lbnVPcHRpb24gPSA8TGFiZWxsZWRUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5hbHdheXNTaG93TWVudUJhcn1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fb25BbHdheXNTaG93TWVudUJhckNoYW5nZX1cbiAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ0Fsd2F5cyBzaG93IHRoZSB3aW5kb3cgbWVudSBiYXInKX0gLz47XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbWluaW1pemVUb1RyYXlPcHRpb24gPSBudWxsO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5taW5pbWl6ZVRvVHJheVN1cHBvcnRlZCkge1xuICAgICAgICAgICAgbWluaW1pemVUb1RyYXlPcHRpb24gPSA8TGFiZWxsZWRUb2dnbGVTd2l0Y2hcbiAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5taW5pbWl6ZVRvVHJheX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fb25NaW5pbWl6ZVRvVHJheUNoYW5nZX1cbiAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ1Nob3cgdHJheSBpY29uIGFuZCBtaW5pbWl6ZSB3aW5kb3cgdG8gaXQgb24gY2xvc2UnKX0gLz47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYiBteF9QcmVmZXJlbmNlc1VzZXJTZXR0aW5nc1RhYlwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfaGVhZGluZ1wiPntfdChcIlByZWZlcmVuY2VzXCIpfTwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57X3QoXCJSb29tIGxpc3RcIil9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5fcmVuZGVyR3JvdXAoUHJlZmVyZW5jZXNVc2VyU2V0dGluZ3NUYWIuUk9PTV9MSVNUX1NFVFRJTkdTKX1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc2VjdGlvblwiPlxuICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zdWJoZWFkaW5nXCI+e190KFwiQ29tcG9zZXJcIil9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICB7dGhpcy5fcmVuZGVyR3JvdXAoUHJlZmVyZW5jZXNVc2VyU2V0dGluZ3NUYWIuQ09NUE9TRVJfU0VUVElOR1MpfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJteF9TZXR0aW5nc1RhYl9zZWN0aW9uXCI+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3N1YmhlYWRpbmdcIj57X3QoXCJUaW1lbGluZVwiKX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIHt0aGlzLl9yZW5kZXJHcm91cChQcmVmZXJlbmNlc1VzZXJTZXR0aW5nc1RhYi5USU1FTElORV9TRVRUSU5HUyl9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1NldHRpbmdzVGFiX3NlY3Rpb25cIj5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibXhfU2V0dGluZ3NUYWJfc3ViaGVhZGluZ1wiPntfdChcIkFkdmFuY2VkXCIpfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAge3RoaXMuX3JlbmRlckdyb3VwKFByZWZlcmVuY2VzVXNlclNldHRpbmdzVGFiLkFEVkFOQ0VEX1NFVFRJTkdTKX1cbiAgICAgICAgICAgICAgICAgICAge21pbmltaXplVG9UcmF5T3B0aW9ufVxuICAgICAgICAgICAgICAgICAgICB7YXV0b0hpZGVNZW51T3B0aW9ufVxuICAgICAgICAgICAgICAgICAgICB7YXV0b0xhdW5jaE9wdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgPEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD17X3QoJ0F1dG9jb21wbGV0ZSBkZWxheSAobXMpJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSdudW1iZXInXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5hdXRvY29tcGxldGVEZWxheX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLl9vbkF1dG9jb21wbGV0ZURlbGF5Q2hhbmdlfSAvPlxuICAgICAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdCgnUmVhZCBNYXJrZXIgbGlmZXRpbWUgKG1zKScpfVxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT0nbnVtYmVyJ1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUucmVhZE1hcmtlckluVmlld1RocmVzaG9sZE1zfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX29uUmVhZE1hcmtlckluVmlld1RocmVzaG9sZE1zfSAvPlxuICAgICAgICAgICAgICAgICAgICA8RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPXtfdCgnUmVhZCBNYXJrZXIgb2ZmLXNjcmVlbiBsaWZldGltZSAobXMpJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlPSdudW1iZXInXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS5yZWFkTWFya2VyT3V0T2ZWaWV3VGhyZXNob2xkTXN9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fb25SZWFkTWFya2VyT3V0T2ZWaWV3VGhyZXNob2xkTXN9IC8+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICB9XG59XG4iXX0=