"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _languageHandler = require("../../../languageHandler");

var _MatrixClientPeg = require("../../../MatrixClientPeg");

var _Field = _interopRequireDefault(require("../elements/Field"));

var sdk = _interopRequireWildcard(require("../../../index"));

/*
Copyright 2019 New Vector Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
// TODO: Merge with ProfileSettings?
class RoomProfileSettings extends _react.default.Component {
  constructor(props) {
    super(props);
    (0, _defineProperty2.default)(this, "_uploadAvatar", () => {
      this._avatarUpload.current.click();
    });
    (0, _defineProperty2.default)(this, "_removeAvatar", () => {
      // clear file upload field so same file can be selected
      this._avatarUpload.current.value = "";
      this.setState({
        avatarUrl: undefined,
        avatarFile: undefined,
        enableProfileSave: true
      });
    });
    (0, _defineProperty2.default)(this, "_saveProfile", async e => {
      e.stopPropagation();
      e.preventDefault();
      if (!this.state.enableProfileSave) return;
      this.setState({
        enableProfileSave: false
      });

      const client = _MatrixClientPeg.MatrixClientPeg.get();

      const newState = {}; // TODO: What do we do about errors?

      if (this.state.originalDisplayName !== this.state.displayName) {
        await client.setRoomName(this.props.roomId, this.state.displayName);
        newState.originalDisplayName = this.state.displayName;
      }

      if (this.state.avatarFile) {
        const uri = await client.uploadContent(this.state.avatarFile);
        await client.sendStateEvent(this.props.roomId, 'm.room.avatar', {
          url: uri
        }, '');
        newState.avatarUrl = client.mxcUrlToHttp(uri, 96, 96, 'crop', false);
        newState.originalAvatarUrl = newState.avatarUrl;
        newState.avatarFile = null;
      } else if (this.state.originalAvatarUrl !== this.state.avatarUrl) {
        await client.sendStateEvent(this.props.roomId, 'm.room.avatar', {
          url: undefined
        }, '');
      }

      if (this.state.originalTopic !== this.state.topic) {
        await client.setRoomTopic(this.props.roomId, this.state.topic);
        newState.originalTopic = this.state.topic;
      }

      this.setState(newState);
    });
    (0, _defineProperty2.default)(this, "_onDisplayNameChanged", e => {
      this.setState({
        displayName: e.target.value,
        enableProfileSave: true
      });
    });
    (0, _defineProperty2.default)(this, "_onTopicChanged", e => {
      this.setState({
        topic: e.target.value,
        enableProfileSave: true
      });
    });
    (0, _defineProperty2.default)(this, "_onAvatarChanged", e => {
      if (!e.target.files || !e.target.files.length) {
        this.setState({
          avatarUrl: this.state.originalAvatarUrl,
          avatarFile: null,
          enableProfileSave: false
        });
        return;
      }

      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = ev => {
        this.setState({
          avatarUrl: ev.target.result,
          avatarFile: file,
          enableProfileSave: true
        });
      };

      reader.readAsDataURL(file);
    });

    const _client = _MatrixClientPeg.MatrixClientPeg.get();

    const room = _client.getRoom(props.roomId);

    if (!room) throw new Error("Expected a room for ID: ", props.roomId);
    const avatarEvent = room.currentState.getStateEvents("m.room.avatar", "");
    let avatarUrl = avatarEvent && avatarEvent.getContent() ? avatarEvent.getContent()["url"] : null;
    if (avatarUrl) avatarUrl = _client.mxcUrlToHttp(avatarUrl, 96, 96, 'crop', false);
    const topicEvent = room.currentState.getStateEvents("m.room.topic", "");
    const topic = topicEvent && topicEvent.getContent() ? topicEvent.getContent()['topic'] : '';
    const nameEvent = room.currentState.getStateEvents('m.room.name', '');
    const name = nameEvent && nameEvent.getContent() ? nameEvent.getContent()['name'] : '';
    this.state = {
      originalDisplayName: name,
      displayName: name,
      originalAvatarUrl: avatarUrl,
      avatarUrl: avatarUrl,
      avatarFile: null,
      originalTopic: topic,
      topic: topic,
      enableProfileSave: false,
      canSetName: room.currentState.maySendStateEvent('m.room.name', _client.getUserId()),
      canSetTopic: room.currentState.maySendStateEvent('m.room.topic', _client.getUserId()),
      canSetAvatar: room.currentState.maySendStateEvent('m.room.avatar', _client.getUserId())
    };
    this._avatarUpload = (0, _react.createRef)();
  }

  render() {
    const AccessibleButton = sdk.getComponent('elements.AccessibleButton');
    const AvatarSetting = sdk.getComponent('settings.AvatarSetting');
    return /*#__PURE__*/_react.default.createElement("form", {
      onSubmit: this._saveProfile,
      autoComplete: "off",
      noValidate: true
    }, /*#__PURE__*/_react.default.createElement("input", {
      type: "file",
      ref: this._avatarUpload,
      className: "mx_ProfileSettings_avatarUpload",
      onChange: this._onAvatarChanged,
      accept: "image/*"
    }), /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ProfileSettings_profile"
    }, /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_ProfileSettings_controls"
    }, /*#__PURE__*/_react.default.createElement(_Field.default, {
      label: (0, _languageHandler._t)("Room Name"),
      type: "text",
      value: this.state.displayName,
      autoComplete: "off",
      onChange: this._onDisplayNameChanged,
      disabled: !this.state.canSetName
    }), /*#__PURE__*/_react.default.createElement(_Field.default, {
      id: "profileTopic",
      label: (0, _languageHandler._t)("Room Topic"),
      disabled: !this.state.canSetTopic,
      type: "text",
      value: this.state.topic,
      autoComplete: "off",
      onChange: this._onTopicChanged,
      element: "textarea"
    })), /*#__PURE__*/_react.default.createElement(AvatarSetting, {
      avatarUrl: this.state.avatarUrl,
      avatarName: this.state.displayName || this.props.roomId,
      avatarAltText: (0, _languageHandler._t)("Room avatar"),
      uploadAvatar: this.state.canSetAvatar ? this._uploadAvatar : undefined,
      removeAvatar: this.state.canSetAvatar ? this._removeAvatar : undefined
    })), /*#__PURE__*/_react.default.createElement(AccessibleButton, {
      onClick: this._saveProfile,
      kind: "primary",
      disabled: !this.state.enableProfileSave
    }, (0, _languageHandler._t)("Save")));
  }

}

exports.default = RoomProfileSettings;
(0, _defineProperty2.default)(RoomProfileSettings, "propTypes", {
  roomId: _propTypes.default.string.isRequired
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3ZpZXdzL3Jvb21fc2V0dGluZ3MvUm9vbVByb2ZpbGVTZXR0aW5ncy5qcyJdLCJuYW1lcyI6WyJSb29tUHJvZmlsZVNldHRpbmdzIiwiUmVhY3QiLCJDb21wb25lbnQiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwiX2F2YXRhclVwbG9hZCIsImN1cnJlbnQiLCJjbGljayIsInZhbHVlIiwic2V0U3RhdGUiLCJhdmF0YXJVcmwiLCJ1bmRlZmluZWQiLCJhdmF0YXJGaWxlIiwiZW5hYmxlUHJvZmlsZVNhdmUiLCJlIiwic3RvcFByb3BhZ2F0aW9uIiwicHJldmVudERlZmF1bHQiLCJzdGF0ZSIsImNsaWVudCIsIk1hdHJpeENsaWVudFBlZyIsImdldCIsIm5ld1N0YXRlIiwib3JpZ2luYWxEaXNwbGF5TmFtZSIsImRpc3BsYXlOYW1lIiwic2V0Um9vbU5hbWUiLCJyb29tSWQiLCJ1cmkiLCJ1cGxvYWRDb250ZW50Iiwic2VuZFN0YXRlRXZlbnQiLCJ1cmwiLCJteGNVcmxUb0h0dHAiLCJvcmlnaW5hbEF2YXRhclVybCIsIm9yaWdpbmFsVG9waWMiLCJ0b3BpYyIsInNldFJvb21Ub3BpYyIsInRhcmdldCIsImZpbGVzIiwibGVuZ3RoIiwiZmlsZSIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJldiIsInJlc3VsdCIsInJlYWRBc0RhdGFVUkwiLCJyb29tIiwiZ2V0Um9vbSIsIkVycm9yIiwiYXZhdGFyRXZlbnQiLCJjdXJyZW50U3RhdGUiLCJnZXRTdGF0ZUV2ZW50cyIsImdldENvbnRlbnQiLCJ0b3BpY0V2ZW50IiwibmFtZUV2ZW50IiwibmFtZSIsImNhblNldE5hbWUiLCJtYXlTZW5kU3RhdGVFdmVudCIsImdldFVzZXJJZCIsImNhblNldFRvcGljIiwiY2FuU2V0QXZhdGFyIiwicmVuZGVyIiwiQWNjZXNzaWJsZUJ1dHRvbiIsInNkayIsImdldENvbXBvbmVudCIsIkF2YXRhclNldHRpbmciLCJfc2F2ZVByb2ZpbGUiLCJfb25BdmF0YXJDaGFuZ2VkIiwiX29uRGlzcGxheU5hbWVDaGFuZ2VkIiwiX29uVG9waWNDaGFuZ2VkIiwiX3VwbG9hZEF2YXRhciIsIl9yZW1vdmVBdmF0YXIiLCJQcm9wVHlwZXMiLCJzdHJpbmciLCJpc1JlcXVpcmVkIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBZ0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQXJCQTs7Ozs7Ozs7Ozs7Ozs7O0FBdUJBO0FBQ2UsTUFBTUEsbUJBQU4sU0FBa0NDLGVBQU1DLFNBQXhDLENBQWtEO0FBSzdEQyxFQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUTtBQUNmLFVBQU1BLEtBQU47QUFEZSx5REFrQ0gsTUFBTTtBQUNsQixXQUFLQyxhQUFMLENBQW1CQyxPQUFuQixDQUEyQkMsS0FBM0I7QUFDSCxLQXBDa0I7QUFBQSx5REFzQ0gsTUFBTTtBQUNsQjtBQUNBLFdBQUtGLGFBQUwsQ0FBbUJDLE9BQW5CLENBQTJCRSxLQUEzQixHQUFtQyxFQUFuQztBQUNBLFdBQUtDLFFBQUwsQ0FBYztBQUNWQyxRQUFBQSxTQUFTLEVBQUVDLFNBREQ7QUFFVkMsUUFBQUEsVUFBVSxFQUFFRCxTQUZGO0FBR1ZFLFFBQUFBLGlCQUFpQixFQUFFO0FBSFQsT0FBZDtBQUtILEtBOUNrQjtBQUFBLHdEQWdESixNQUFPQyxDQUFQLElBQWE7QUFDeEJBLE1BQUFBLENBQUMsQ0FBQ0MsZUFBRjtBQUNBRCxNQUFBQSxDQUFDLENBQUNFLGNBQUY7QUFFQSxVQUFJLENBQUMsS0FBS0MsS0FBTCxDQUFXSixpQkFBaEIsRUFBbUM7QUFDbkMsV0FBS0osUUFBTCxDQUFjO0FBQUNJLFFBQUFBLGlCQUFpQixFQUFFO0FBQXBCLE9BQWQ7O0FBRUEsWUFBTUssTUFBTSxHQUFHQyxpQ0FBZ0JDLEdBQWhCLEVBQWY7O0FBQ0EsWUFBTUMsUUFBUSxHQUFHLEVBQWpCLENBUndCLENBVXhCOztBQUVBLFVBQUksS0FBS0osS0FBTCxDQUFXSyxtQkFBWCxLQUFt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QztBQUYvQyxNQUpKLENBREosZUFTSSw2QkFBQyxhQUFEO0FBQ0ksTUFBQSxTQUFTLEVBQUUsS0FBS25ELEtBQUwsQ0FBV1AsU0FEMUI7QUFFSSxNQUFBLFVBQVUsRUFBRSxLQUFLTyxLQUFMLENBQVdNLFdBQVgsSUFBMEIsS0FBS25CLEtBQUwsQ0FBV3FCLE1BRnJEO0FBR0ksTUFBQSxhQUFhLEVBQUUseUJBQUcsYUFBSCxDQUhuQjtBQUlJLE1BQUEsWUFBWSxFQUFFLEtBQUtSLEtBQUwsQ0FBVzBDLFlBQVgsR0FBMEIsS0FBS1UsYUFBL0IsR0FBK0MxRCxTQUpqRTtBQUtJLE1BQUEsWUFBWSxFQUFFLEtBQUtNLEtBQUwsQ0FBVzBDLFlBQVgsR0FBMEIsS0FBS1csYUFBL0IsR0FBK0MzRDtBQUxqRSxNQVRKLENBSEosZUFtQkksNkJBQUMsZ0JBQUQ7QUFBa0IsTUFBQSxPQUFPLEVBQUUsS0FBS3NELFlBQWhDO0FBQThDLE1BQUEsSUFBSSxFQUFDLFNBQW5EO0FBQ2tCLE1BQUEsUUFBUSxFQUFFLENBQUMsS0FBS2hELEtBQUwsQ0FBV0o7QUFEeEMsT0FFSyx5QkFBRyxNQUFILENBRkwsQ0FuQkosQ0FESjtBQTBCSDs7QUF6SjREOzs7OEJBQTVDYixtQixlQUNFO0FBQ2Z5QixFQUFBQSxNQUFNLEVBQUU4QyxtQkFBVUMsTUFBVixDQUFpQkM7QUFEVixDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkNvcHlyaWdodCAyMDE5IE5ldyBWZWN0b3IgTHRkXG5cbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG55b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG5Zb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcblxuICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuXG5Vbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG5kaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG5XSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cblNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbmxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuKi9cblxuaW1wb3J0IFJlYWN0LCB7Y3JlYXRlUmVmfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtfdH0gZnJvbSBcIi4uLy4uLy4uL2xhbmd1YWdlSGFuZGxlclwiO1xuaW1wb3J0IHtNYXRyaXhDbGllbnRQZWd9IGZyb20gXCIuLi8uLi8uLi9NYXRyaXhDbGllbnRQZWdcIjtcbmltcG9ydCBGaWVsZCBmcm9tIFwiLi4vZWxlbWVudHMvRmllbGRcIjtcbmltcG9ydCAqIGFzIHNkayBmcm9tIFwiLi4vLi4vLi4vaW5kZXhcIjtcblxuLy8gVE9ETzogTWVyZ2Ugd2l0aCBQcm9maWxlU2V0dGluZ3M/XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb29tUHJvZmlsZVNldHRpbmdzIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgICAgICByb29tSWQ6IFByb3BUeXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgY29uc3Qgcm9vbSA9IGNsaWVudC5nZXRSb29tKHByb3BzLnJvb21JZCk7XG4gICAgICAgIGlmICghcm9vbSkgdGhyb3cgbmV3IEVycm9yKFwiRXhwZWN0ZWQgYSByb29tIGZvciBJRDogXCIsIHByb3BzLnJvb21JZCk7XG5cbiAgICAgICAgY29uc3QgYXZhdGFyRXZlbnQgPSByb29tLmN1cnJlbnRTdGF0ZS5nZXRTdGF0ZUV2ZW50cyhcIm0ucm9vbS5hdmF0YXJcIiwgXCJcIik7XG4gICAgICAgIGxldCBhdmF0YXJVcmwgPSBhdmF0YXJFdmVudCAmJiBhdmF0YXJFdmVudC5nZXRDb250ZW50KCkgPyBhdmF0YXJFdmVudC5nZXRDb250ZW50KClbXCJ1cmxcIl0gOiBudWxsO1xuICAgICAgICBpZiAoYXZhdGFyVXJsKSBhdmF0YXJVcmwgPSBjbGllbnQubXhjVXJsVG9IdHRwKGF2YXRhclVybCwgOTYsIDk2LCAnY3JvcCcsIGZhbHNlKTtcblxuICAgICAgICBjb25zdCB0b3BpY0V2ZW50ID0gcm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoXCJtLnJvb20udG9waWNcIiwgXCJcIik7XG4gICAgICAgIGNvbnN0IHRvcGljID0gdG9waWNFdmVudCAmJiB0b3BpY0V2ZW50LmdldENvbnRlbnQoKSA/IHRvcGljRXZlbnQuZ2V0Q29udGVudCgpWyd0b3BpYyddIDogJyc7XG5cbiAgICAgICAgY29uc3QgbmFtZUV2ZW50ID0gcm9vbS5jdXJyZW50U3RhdGUuZ2V0U3RhdGVFdmVudHMoJ20ucm9vbS5uYW1lJywgJycpO1xuICAgICAgICBjb25zdCBuYW1lID0gbmFtZUV2ZW50ICYmIG5hbWVFdmVudC5nZXRDb250ZW50KCkgPyBuYW1lRXZlbnQuZ2V0Q29udGVudCgpWyduYW1lJ10gOiAnJztcblxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgb3JpZ2luYWxEaXNwbGF5TmFtZTogbmFtZSxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBuYW1lLFxuICAgICAgICAgICAgb3JpZ2luYWxBdmF0YXJVcmw6IGF2YXRhclVybCxcbiAgICAgICAgICAgIGF2YXRhclVybDogYXZhdGFyVXJsLFxuICAgICAgICAgICAgYXZhdGFyRmlsZTogbnVsbCxcbiAgICAgICAgICAgIG9yaWdpbmFsVG9waWM6IHRvcGljLFxuICAgICAgICAgICAgdG9waWM6IHRvcGljLFxuICAgICAgICAgICAgZW5hYmxlUHJvZmlsZVNhdmU6IGZhbHNlLFxuICAgICAgICAgICAgY2FuU2V0TmFtZTogcm9vbS5jdXJyZW50U3RhdGUubWF5U2VuZFN0YXRlRXZlbnQoJ20ucm9vbS5uYW1lJywgY2xpZW50LmdldFVzZXJJZCgpKSxcbiAgICAgICAgICAgIGNhblNldFRvcGljOiByb29tLmN1cnJlbnRTdGF0ZS5tYXlTZW5kU3RhdGVFdmVudCgnbS5yb29tLnRvcGljJywgY2xpZW50LmdldFVzZXJJZCgpKSxcbiAgICAgICAgICAgIGNhblNldEF2YXRhcjogcm9vbS5jdXJyZW50U3RhdGUubWF5U2VuZFN0YXRlRXZlbnQoJ20ucm9vbS5hdmF0YXInLCBjbGllbnQuZ2V0VXNlcklkKCkpLFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuX2F2YXRhclVwbG9hZCA9IGNyZWF0ZVJlZigpO1xuICAgIH1cblxuICAgIF91cGxvYWRBdmF0YXIgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2F2YXRhclVwbG9hZC5jdXJyZW50LmNsaWNrKCk7XG4gICAgfTtcblxuICAgIF9yZW1vdmVBdmF0YXIgPSAoKSA9PiB7XG4gICAgICAgIC8vIGNsZWFyIGZpbGUgdXBsb2FkIGZpZWxkIHNvIHNhbWUgZmlsZSBjYW4gYmUgc2VsZWN0ZWRcbiAgICAgICAgdGhpcy5fYXZhdGFyVXBsb2FkLmN1cnJlbnQudmFsdWUgPSBcIlwiO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGF2YXRhclVybDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgYXZhdGFyRmlsZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZW5hYmxlUHJvZmlsZVNhdmU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBfc2F2ZVByb2ZpbGUgPSBhc3luYyAoZSkgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmVuYWJsZVByb2ZpbGVTYXZlKSByZXR1cm47XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe2VuYWJsZVByb2ZpbGVTYXZlOiBmYWxzZX0pO1xuXG4gICAgICAgIGNvbnN0IGNsaWVudCA9IE1hdHJpeENsaWVudFBlZy5nZXQoKTtcbiAgICAgICAgY29uc3QgbmV3U3RhdGUgPSB7fTtcblxuICAgICAgICAvLyBUT0RPOiBXaGF0IGRvIHdlIGRvIGFib3V0IGVycm9ycz9cblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5vcmlnaW5hbERpc3BsYXlOYW1lICE9PSB0aGlzLnN0YXRlLmRpc3BsYXlOYW1lKSB7XG4gICAgICAgICAgICBhd2FpdCBjbGllbnQuc2V0Um9vbU5hbWUodGhpcy5wcm9wcy5yb29tSWQsIHRoaXMuc3RhdGUuZGlzcGxheU5hbWUpO1xuICAgICAgICAgICAgbmV3U3RhdGUub3JpZ2luYWxEaXNwbGF5TmFtZSA9IHRoaXMuc3RhdGUuZGlzcGxheU5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5zdGF0ZS5hdmF0YXJGaWxlKSB7XG4gICAgICAgICAgICBjb25zdCB1cmkgPSBhd2FpdCBjbGllbnQudXBsb2FkQ29udGVudCh0aGlzLnN0YXRlLmF2YXRhckZpbGUpO1xuICAgICAgICAgICAgYXdhaXQgY2xpZW50LnNlbmRTdGF0ZUV2ZW50KHRoaXMucHJvcHMucm9vbUlkLCAnbS5yb29tLmF2YXRhcicsIHt1cmw6IHVyaX0sICcnKTtcbiAgICAgICAgICAgIG5ld1N0YXRlLmF2YXRhclVybCA9IGNsaWVudC5teGNVcmxUb0h0dHAodXJpLCA5NiwgOTYsICdjcm9wJywgZmFsc2UpO1xuICAgICAgICAgICAgbmV3U3RhdGUub3JpZ2luYWxBdmF0YXJVcmwgPSBuZXdTdGF0ZS5hdmF0YXJVcmw7XG4gICAgICAgICAgICBuZXdTdGF0ZS5hdmF0YXJGaWxlID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLm9yaWdpbmFsQXZhdGFyVXJsICE9PSB0aGlzLnN0YXRlLmF2YXRhclVybCkge1xuICAgICAgICAgICAgYXdhaXQgY2xpZW50LnNlbmRTdGF0ZUV2ZW50KHRoaXMucHJvcHMucm9vbUlkLCAnbS5yb29tLmF2YXRhcicsIHt1cmw6IHVuZGVmaW5lZH0sICcnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnN0YXRlLm9yaWdpbmFsVG9waWMgIT09IHRoaXMuc3RhdGUudG9waWMpIHtcbiAgICAgICAgICAgIGF3YWl0IGNsaWVudC5zZXRSb29tVG9waWModGhpcy5wcm9wcy5yb29tSWQsIHRoaXMuc3RhdGUudG9waWMpO1xuICAgICAgICAgICAgbmV3U3RhdGUub3JpZ2luYWxUb3BpYyA9IHRoaXMuc3RhdGUudG9waWM7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldFN0YXRlKG5ld1N0YXRlKTtcbiAgICB9O1xuXG4gICAgX29uRGlzcGxheU5hbWVDaGFuZ2VkID0gKGUpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogZS50YXJnZXQudmFsdWUsXG4gICAgICAgICAgICBlbmFibGVQcm9maWxlU2F2ZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIF9vblRvcGljQ2hhbmdlZCA9IChlKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdG9waWM6IGUudGFyZ2V0LnZhbHVlLFxuICAgICAgICAgICAgZW5hYmxlUHJvZmlsZVNhdmU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBfb25BdmF0YXJDaGFuZ2VkID0gKGUpID0+IHtcbiAgICAgICAgaWYgKCFlLnRhcmdldC5maWxlcyB8fCAhZS50YXJnZXQuZmlsZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBhdmF0YXJVcmw6IHRoaXMuc3RhdGUub3JpZ2luYWxBdmF0YXJVcmwsXG4gICAgICAgICAgICAgICAgYXZhdGFyRmlsZTogbnVsbCxcbiAgICAgICAgICAgICAgICBlbmFibGVQcm9maWxlU2F2ZTogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpbGUgPSBlLnRhcmdldC5maWxlc1swXTtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChldikgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgYXZhdGFyVXJsOiBldi50YXJnZXQucmVzdWx0LFxuICAgICAgICAgICAgICAgIGF2YXRhckZpbGU6IGZpbGUsXG4gICAgICAgICAgICAgICAgZW5hYmxlUHJvZmlsZVNhdmU6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfTtcblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgQWNjZXNzaWJsZUJ1dHRvbiA9IHNkay5nZXRDb21wb25lbnQoJ2VsZW1lbnRzLkFjY2Vzc2libGVCdXR0b24nKTtcbiAgICAgICAgY29uc3QgQXZhdGFyU2V0dGluZyA9IHNkay5nZXRDb21wb25lbnQoJ3NldHRpbmdzLkF2YXRhclNldHRpbmcnKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxmb3JtIG9uU3VibWl0PXt0aGlzLl9zYXZlUHJvZmlsZX0gYXV0b0NvbXBsZXRlPVwib2ZmXCIgbm9WYWxpZGF0ZT17dHJ1ZX0+XG4gICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJmaWxlXCIgcmVmPXt0aGlzLl9hdmF0YXJVcGxvYWR9IGNsYXNzTmFtZT1cIm14X1Byb2ZpbGVTZXR0aW5nc19hdmF0YXJVcGxvYWRcIlxuICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5fb25BdmF0YXJDaGFuZ2VkfSBhY2NlcHQ9XCJpbWFnZS8qXCIgLz5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm14X1Byb2ZpbGVTZXR0aW5nc19wcm9maWxlXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXhfUHJvZmlsZVNldHRpbmdzX2NvbnRyb2xzXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8RmllbGQgbGFiZWw9e190KFwiUm9vbSBOYW1lXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCIgdmFsdWU9e3RoaXMuc3RhdGUuZGlzcGxheU5hbWV9IGF1dG9Db21wbGV0ZT1cIm9mZlwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX29uRGlzcGxheU5hbWVDaGFuZ2VkfSBkaXNhYmxlZD17IXRoaXMuc3RhdGUuY2FuU2V0TmFtZX0gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxGaWVsZCBpZD1cInByb2ZpbGVUb3BpY1wiIGxhYmVsPXtfdChcIlJvb20gVG9waWNcIil9IGRpc2FibGVkPXshdGhpcy5zdGF0ZS5jYW5TZXRUb3BpY31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiIHZhbHVlPXt0aGlzLnN0YXRlLnRvcGljfSBhdXRvQ29tcGxldGU9XCJvZmZcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLl9vblRvcGljQ2hhbmdlZH0gZWxlbWVudD1cInRleHRhcmVhXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxBdmF0YXJTZXR0aW5nXG4gICAgICAgICAgICAgICAgICAgICAgICBhdmF0YXJVcmw9e3RoaXMuc3RhdGUuYXZhdGFyVXJsfVxuICAgICAgICAgICAgICAgICAgICAgICAgYXZhdGFyTmFtZT17dGhpcy5zdGF0ZS5kaXNwbGF5TmFtZSB8fCB0aGlzLnByb3BzLnJvb21JZH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF2YXRhckFsdFRleHQ9e190KFwiUm9vbSBhdmF0YXJcIil9XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRBdmF0YXI9e3RoaXMuc3RhdGUuY2FuU2V0QXZhdGFyID8gdGhpcy5fdXBsb2FkQXZhdGFyIDogdW5kZWZpbmVkfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQXZhdGFyPXt0aGlzLnN0YXRlLmNhblNldEF2YXRhciA/IHRoaXMuX3JlbW92ZUF2YXRhciA6IHVuZGVmaW5lZH0gLz5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8QWNjZXNzaWJsZUJ1dHRvbiBvbkNsaWNrPXt0aGlzLl9zYXZlUHJvZmlsZX0ga2luZD1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshdGhpcy5zdGF0ZS5lbmFibGVQcm9maWxlU2F2ZX0+XG4gICAgICAgICAgICAgICAgICAgIHtfdChcIlNhdmVcIil9XG4gICAgICAgICAgICAgICAgPC9BY2Nlc3NpYmxlQnV0dG9uPlxuICAgICAgICAgICAgPC9mb3JtPlxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==