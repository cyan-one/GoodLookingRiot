"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _ResizeHandle = _interopRequireDefault(require("../views/elements/ResizeHandle"));

var _resizer = require("../../resizer");

/*
Copyright 2018 New Vector Ltd
Copyright 2019 The Matrix.org Foundation C.I.C.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class MainSplit extends _react.default.Component {
  constructor(props) {
    super(props);
    this._setResizeContainerRef = this._setResizeContainerRef.bind(this);
    this._onResized = this._onResized.bind(this);
  }

  _onResized(size) {
    window.localStorage.setItem("mx_rhs_size", size);

    if (this.props.resizeNotifier) {
      this.props.resizeNotifier.notifyRightHandleResized();
    }
  }

  _createResizer() {
    const classNames = {
      handle: "mx_ResizeHandle",
      vertical: "mx_ResizeHandle_vertical",
      reverse: "mx_ResizeHandle_reverse"
    };
    const resizer = new _resizer.Resizer(this.resizeContainer, _resizer.FixedDistributor, {
      onResized: this._onResized
    });
    resizer.setClassNames(classNames);
    let rhsSize = window.localStorage.getItem("mx_rhs_size");

    if (rhsSize !== null) {
      rhsSize = parseInt(rhsSize, 10);
    } else {
      rhsSize = 350;
    }

    resizer.forHandleAt(0).resize(rhsSize);
    resizer.attach();
    this.resizer = resizer;
  }

  _setResizeContainerRef(div) {
    this.resizeContainer = div;
  }

  componentDidMount() {
    if (this.props.panel) {
      this._createResizer();
    }
  }

  componentWillUnmount() {
    if (this.resizer) {
      this.resizer.detach();
      this.resizer = null;
    }
  }

  componentDidUpdate(prevProps) {
    const wasPanelSet = this.props.panel && !prevProps.panel;
    const wasPanelCleared = !this.props.panel && prevProps.panel;

    if (this.resizeContainer && wasPanelSet) {
      // The resizer can only be created when **both** expanded and the panel is
      // set. Once both are true, the container ref will mount, which is required
      // for the resizer to work.
      this._createResizer();
    } else if (this.resizer && wasPanelCleared) {
      this.resizer.detach();
      this.resizer = null;
    }
  }

  render() {
    const bodyView = _react.default.Children.only(this.props.children);

    const panelView = this.props.panel;
    const hasResizer = !this.props.collapsedRhs && panelView;
    let children;

    if (hasResizer) {
      children = /*#__PURE__*/_react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/_react.default.createElement(_ResizeHandle.default, {
        reverse: true
      }), panelView);
    }

    return /*#__PURE__*/_react.default.createElement("div", {
      className: "mx_MainSplit",
      ref: hasResizer ? this._setResizeContainerRef : undefined
    }, bodyView, children);
  }

}

exports.default = MainSplit;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3N0cnVjdHVyZXMvTWFpblNwbGl0LmpzIl0sIm5hbWVzIjpbIk1haW5TcGxpdCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsIl9zZXRSZXNpemVDb250YWluZXJSZWYiLCJiaW5kIiwiX29uUmVzaXplZCIsInNpemUiLCJ3aW5kb3ciLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwicmVzaXplTm90aWZpZXIiLCJub3RpZnlSaWdodEhhbmRsZVJlc2l6ZWQiLCJfY3JlYXRlUmVzaXplciIsImNsYXNzTmFtZXMiLCJoYW5kbGUiLCJ2ZXJ0aWNhbCIsInJldmVyc2UiLCJyZXNpemVyIiwiUmVzaXplciIsInJlc2l6ZUNvbnRhaW5lciIsIkZpeGVkRGlzdHJpYnV0b3IiLCJvblJlc2l6ZWQiLCJzZXRDbGFzc05hbWVzIiwicmhzU2l6ZSIsImdldEl0ZW0iLCJwYXJzZUludCIsImZvckhhbmRsZUF0IiwicmVzaXplIiwiYXR0YWNoIiwiZGl2IiwiY29tcG9uZW50RGlkTW91bnQiLCJwYW5lbCIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwiZGV0YWNoIiwiY29tcG9uZW50RGlkVXBkYXRlIiwicHJldlByb3BzIiwid2FzUGFuZWxTZXQiLCJ3YXNQYW5lbENsZWFyZWQiLCJyZW5kZXIiLCJib2R5VmlldyIsIkNoaWxkcmVuIiwib25seSIsImNoaWxkcmVuIiwicGFuZWxWaWV3IiwiaGFzUmVzaXplciIsImNvbGxhcHNlZFJocyIsInVuZGVmaW5lZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBaUJBOztBQUNBOztBQUNBOztBQW5CQTs7Ozs7Ozs7Ozs7Ozs7OztBQXFCZSxNQUFNQSxTQUFOLFNBQXdCQyxlQUFNQyxTQUE5QixDQUF3QztBQUNuREMsRUFBQUEsV0FBVyxDQUFDQyxLQUFELEVBQVE7QUFDZixVQUFNQSxLQUFOO0FBQ0EsU0FBS0Msc0JBQUwsR0FBOEIsS0FBS0Esc0JBQUwsQ0FB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UUFBSjs7QUFDQSxRQUFJRSxVQUFKLEVBQWdCO0FBQ1pGLE1BQUFBLFFBQVEsZ0JBQUcsNkJBQUMsY0FBRCxDQUFPLFFBQVAscUJBQ1AsNkJBQUMscUJBQUQ7QUFBYyxRQUFBLE9BQU8sRUFBRTtBQUF2QixRQURPLEVBRUxDLFNBRkssQ0FBWDtBQUlIOztBQUVELHdCQUFPO0FBQUssTUFBQSxTQUFTLEVBQUMsY0FBZjtBQUE4QixNQUFBLEdBQUcsRUFBRUMsVUFBVSxHQUFHLEtBQUt6QyxzQkFBUixHQUFpQzJDO0FBQTlFLE9BQ0RQLFFBREMsRUFFREcsUUFGQyxDQUFQO0FBSUg7O0FBeEZrRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5Db3B5cmlnaHQgMjAxOCBOZXcgVmVjdG9yIEx0ZFxuQ29weXJpZ2h0IDIwMTkgVGhlIE1hdHJpeC5vcmcgRm91bmRhdGlvbiBDLkkuQy5cblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlc2l6ZUhhbmRsZSBmcm9tICcuLi92aWV3cy9lbGVtZW50cy9SZXNpemVIYW5kbGUnO1xuaW1wb3J0IHtSZXNpemVyLCBGaXhlZERpc3RyaWJ1dG9yfSBmcm9tICcuLi8uLi9yZXNpemVyJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWFpblNwbGl0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuX3NldFJlc2l6ZUNvbnRhaW5lclJlZiA9IHRoaXMuX3NldFJlc2l6ZUNvbnRhaW5lclJlZi5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9vblJlc2l6ZWQgPSB0aGlzLl9vblJlc2l6ZWQuYmluZCh0aGlzKTtcbiAgICB9XG5cbiAgICBfb25SZXNpemVkKHNpemUpIHtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibXhfcmhzX3NpemVcIiwgc2l6ZSk7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzLnJlc2l6ZU5vdGlmaWVyLm5vdGlmeVJpZ2h0SGFuZGxlUmVzaXplZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2NyZWF0ZVJlc2l6ZXIoKSB7XG4gICAgICAgIGNvbnN0IGNsYXNzTmFtZXMgPSB7XG4gICAgICAgICAgICBoYW5kbGU6IFwibXhfUmVzaXplSGFuZGxlXCIsXG4gICAgICAgICAgICB2ZXJ0aWNhbDogXCJteF9SZXNpemVIYW5kbGVfdmVydGljYWxcIixcbiAgICAgICAgICAgIHJldmVyc2U6IFwibXhfUmVzaXplSGFuZGxlX3JldmVyc2VcIixcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzaXplciA9IG5ldyBSZXNpemVyKFxuICAgICAgICAgICAgdGhpcy5yZXNpemVDb250YWluZXIsXG4gICAgICAgICAgICBGaXhlZERpc3RyaWJ1dG9yLFxuICAgICAgICAgICAge29uUmVzaXplZDogdGhpcy5fb25SZXNpemVkfSxcbiAgICAgICAgKTtcbiAgICAgICAgcmVzaXplci5zZXRDbGFzc05hbWVzKGNsYXNzTmFtZXMpO1xuICAgICAgICBsZXQgcmhzU2l6ZSA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcIm14X3Joc19zaXplXCIpO1xuICAgICAgICBpZiAocmhzU2l6ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmhzU2l6ZSA9IHBhcnNlSW50KHJoc1NpemUsIDEwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJoc1NpemUgPSAzNTA7XG4gICAgICAgIH1cbiAgICAgICAgcmVzaXplci5mb3JIYW5kbGVBdCgwKS5yZXNpemUocmhzU2l6ZSk7XG5cbiAgICAgICAgcmVzaXplci5hdHRhY2goKTtcbiAgICAgICAgdGhpcy5yZXNpemVyID0gcmVzaXplcjtcbiAgICB9XG5cbiAgICBfc2V0UmVzaXplQ29udGFpbmVyUmVmKGRpdikge1xuICAgICAgICB0aGlzLnJlc2l6ZUNvbnRhaW5lciA9IGRpdjtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgaWYgKHRoaXMucHJvcHMucGFuZWwpIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZVJlc2l6ZXIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBpZiAodGhpcy5yZXNpemVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZXIuZGV0YWNoKCk7XG4gICAgICAgICAgICB0aGlzLnJlc2l6ZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuICAgICAgICBjb25zdCB3YXNQYW5lbFNldCA9IHRoaXMucHJvcHMucGFuZWwgJiYgIXByZXZQcm9wcy5wYW5lbDtcbiAgICAgICAgY29uc3Qgd2FzUGFuZWxDbGVhcmVkID0gIXRoaXMucHJvcHMucGFuZWwgJiYgcHJldlByb3BzLnBhbmVsO1xuXG4gICAgICAgIGlmICh0aGlzLnJlc2l6ZUNvbnRhaW5lciAmJiB3YXNQYW5lbFNldCkge1xuICAgICAgICAgICAgLy8gVGhlIHJlc2l6ZXIgY2FuIG9ubHkgYmUgY3JlYXRlZCB3aGVuICoqYm90aCoqIGV4cGFuZGVkIGFuZCB0aGUgcGFuZWwgaXNcbiAgICAgICAgICAgIC8vIHNldC4gT25jZSBib3RoIGFyZSB0cnVlLCB0aGUgY29udGFpbmVyIHJlZiB3aWxsIG1vdW50LCB3aGljaCBpcyByZXF1aXJlZFxuICAgICAgICAgICAgLy8gZm9yIHRoZSByZXNpemVyIHRvIHdvcmsuXG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVSZXNpemVyKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5yZXNpemVyICYmIHdhc1BhbmVsQ2xlYXJlZCkge1xuICAgICAgICAgICAgdGhpcy5yZXNpemVyLmRldGFjaCgpO1xuICAgICAgICAgICAgdGhpcy5yZXNpemVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgYm9keVZpZXcgPSBSZWFjdC5DaGlsZHJlbi5vbmx5KHRoaXMucHJvcHMuY2hpbGRyZW4pO1xuICAgICAgICBjb25zdCBwYW5lbFZpZXcgPSB0aGlzLnByb3BzLnBhbmVsO1xuXG4gICAgICAgIGNvbnN0IGhhc1Jlc2l6ZXIgPSAhdGhpcy5wcm9wcy5jb2xsYXBzZWRSaHMgJiYgcGFuZWxWaWV3O1xuXG4gICAgICAgIGxldCBjaGlsZHJlbjtcbiAgICAgICAgaWYgKGhhc1Jlc2l6ZXIpIHtcbiAgICAgICAgICAgIGNoaWxkcmVuID0gPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICAgIDxSZXNpemVIYW5kbGUgcmV2ZXJzZT17dHJ1ZX0gLz5cbiAgICAgICAgICAgICAgICB7IHBhbmVsVmlldyB9XG4gICAgICAgICAgICA8L1JlYWN0LkZyYWdtZW50PjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cIm14X01haW5TcGxpdFwiIHJlZj17aGFzUmVzaXplciA/IHRoaXMuX3NldFJlc2l6ZUNvbnRhaW5lclJlZiA6IHVuZGVmaW5lZH0+XG4gICAgICAgICAgICB7IGJvZHlWaWV3IH1cbiAgICAgICAgICAgIHsgY2hpbGRyZW4gfVxuICAgICAgICA8L2Rpdj47XG4gICAgfVxufVxuIl19