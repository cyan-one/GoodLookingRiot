"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _sizer = _interopRequireDefault(require("../sizer"));

var _item = _interopRequireDefault(require("../item"));

/*
Copyright 2019 New Vector Ltd

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
class RoomSizer extends _sizer.default {
  setItemSize(item, size) {
    item.style.maxHeight = "".concat(Math.round(size), "px");
    item.classList.add("resized-sized");
  }

  clearItemSize(item) {
    item.style.maxHeight = null;
    item.classList.remove("resized-sized");
  }

}

class RoomSubListItem extends _item.default {
  isCollapsed() {
    return this.domNode.classList.contains("mx_RoomSubList_hidden");
  }

  maxSize() {
    const header = this.domNode.querySelector(".mx_RoomSubList_labelContainer");
    const scrollItem = this.domNode.querySelector(".mx_RoomSubList_scroll");
    const headerHeight = this.sizer.getItemSize(header);
    return headerHeight + (scrollItem ? scrollItem.scrollHeight : 0);
  }

  minSize() {
    const isNotEmpty = this.domNode.classList.contains("mx_RoomSubList_nonEmpty");
    return isNotEmpty ? 74 : 31; //size of header + 1? room tile (see room sub list css)
  }

  isSized() {
    return this.domNode.classList.contains("resized-sized");
  }

}

class RoomSubListDistributor {
  static createItem(resizeHandle, resizer, sizer) {
    return new RoomSubListItem(resizeHandle, resizer, sizer);
  }

  static createSizer(containerElement, vertical, reverse) {
    return new RoomSizer(containerElement, vertical, reverse);
  }

  constructor(item) {
    this.item = item;
  }

  _handleSize() {
    return 1;
  }

  resize(size) {
    //console.log("*** starting resize session with size", size);
    let item = this.item;

    while (item) {
      const minSize = item.minSize();

      if (item.isCollapsed()) {
        item = item.previous();
      } else if (size <= minSize) {
        //console.log("  - resizing", item.id, "to min size", minSize);
        item.setSize(minSize);
        const remainder = minSize - size;
        item = item.previous();

        if (item) {
          size = item.size() - remainder - this._handleSize();
        }
      } else {
        const maxSize = item.maxSize();

        if (size > maxSize) {
          // console.log("  - resizing", item.id, "to maxSize", maxSize);
          item.setSize(maxSize);
          const remainder = size - maxSize;
          item = item.previous();

          if (item) {
            size = item.size() + remainder; // todo: handle size here?
          }
        } else {
          //console.log("  - resizing", item.id, "to size", size);
          item.setSize(size);
          item = null;
          size = 0;
        }
      }
    } //console.log("*** ending resize session");

  }

  resizeFromContainerOffset(containerOffset) {
    this.resize(containerOffset - this.item.offset());
  }

  start() {
    // set all max-height props to the actual height.
    let item = this.item.first();
    const sizes = [];

    while (item) {
      if (!item.isCollapsed()) {
        sizes.push(item.size());
      } else {
        sizes.push(100);
      }

      item = item.next();
    }

    item = this.item.first();
    sizes.forEach(size => {
      item.setSize(size);
      item = item.next();
    });
  }

  finish() {}

}

exports.default = RoomSubListDistributor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9yZXNpemVyL2Rpc3RyaWJ1dG9ycy9yb29tc3VibGlzdC5qcyJdLCJuYW1lcyI6WyJSb29tU2l6ZXIiLCJTaXplciIsInNldEl0ZW1TaXplIiwiaXRlbSIsInNpemUiLCJzdHlsZSIsIm1heEhlaWdodCIsIk1hdGgiLCJyb3VuZCIsImNsYXNzTGlzdCIsImFkZCIsImNsZWFySXRlbVNpemUiLCJyZW1vdmUiLCJSb29tU3ViTGlzdEl0ZW0iLCJSZXNpemVJdGVtIiwiaXNDb2xsYXBzZWQiLCJkb21Ob2RlIiwiY29udGFpbnMiLCJtYXhTaXplIiwiaGVhZGVyIiwicXVlcnlTZWxlY3RvciIsInNjcm9sbEl0ZW0iLCJoZWFkZXJIZWlnaHQiLCJzaXplciIsImdldEl0ZW1TaXplIiwic2Nyb2xsSGVpZ2h0IiwibWluU2l6ZSIsImlzTm90RW1wdHkiLCJpc1NpemVkIiwiUm9vbVN1Ykxpc3REaXN0cmlidXRvciIsImNyZWF0ZUl0ZW0iLCJyZXNpemVIYW5kbGUiLCJyZXNpemVyIiwiY3JlYXRlU2l6ZXIiLCJjb250YWluZXJFbGVtZW50IiwidmVydGljYWwiLCJyZXZlcnNlIiwiY29uc3RydWN0b3IiLCJfaGFuZGxlU2l6ZSIsInJlc2l6ZSIsInByZXZpb3VzIiwic2V0U2l6ZSIsInJlbWFpbmRlciIsInJlc2l6ZUZyb21Db250YWluZXJPZmZzZXQiLCJjb250YWluZXJPZmZzZXQiLCJvZmZzZXQiLCJzdGFydCIsImZpcnN0Iiwic2l6ZXMiLCJwdXNoIiwibmV4dCIsImZvckVhY2giLCJmaW5pc2giXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQWdCQTs7QUFDQTs7QUFqQkE7Ozs7Ozs7Ozs7Ozs7OztBQW1CQSxNQUFNQSxTQUFOLFNBQXdCQyxjQUF4QixDQUE4QjtBQUMxQkMsRUFBQUEsV0FBVyxDQUFDQyxJQUFELEVBQU9DLElBQVAsRUFBYTtBQUNwQkQsSUFBQUEsSUFBSSxDQUFDRSxLQUFMLENBQVdDLFNBQVgsYUFBMEJDLElBQUksQ0FB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QyxJQUFMLEVBQVA7QUFDSDs7QUFDRC9DLElBQUFBLElBQUksR0FBRyxLQUFLQSxJQUFMLENBQVU0QyxLQUFWLEVBQVA7QUFDQUMsSUFBQUEsS0FBSyxDQUFDRyxPQUFOLENBQWUvQyxJQUFELElBQVU7QUFDcEJELE1BQUFBLElBQUksQ0FBQ3NDLE9BQUwsQ0FBYXJDLElBQWI7QUFDQUQsTUFBQUEsSUFBSSxHQUFHQSxJQUFJLENBQUMrQyxJQUFMLEVBQVA7QUFDSCxLQUhEO0FBSUg7O0FBRURFLEVBQUFBLE1BQU0sR0FBRyxDQUNSOztBQTdFdUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQ29weXJpZ2h0IDIwMTkgTmV3IFZlY3RvciBMdGRcblxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbnlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbllvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cblVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbmRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbldJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxubGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4qL1xuXG5pbXBvcnQgU2l6ZXIgZnJvbSBcIi4uL3NpemVyXCI7XG5pbXBvcnQgUmVzaXplSXRlbSBmcm9tIFwiLi4vaXRlbVwiO1xuXG5jbGFzcyBSb29tU2l6ZXIgZXh0ZW5kcyBTaXplciB7XG4gICAgc2V0SXRlbVNpemUoaXRlbSwgc2l6ZSkge1xuICAgICAgICBpdGVtLnN0eWxlLm1heEhlaWdodCA9IGAke01hdGgucm91bmQoc2l6ZSl9cHhgO1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJyZXNpemVkLXNpemVkXCIpO1xuICAgIH1cblxuICAgIGNsZWFySXRlbVNpemUoaXRlbSkge1xuICAgICAgICBpdGVtLnN0eWxlLm1heEhlaWdodCA9IG51bGw7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcInJlc2l6ZWQtc2l6ZWRcIik7XG4gICAgfVxufVxuXG5jbGFzcyBSb29tU3ViTGlzdEl0ZW0gZXh0ZW5kcyBSZXNpemVJdGVtIHtcbiAgICBpc0NvbGxhcHNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9tTm9kZS5jbGFzc0xpc3QuY29udGFpbnMoXCJteF9Sb29tU3ViTGlzdF9oaWRkZW5cIik7XG4gICAgfVxuXG4gICAgbWF4U2l6ZSgpIHtcbiAgICAgICAgY29uc3QgaGVhZGVyID0gdGhpcy5kb21Ob2RlLnF1ZXJ5U2VsZWN0b3IoXCIubXhfUm9vbVN1Ykxpc3RfbGFiZWxDb250YWluZXJcIik7XG4gICAgICAgIGNvbnN0IHNjcm9sbEl0ZW0gPSB0aGlzLmRvbU5vZGUucXVlcnlTZWxlY3RvcihcIi5teF9Sb29tU3ViTGlzdF9zY3JvbGxcIik7XG4gICAgICAgIGNvbnN0IGhlYWRlckhlaWdodCA9IHRoaXMuc2l6ZXIuZ2V0SXRlbVNpemUoaGVhZGVyKTtcbiAgICAgICAgcmV0dXJuIGhlYWRlckhlaWdodCArIChzY3JvbGxJdGVtID8gc2Nyb2xsSXRlbS5zY3JvbGxIZWlnaHQgOiAwKTtcbiAgICB9XG5cbiAgICBtaW5TaXplKCkge1xuICAgICAgICBjb25zdCBpc05vdEVtcHR5ID0gdGhpcy5kb21Ob2RlLmNsYXNzTGlzdC5jb250YWlucyhcIm14X1Jvb21TdWJMaXN0X25vbkVtcHR5XCIpO1xuICAgICAgICByZXR1cm4gaXNOb3RFbXB0eSA/IDc0IDogMzE7IC8vc2l6ZSBvZiBoZWFkZXIgKyAxPyByb29tIHRpbGUgKHNlZSByb29tIHN1YiBsaXN0IGNzcylcbiAgICB9XG5cbiAgICBpc1NpemVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb21Ob2RlLmNsYXNzTGlzdC5jb250YWlucyhcInJlc2l6ZWQtc2l6ZWRcIik7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSb29tU3ViTGlzdERpc3RyaWJ1dG9yIHtcbiAgICBzdGF0aWMgY3JlYXRlSXRlbShyZXNpemVIYW5kbGUsIHJlc2l6ZXIsIHNpemVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgUm9vbVN1Ykxpc3RJdGVtKHJlc2l6ZUhhbmRsZSwgcmVzaXplciwgc2l6ZXIpO1xuICAgIH1cblxuICAgIHN0YXRpYyBjcmVhdGVTaXplcihjb250YWluZXJFbGVtZW50LCB2ZXJ0aWNhbCwgcmV2ZXJzZSkge1xuICAgICAgICByZXR1cm4gbmV3IFJvb21TaXplcihjb250YWluZXJFbGVtZW50LCB2ZXJ0aWNhbCwgcmV2ZXJzZSk7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoaXRlbSkge1xuICAgICAgICB0aGlzLml0ZW0gPSBpdGVtO1xuICAgIH1cblxuICAgIF9oYW5kbGVTaXplKCkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG5cbiAgICByZXNpemUoc2l6ZSkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwiKioqIHN0YXJ0aW5nIHJlc2l6ZSBzZXNzaW9uIHdpdGggc2l6ZVwiLCBzaXplKTtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLml0ZW07XG4gICAgICAgIHdoaWxlIChpdGVtKSB7XG4gICAgICAgICAgICBjb25zdCBtaW5TaXplID0gaXRlbS5taW5TaXplKCk7XG4gICAgICAgICAgICBpZiAoaXRlbS5pc0NvbGxhcHNlZCgpKSB7XG4gICAgICAgICAgICAgICAgaXRlbSA9IGl0ZW0ucHJldmlvdXMoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2l6ZSA8PSBtaW5TaXplKSB7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIiAgLSByZXNpemluZ1wiLCBpdGVtLmlkLCBcInRvIG1pbiBzaXplXCIsIG1pblNpemUpO1xuICAgICAgICAgICAgICAgIGl0ZW0uc2V0U2l6ZShtaW5TaXplKTtcbiAgICAgICAgICAgICAgICBjb25zdCByZW1haW5kZXIgPSBtaW5TaXplIC0gc2l6ZTtcbiAgICAgICAgICAgICAgICBpdGVtID0gaXRlbS5wcmV2aW91cygpO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHNpemUgPSBpdGVtLnNpemUoKSAtIHJlbWFpbmRlciAtIHRoaXMuX2hhbmRsZVNpemUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1heFNpemUgPSBpdGVtLm1heFNpemUoKTtcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA+IG1heFNpemUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCIgIC0gcmVzaXppbmdcIiwgaXRlbS5pZCwgXCJ0byBtYXhTaXplXCIsIG1heFNpemUpO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLnNldFNpemUobWF4U2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbWFpbmRlciA9IHNpemUgLSBtYXhTaXplO1xuICAgICAgICAgICAgICAgICAgICBpdGVtID0gaXRlbS5wcmV2aW91cygpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IGl0ZW0uc2l6ZSgpICsgcmVtYWluZGVyOyAvLyB0b2RvOiBoYW5kbGUgc2l6ZSBoZXJlP1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIiAgLSByZXNpemluZ1wiLCBpdGVtLmlkLCBcInRvIHNpemVcIiwgc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0U2l6ZShzaXplKTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHNpemUgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvL2NvbnNvbGUubG9nKFwiKioqIGVuZGluZyByZXNpemUgc2Vzc2lvblwiKTtcbiAgICB9XG5cbiAgICByZXNpemVGcm9tQ29udGFpbmVyT2Zmc2V0KGNvbnRhaW5lck9mZnNldCkge1xuICAgICAgICB0aGlzLnJlc2l6ZShjb250YWluZXJPZmZzZXQgLSB0aGlzLml0ZW0ub2Zmc2V0KCkpO1xuICAgIH1cblxuICAgIHN0YXJ0KCkge1xuICAgICAgICAvLyBzZXQgYWxsIG1heC1oZWlnaHQgcHJvcHMgdG8gdGhlIGFjdHVhbCBoZWlnaHQuXG4gICAgICAgIGxldCBpdGVtID0gdGhpcy5pdGVtLmZpcnN0KCk7XG4gICAgICAgIGNvbnN0IHNpemVzID0gW107XG4gICAgICAgIHdoaWxlIChpdGVtKSB7XG4gICAgICAgICAgICBpZiAoIWl0ZW0uaXNDb2xsYXBzZWQoKSkge1xuICAgICAgICAgICAgICAgIHNpemVzLnB1c2goaXRlbS5zaXplKCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzaXplcy5wdXNoKDEwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpdGVtID0gaXRlbS5uZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaXRlbSA9IHRoaXMuaXRlbS5maXJzdCgpO1xuICAgICAgICBzaXplcy5mb3JFYWNoKChzaXplKSA9PiB7XG4gICAgICAgICAgICBpdGVtLnNldFNpemUoc2l6ZSk7XG4gICAgICAgICAgICBpdGVtID0gaXRlbS5uZXh0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZpbmlzaCgpIHtcbiAgICB9XG59XG4iXX0=